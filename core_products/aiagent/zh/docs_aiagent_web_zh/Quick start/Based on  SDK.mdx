# 快速开始

--- 

## 准备环境

在开始使用SDK之前，请确保您的开发环境满足以下要求：

- Windows 或 macOS 开发电脑已经连接到 Internet。
- 满足 ZEGO Express Web SDK 兼容性的浏览器（具体请参考 [浏览器兼容性和已知问题](https://doc-zh.zego.im/article/12047)），推荐使用最新版本的 Google Chrome 浏览器。

## 前提条件

- 已在 [ZEGO 控制台](https://console.zego.im) 创建项目，并申请有效的 AppID 和 AppSign，详情请参考 [控制台 - 项目信息](https://doc-zh.zego.im/article/12107)。
- 联系 ZEGO 技术支持，开通 AI Agent 相关服务。
- 已经集成了 [ZEGO Express Web SDK](https://doc-zh.zego.im/article/199)。



## 初始化项目并集成SDK
1. 下载并安装Node.js。

2. 新建项目
```bash
npm create vue@latest
```
选择默认选项即可
```bash
> npx
> create-vue
Vue.js - The Progressive JavaScript Framework
✔ 请输入项目名称： … ai_agent_web_demo
✔ 是否使用 TypeScript 语法？ … [否] / 是
✔ 是否启用 JSX 支持？ … [否] / 是
✔ 是否引入 Vue Router 进行单页面应用开发？ … [否] / 是
✔ 是否引入 Pinia 用于状态管理？ … [否] / 是
✔ 是否引入 Vitest 用于单元测试？ … [否] / 是
✔ 是否要引入一款端到端（End to End）测试工具？ › 不需要
✔ 是否引入 ESLint 用于代码质量检测？ › 否
正在初始化项目 /xxx/ai_agent_web_demo...
项目初始化完成，可执行以下命令：
 cd ai_agent_web_demo
 npm install
 npm run dev

```
3. 通过包管理器 安装 SDK。
```bash
npm install zego-ai-agent-web
```

注意
    - 安装的依赖包支持 typescript 语言。
    - 如果在 macOS 或 Linux 系统中执行安装命令失败，提示 “permission denied”，请在SDK安装命令前加上 sudo 重新执行即可。


4. 在项目中引入 RTC SDK，示例代码如下：
【[RTC SDK](https://doc-zh.zego.im/article/199)】


5. 在项目中引入 AI Agent SDK，示例代码如下：
```javascript
<script setup>
import { ZegoExpressEngine } from "zego-express-engine-webrtc"
import { ZegoAIAgent } from "zego-ai-agent-web";
</script>
<template>
 <div>
   <h1>Zego AI Agent Demo</h1>
 </div>
</template>

```

## 核心能力实现




### 初始化用户信息和 SDK 参数
在开始使用 AI Agent 之前，您需要完成以下步骤：
完成 RTC 初始化

<Warning title="注意">
在实现 AI Agent 的功能之前，请确保已经集成了 [ZEGO Express Web SDK](https://doc-zh.zego.im/article/199)。
</Warning>

1. 引入SDK并获取实例： 

【以下流程添加说明使用的API（包括RTC）和实现的功能，例如，使用getInstance获取ZegoAIAgent的单例实例。】

这段代码展示了如何使用 ZegoAIAgent SDK 进行初始化，通过 getInstance() 获取单例实例，然后调用 initSDK 方法完成 SDK 的初始化，需要传入认证信息（appID和token）以及用户信息（userID和userName）。
```typescript
import { ZegoAIAgent } from 'zego-AIAgent';

const AIAgent = ZegoAIAgent.getInstance();

// 配置认证信息
const authData = {
    appId: your_app_id,    // 您的应用Id
    token: 'your_token'    // 您的认证Token
};

// 配置用户信息
const userProfile = {
    userId: 'user123',     // 用户Id
    userName: 'username'   // 用户名称
};

// 初始化 AI Agent SDK
try {
    const result = await AIAgent.initSDK(authData, userProfile);
    if (result.code === 0) {
        console.log('SDK初始化成功');
    }
} catch (error) {
    console.error('SDK初始化失败:', error);
}

```

### 创建会话

使用 createConversation 创建会话。

```typescript
const customAgentConfig = {
    agentTemplateId: "xiaozhi",
    intro: "一个小百科，上知天文下知地理。懂得如何陪伴人类，还会角色扮演。\n（标签：聪慧、机灵）",
    llm: {
        type: 'Doubao', 
        model: 'ep-20240806100628-6dfw7', 
        responseFormatType: 0, 
        responseMessageName: ''
    },
    name: "小智",
    sex: "女",
    source: "Zego",
    system: "你是小智，成年女性，是**即构科技创造的陪伴助手**，上知天文下知地理，聪明睿智、热情友善。\n对话要求：1、按照人设要求与用户对话。\n2、不能超过100字。 ",
    tts: {
        type: 'Huoshan', 
        voice: 'BV700_streaming'
    },
    welcomeMessage: "嗨,我是你的新朋友小智!初次见面很开心。我呢,可以回答你的各种问题,给你工作学习上提供帮助,还能随时陪你聊天。嗯,你想问点什么呢?",
};

// 创建会话
try {
    const createResult = await AIAgent.createConversation(customAgentConfig);
    if (createResult.code === 0 && createResult.conversation) {
        const conversationID = createResult.conversation.conversationID;
        console.log('会话创建成功，会话ID:', conversationID);
    }
} catch (error) {
    console.error('会话创建失败:', error);
}
```
### 实现 AI 语音互动
用户登录房间后，需要推流自己的语音。可以调用 startChat 接口，启动语音互动。需要用户自行监听 RTC 流新增回调去拉取 AI Agent 的流，然后通过语音互动功能实现语音聊天。

```typescript
let publishStreamId = 'YOUR_PUBLISH_STREAM_Id';// 推流自己语音的流Id
let pullStreamId = 'YOUR_PULL_STREAM_Id';// 需要拉流的流Id
let conversationId = 'YOUR_CONVERSATION_Id';// 要启动的会话Id
let roomId = 'YOUR_ROOM_Id';// 要登录的房间Id
let token = 'YOUR_TOKEN';// 登录房间的 Token
let user = {
    userID: 'your_user_id',
    userName: 'your_user_name'
};

// 1. 用户需要登录房间
await zg.loginRoom(roomId, token, user);

// 2. 登录成功后，用户需要音频推流
 const custom = {
    camera: {
        video: false,
        audio: {
            ANS: true,
            AGC: true,
            AEC: true,
        },
    },
};

const localAudioStream = await zg.createZegoStream(custom);
zg.startPublishingStream(
    publishStreamId,
    localAudioStream
);
// 3. 监听 RTC 流新增事件
zg.on("roomStreamUpdate",  async (roomId, updateType, streamList) => {
    if (updateType === "ADD") {
        if (activeConversationID) {
            // 遍历 streamList，只有当流 ID 匹配时才播放
            for (const stream of streamList) {
                if (stream.streamID === pullStreamId) {
                    // 播放流
                    playRemoteStream(pullStreamId);
                    break;
                }
            }
        }
    }
});

async playRemoteStream(streamId, isMetaHuman) {
    try {
        const remoteStream = await zg.startPlayingStream(streamId, {
            playoutDelayHint: 0.5,
        });

        if (!remoteStream) {
            throw new Error("remoteStream is undefined");
        }

        const remoteView = zg.createRemoteStreamView(remoteStream);
        remoteView.play(document.createElement("div"),{enableAutoplayDialog: true,}
        );
    } catch (error) {
        console.error("Failed to play remote stream:", error);
        throw error;
    }
}
// 4. 开始语音聊天
const voiceChatOptions = {
    conversationId: conversationId,  // 会话Id
    roomId: roomId,                  // 房间Id
    userStreamId: publishStreamId,   // 用户流Id
    agentStreamId: pullStreamId,     // 智能体流Id
    chatMode: 0                      // 聊天模式：语音
};

try {
    const startResult = await AIAgent.startChat(voiceChatOptions);
    if (startResult.code === 0) {
        console.log('语音聊天开始成功');
    }
} catch (error) {
    console.error('开始语音聊天失败:', error);
}

```
### 结束会话
调用 stopChat 接口，结束语音互动。
```typescript
try {
    const stopResult = await AIAgent.stopChat(conversationId);
    if (stopResult.code === 0) {
        // 停止拉流
        zg.stopPlayingStream(pullStreamId);
        // 退出房间
        zg.logoutRoom();
    }
} catch (error) {
    console.error('结束聊天失败:', error);
}

```