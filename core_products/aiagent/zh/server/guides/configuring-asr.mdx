# 配置 ASR

---

## 功能简介

为了提高不同场景下语音识别（或语音转文字）的识别准确率，可以通过以下方式实现：
- 选择合适厂商/识别模型：支持腾讯 ASR、阿里百炼 Paraformer、百阿里炼 Gummy、微软等
- 选择合适语种: 默认腾讯、阿里百炼模型为中文识别，微软为英文识别。
- 设置识别热词：在特定的场景下，通常存在一些专用词汇，例如角色名、用户名、功能名称等，可以在创建智能体实例时设置临时热词，提高语音识别的准确率。

## 前提条件

目前腾讯为默认开通并支持的语音识别厂商。若需要阿里、微软等识别厂商，请联系 ZEGO 商务开通。

## 使用方式

目前可通过4个接口设置 ASR 相关参数：
| 接口                                                                                                                                                                                                                        | 说明                                                                                                                                                                                                                |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [注册智能体](/aiagent-server/api-reference/agent-configuration-management/register-agent)                                                                                                                                   | 设置厂商、热词、语种等参数。                                                                                                                                                                                        |
| [创建语音智能体实例](/aiagent-server/api-reference/agent-instance-management/create-agent-instance)<br/>[创建数字人智能体实例](/aiagent-server/api-reference/agent-instance-management/create-digital-human-agent-instance) | 设置厂商、热词、语种等参数。<br/><Note title="说明">如果不设置，默认会使用注册 Agent 智能体（[RegisterAgent](/aiagent-server/api-reference/agent-configuration-management/register-agent)）携带的 ASR 参数。</Note> |
| [修改智能体实例](/aiagent-server/api-reference/agent-instance-management/update-agent-instance)                                                                                                                             | <Warning title="注意">支持修改热词和语种。其他参数请联系技术支持确认。</Warning>                                                                                                                                                                |

## ASR 参数说明 <a id="asr-params" />

| 参数                   | 类型   | 是否必选 | 描述                                                                                                                                                                                                                                  |
| ---------------------- | ------ | -------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Vendor                 | String | 否       | ASR 供应商，默认为 Tencent：<ul><li>Tencent: 腾讯</li><li>AliyunParaformer: 阿里云 Paraformer</li><li>AliyunGummy: 阿里云 Gummy</li><li>Microsoft: 微软 ASR</li></ul>                                                                 |
| ~HotWord~              | String | 否       | 该参数已废弃。<br/>请通过 Params 扩展参数设置，具体使用方式参考下面各厂商的热词设置说明。                                                                                                                                             |
| Params                 | Object | 否       | 厂商参数，具体使用方式参考下面各厂商的参数设置说明。                                                                                                                                                                                  |
| VADSilenceSegmentation | number | 否       | 用于设置用户说话停顿多少毫秒后，不再将两句话视为一句。范围 [200，2000]，默认为 500。详细说明请参考[语音识别断句](/aiagent-server/advanced/speech-segmentation-control)。                                                              |
| PauseInterval          | number | 否       | 用于设置用户说话停顿多少毫秒内，将两句话视为一句，即 ASR 多句拼接。范围 [200，2000]。仅当此值大于 VADSilenceSegmentation，才会开启 ASR 多句拼接。详细说明请参考[语音识别断句](/aiagent-server/advanced/speech-segmentation-control)。 |

各厂商的 Params 参数说明如下：

<Tabs titleSize="h3">
<Tab title="腾讯">

腾讯云详细参数说明请查看：[腾讯云-实时语音识别](https://cloud.tencent.com/document/product/1093/48982) > 接口调用流程 > 握手阶段 > 参数说明。

#### 设置热词

仅支持通过临时热词表来设置参数。详细请查看 [腾讯云-实时语音识别](https://cloud.tencent.com/document/product/1093/48982#835304ab-3b0b-487e-9daa-08f7086b4fdf) `hotword_list` 参数详细说明。

单个热词限制："热词|权重"，单个热词不超过30个字符（最多10个汉字），权重[1-11]，如：“即构科技|5” 或 “ASR|11”；
临时热词表限制：多个热词用英文逗号分割，最多支持128个热词，如：“即构科技|10,实时互动|5,ASR|11”；

注意：
1. 热词权重设置为 11 时，当前热词将升级为超级热词，建议仅将重要且必须生效的热词设置到 11 ，设置过多权重为 11 的热词将影响整体字准率。
2. 热词不能包含空格，如：`即构科技 实时互动`

#### 设置语种

请查看[腾讯云-实时语音识别](https://cloud.tencent.com/document/product/1093/48982#835304ab-3b0b-487e-9daa-08f7086b4fdf) `engine_model_type` （引擎模型类型）参数详细说明。默认值为 `16k_zh` ，中文通用。
<Accordion title="支持的引擎模型类型详细列表" defaultOpen="false">
- 16k_zh：中文通用；
- 16k_zh-PY：中英粤；
- 16k_zh-TW：中文繁体；
- 16k_zh_edu：中文教育；
- 16k_zh_medical：中文医疗；
- 16k_zh_court：中文法庭；
- 16k_yue：粤语；
- 16k_en：英文通用；
- 16k_en_game：英文游戏；
- 16k_en_edu：英文教育；
- 16k_zh_en：中英粤+7种方言大模型引擎【大模型版】。当前模型同时支持中文、英语、粤语、四川、陕西、河南、上海、湖南、湖北和安徽方言识别，模型参数量极大，语言模型性能增强，针对噪声大、回音大、人声小、人声远等低质量音频的识别准确率极大提升;
- 16k_ko：韩语；
- 16k_ja：日语；
- 16k_th：泰语；
- 16k_id：印度尼西亚语；
- 16k_vi：越南语；
- 16k_ms: 马来语；
- 16k_fil: 菲律宾语；
- 16k_pt：葡萄牙语；
- 16k_tr：土耳其语；
- 16k_ar：阿拉伯语；
- 16k_es: 西班牙语；
- 16k_hi: 印地语；
- 16k_fr：法语；
- 16k_de：德语；
</Accordion>

#### 使用示例

以下为设置 “zego” 为热词、语种为英文的示例。

<CodeGroup>
```json RegisterAgent
// !mark(7:8)
{
    "AgentId": "xiaozhi",
    "Name": "小智",
    "ASR": {
        "Vendor": "Tencent",
        "Params": {
            "engine_model_type": "16k_en",
            "hotword_list": "zego|10"
        }
    },
    "LLM": {
        "Url": "https://ark.cn-beijing.volces.com/api/v3/chat/completions",
        "ApiKey": "zego_test",
        "Model": "zego_test",
        "SystemPrompt": "你是小智，成年女性，是**即构科技创造的陪伴助手**，上知天文下知地理，聪明睿智、热情友善。\n对话要求：1、按照人设要求与用户对话。\n2、不能超过100字。"
    },
    "TTS": {
        "Vendor": "Bytedance",
        "Params": {
            "app": {
                "appid": "zego_test",
                "token": "zego_test",
                "cluster": "volcano_tts"
            },
            "audio": {
                "voice_type": "zh_female_qingxinnvsheng_mars_bigtts"
            }
        }
    }
}
```

```json CreateAgentInstance
// !mark(13:14)
{
    "AgentId": "xiaozhi",
    "UserId": "user_1",
    "RtcInfo": {
        "RoomId": "room_1",
        "AgentStreamId": "agent_stream_1",
        "AgentUserId": "agent_user_1",
        "UserStreamId": "user_stream_1"
    },
    "ASR": {
        "Vendor": "Tencent",
        "Params": {
            "engine_model_type": "16k_en",
            "hotword_list": "zego|10"
        }
    }
}
```
</CodeGroup>

</Tab>
<Tab title="阿里云百炼 Paraformer">
详细参数说明请查看：[阿里云百炼 Paraformer 实时语音识别](https://help.aliyun.com/zh/model-studio/websocket-for-paraformer-real-time-service?spm=a2c4g.11186623.help-menu-2400256.d_2_6_3_0_2.57b22440ixCBox&scm=20140722.H_2856047._.OR_help-T_cn~zh-V_1#519eb48f0ewv8) > 指令（客户端→服务端） > run-task指令：开启任务 > payload参数说明。

#### 设置热词
<Warning title="注意">目前暂不支持设置阿里云 Paraformer 模型热词</Warning>

#### 设置语种

通过 `payload.parameters.language_hints` 参数设置语种。如果无法提前确定语种，可不设置，模型会自动识别语种。详情请参考百炼 Paraformer 参数说明。

<Accordion title="支持的语言代码列表" defaultOpen="false">
- zh: 中文
- en: 英文
- ja: 日语
- yue: 粤语
- ko: 韩语
- de：德语
- fr：法语
- ru：俄语
</Accordion>

#### 使用示例

以下为设置语种为英文的示例。

<CodeGroup>
```json RegisterAgent
// !mark(7:14)
{
    "AgentId": "xiaozhi",
    "Name": "小智",
    "ASR": {
        "Vendor": "AliyunParaformer",
        "Params": {
            "payload": {
                "model": "paraformer-realtime-v2",
                "parameters": {
                    "language_hints": [
                        "en"
                    ]
                }
            }
        }
    },
    "LLM": {
        "Url": "https://ark.cn-beijing.volces.com/api/v3/chat/completions",
        "ApiKey": "zego_test",
        "Model": "zego_test",
        "SystemPrompt": "你是小智，成年女性，是**即构科技创造的陪伴助手**，上知天文下知地理，聪明睿智、热情友善。\n对话要求：1、按照人设要求与用户对话。\n2、不能超过100字。"
    },
    "TTS": {
        "Vendor": "Bytedance",
        "Params": {
            "app": {
                "appid": "zego_test",
                "token": "zego_test",
                "cluster": "volcano_tts"
            },
            "audio": {
                "voice_type": "zh_female_qingxinnvsheng_mars_bigtts"
            }
        }
    }
}
```

```json CreateAgentInstance
// !mark(13:20)
{
    "AgentId": "xiaozhi",
    "UserId": "user_1",
    "RtcInfo": {
        "RoomId": "room_1",
        "AgentStreamId": "agent_stream_1",
        "AgentUserId": "agent_user_1",
        "UserStreamId": "user_stream_1"
    },
    "ASR": {
        "Vendor": "AliyunParaformer",
        "Params": {
            "payload": {
                "model": "paraformer-realtime-v2",
                "parameters": {
                    "language_hints": [
                        "en"
                    ]
                }
            }
        }
    }
}
```
</CodeGroup>
</Tab>
<Tab title="阿里云百炼 Gummy">
详细参数说明请查看：[阿里云百炼 Gummy 实时语音识别](https://help.aliyun.com/zh/model-studio/real-time-websocket-api?spm=a2c4g.11186623.help-menu-2400256.d_2_6_4_0_2.20693613UcHYB7&scm=20140722.H_2869339._.OR_help-T_cn~zh-V_1#7409babe31tp1) > WebSocket客户端编程与消息处理 > 给服务器发送消息 > payload参数说明。

#### 设置热词
<Warning title="注意">目前暂不支持设置阿里云 Gummy 模型热词</Warning>

#### 设置语种
通过 `payload.parameters.source_language` 参数设置语种。如果无法提前确定语种，可不设置，模型会自动识别语种。详情请参考百炼 Gummy 参数说明。

<Accordion title="支持的语言代码列表" defaultOpen="false">
- zh: 中文
- en: 英文
- ja: 日语
- yue: 粤语
- ko: 韩语
- de: 德语
- fr: 法语
- ru: 俄语
- it: 意大利语
- es: 西班牙语
</Accordion>

#### 使用示例

以下为设置语种为英文的示例。

<CodeGroup>
```json RegisterAgent
// !mark(7:12)
{
    "AgentId": "xiaozhi",
    "Name": "小智",
    "ASR": {
        "Vendor": "AliyunGummy",
        "Params": {
            "payload": {
                "model": "gummy-realtime-v1",
                "parameters": {
                    "source_language": "en"
                }
            }
        }
    },
    "LLM": {
        "Url": "https://ark.cn-beijing.volces.com/api/v3/chat/completions",
        "ApiKey": "zego_test",
        "Model": "zego_test",
        "SystemPrompt": "你是小智，成年女性，是**即构科技创造的陪伴助手**，上知天文下知地理，聪明睿智、热情友善。\n对话要求：1、按照人设要求与用户对话。\n2、不能超过100字。"
    },
    "TTS": {
        "Vendor": "Bytedance",
        "Params": {
            "app": {
                "appid": "zego_test",
                "token": "zego_test",
                "cluster": "volcano_tts"
            },
            "audio": {
                "voice_type": "zh_female_qingxinnvsheng_mars_bigtts"
            }
        }
    }
}
```

```json CreateAgentInstance
// !mark(13:18)
{
    "AgentId": "xiaozhi",
    "UserId": "user_1",
    "RtcInfo": {
        "RoomId": "room_1",
        "AgentStreamId": "agent_stream_1",
        "AgentUserId": "agent_user_1",
        "UserStreamId": "user_stream_1"
    },
    "ASR": {
        "Vendor": "AliyunGummy",
        "Params": {
            "payload": {
                "model": "gummy-realtime-v1",
                "parameters": {
                    "source_language": "en"
                }
            }
        }
    }
}
```
</CodeGroup>
</Tab>
<Tab title="微软">

<Warning title="注意">微软当前仅支持设置 `phrase_list` 和 `language` 参数。</Warning>

#### 设置短语列表

短语列表是预先提供的单词或短语列表，可帮助改进其识别能力。 添加到短语列表的短语具有较高的重要性，从而更有可能被识别。
可通过 `phrase_list` 参数设置短语列表。详细说明请参考[微软 - 使用短语列表提高识别准确度](https://learn.microsoft.com/zh-cn/azure/ai-services/speech-service/improve-accuracy-phrase-list?tabs=terminal&pivots=programming-language-python)。

<Note title="说明">允许的字符包括特定于区域设置的字母和数字、空格字符以及特殊字符，例如 +、-、$、:、(, )、\{, \}、_、,、?、@、\、’、&、#、%、^、*、`、\<、\>、;、/。 将从短语内部删除其他特殊字符。</Note>

#### 设置语种
可通过 `language` 参数设置语种。详细说明请参考[微软 - 对语音服务的语言和语音支持](https://learn.microsoft.com/zh-cn/azure/ai-services/speech-service/language-support?tabs=stt)。

#### 使用示例

以下为设置“zego”为短语列表、语种为英文的示例。

<CodeGroup>
```json RegisterAgent
// !mark(7:10)
{
    "AgentId": "xiaozhi",
    "Name": "小智",
    "ASR": {
        "Vendor": "Microsoft",
        "Params": {
            "language": "en-US",
            "phrase_list": [
                "zego"
            ]
        }
    },
    "LLM": {
        "Url": "https://ark.cn-beijing.volces.com/api/v3/chat/completions",
        "ApiKey": "zego_test",
        "Model": "zego_test",
        "SystemPrompt": "你是小智，成年女性，是**即构科技创造的陪伴助手**，上知天文下知地理，聪明睿智、热情友善。\n对话要求：1、按照人设要求与用户对话。\n2、不能超过100字。"
    },
    "TTS": {
        "Vendor": "Bytedance",
        "Params": {
            "app": {
                "appid": "zego_test",
                "token": "zego_test",
                "cluster": "volcano_tts"
            },
            "audio": {
                "voice_type": "zh_female_qingxinnvsheng_mars_bigtts"
            }
        }
    }
}
```

```json CreateAgentInstance
// !mark(13:16)
{
    "AgentId": "xiaozhi",
    "UserId": "user_1",
    "RtcInfo": {
        "RoomId": "room_1",
        "AgentStreamId": "agent_stream_1",
        "AgentUserId": "agent_user_1",
        "UserStreamId": "user_stream_1"
    },
    "ASR": {
        "Vendor": "Microsoft",
        "Params": {
            "language": "en-US",
            "phrase_list": [
                "zego"
            ]
        }
    }
}
```
</CodeGroup>
</Tab>
</Tabs>

