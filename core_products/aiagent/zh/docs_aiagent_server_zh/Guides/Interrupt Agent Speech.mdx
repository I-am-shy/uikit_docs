# 打断智能体说话

在不同场景下，需要支持不同的方式来打断智能体说话。目前支持两种打断形式，且两种打断组合使用

| 打断方式 | 打断说明                                                                                                                                                                                                                                       |
| -------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 语音打断 | 若开启语音打断，则智能体正在说话时，持续监听用户说话状态及识别说话内容，若用户开始说话，则会打断停止智能体说话（停止本轮LLM请求、TTS请求），并开始下一轮回答。若关闭语音打断，则直到智能体说话结束，才开始下一轮：监听用户说话状态及说话内容，并开始回答。 |
| 手动打断 | 通过 API ，即可直接打断智能体本轮内容                                                                                                                                                                                                                |

## 常见场景


| 语音通话模式                 | 打断组合                          | 常见场景                                                             |
| ---------------------------- | --------------------------------- | -------------------------------------------------------------------- |
| 自然语音聊天                 | ✅开启语音打断<br/>❌不用手动打断 | AI虚拟陪聊<br/>AI智能对话语音助手<br/>AI客服                         |
| Push - to - talk的对讲机模式 | ❌关闭语音打断<br/>✅使用手动打断 | 异常嘈杂的展会环境<br/>研讨会中短暂发言<br/>狼人杀等有规定时间的发言 |

## 设置打断模式

在[创建智能体实例](./../API%20reference/Agent%20Instance%20Management/Create%20Agent%20instance.mdx)时可通过设置 `AdvancedConfig.InterruptMode` 参数控制打断模式。


| 参数         | 类型 | 必填 | 描述                                                                 |
|----------------|------|------|----------------------------------------------------------------------|
| InterruptMode  | Int  | 否   | 智能体回复时被用户语音打断的模式：<br/>- 0: 语音打断<br/>- 1: 语音不打断（AI输出（TTS播放完成）后开启ASR） |

### 设置为语音打断

将 `AdvancedConfig.InterruptMode` 设置为 0 或者不设置这个参数，那么智能体在说话时用户也可以随时说话打断智能体。

### 手动打断

将 `AdvancedConfig.InterruptMode` 设置为 1 ，调用打断智能体实例状态接口（[InterruptAgentInstance](./../API%20reference/Agent%20Instance%20Control/Interrupt%20Agent%20Instance.mdx)）时传入[创建智能体实例](./../API%20reference/Agent%20Instance%20Management/Create%20Agent%20instance.mdx)接口返回的 `AgentInstanceId`，

## 获取智能体被打断的事件通知

请按[接收回调](./../Callbacks/Receiving%20Callback.mdx)文档指引设置好回调。当智能体被语音打断或者手动打断时，回调方法都会收到相关的事件通知。内容示例如下：

```json {7}
{
    "AppId": 123456789,
    "Nonce": "abcdd22113",
    "Timestamp": 1747033950524，
    "Sequence": 1921825797275873300,
    "Signature": "XXXXXXX",
    "Event": "Interrupted",
    "RoomId": "90000001237",
    "AgentInstanceId": "1921825671047294976",
    "AgentUserId": "apitest689_agent",
    "Data": {
        "Round": 1481651956,
        "Reason": 1
    }
}
```

其中被打断的 `Reason` 可以参考以下定义：


| 参数   | 类型    | 描述                                                                 |
|----------|---------|----------------------------------------------------------------------|
| Reason   | Int32   | 被打断的原因：<br/>1: 用户讲话<br/>2: 自定义调用LLM接口<br/>3: 自定义调用TTS接口<br/>4: 打断智能体实例接口 |