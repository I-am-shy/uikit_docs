
# 自定义 LLM System 回调

- - -

## 描述

凭借本回调，您可以自定义本轮对话的 LLM System（即智能体的系统提示 Prompt），通常用于针对用户本轮对话的问题进行 RAG（Retrieval-Augmented Generation，检索增强生成） 处理。

<Note title="说明">
仅当创建会话时 `ChatConfig` 下的 `LLMSystemMode` 不为 0 时，才会触发本回调事件。
</Note>

## 回调说明

- 请求方法：POST。
- 请求地址：请联系 ZEGO 技术支持配置。
- 传输协议：HTTPS/HTTP，建议使用 HTTPS。

## 回调参数

| 参数 | 类型 | 描述 |
|------|------|------|
| AppId | Number | ZEGO 给开发者 APP 的唯一标识。 |
| Nonce | String | 随机数，用于检验串计算。 |
| Timestamp | Number | 发送时的 Unix 时间戳（秒），用于检验串计算。 |
| Signature | String | 检验串，验证发送方身份。 |
| RequestId | String | 请求唯一 ID。 |
| ConversationId | String | 会话的唯一标识。 |
| Round | Number | <p>对话轮次，每次用户主动说话，轮次都会增加（有序，非递增）。</p><p>您可以基于对话轮次处理打断逻辑，例如：</p><ul><li>t1：`Round` 为 `1`，业务方处理回调流程 `P1`，尚未返回结果 `R1`</li><li>t2：`Round` 为 `2`，业务方处理回调 `P2`，并返回结果 `R1`，ZEGO AI Agent 服务端不会处理，仅会处理本次 `P2` 的结果 `R2`</li></ul><ol><li>当您收到 `Round` 为 1 的回调时，若您未提供 `System` 应答此回调。</li><li>随即，在您收到 `Round` 为 2 的回调时，您才提供 `System` 应答上一个回调。</li><li>此时， ZEGO AI Agent 服务器不会处理该应答。</li></ol> |
| ASRText | String | 自动语音识别文本。 |

## 回调示例

```json
{
    "AppId": 1234567,
    "Nonce": "350176",
    "Timestamp": 14976978,
    "Signature": "signature",
    "RequestId": "req_1234567",
    "ConversationId": "cid_1234567",
    "Round": 2,
    "ASRText": "你好，今天天气怎么样？"
}
```

## 应答参数

| 参数 | 类型 | 描述 |
|------|------|------|
| System | String | 自定义本轮对话的 LLM System。<ul><li>当创建会话时，`ChatConfig` 下的 `LLMSystemMode` 为 1，若此参数为空，则不进行第二次 LLM 处理。</li><li>当创建会话时，`ChatConfig` 下的 `LLMSystemMode` 为 2，若此参数为空，则使用创建会话时设置的 `System`。</li></ul>|

## 应答示例

```json
{
    "System": "这是一条自定义的Prompt。"
}
```

## 返回响应

收到回调后，如果您的服务器返回的 HTTP status code 为 2XX （例如 200），表示成功；返回其他，表示失败。

## 回调重试策略

如果 ZEGO 服务器在 5s 内没有收到响应，或收到的 HTTP status code 不为 2XX（例如 200），都会尝试重试，最多进行 3 次重试。每次重试请求与上一次请求的间隔时间为 2s。若第 3 次重试后仍然失败，将不再重试，该请求丢失。
