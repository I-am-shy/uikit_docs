---
articleID: 11937
---
# 音量变化

- - -

## 功能简介

在 K 歌场景中，经常需要拉多路流并显示其中正在讲话的用户，ZEGO 提供了甄别用户是否说话、说话音量大小（音浪）的能力，方便开发者做 UI 展示，例如：

<img src="/Pics/Android/ZegoLiveRoom/SoundLevel.png" width=50%>

## 示例源码下载

请参考 [下载示例源码](!DownloadDemo/DownloadDemo) 获取源码。

相关源码请查看 “src/Examples/AdvancedAudioProcessing/SoundLevelAndAudioSpectrum” 文件。

## 前提条件

在监听音量变化功能之前，请确保：

@@@Express_Video_Prerequisites_Web@@@


## 非混流场景使用步骤

1. 监听音浪回调接口，注册 [soundLevelUpdate|_blank](@soundLevelUpdate) 回调，接收流音量大小的变化。

    <div class="mk-hint">

    音浪即某条流音量的大小。 
    </div>

    ```javascript
    zg.on('soundLevelUpdate', (streamList) => {
        streamList.forEach(stream => {
            stream.type == 'push' && $('#soundLevel').html(Math.round(stream.soundLevel) + '');
            console.warn(`${stream.type} ${stream.streamID}, soundLevel: ${stream.soundLevel}`);
        });
    });
    ```


2. 启动音浪监听，调用 [setSoundLevelDelegate|_blank](@setSoundLevelDelegate) 接口启动监听音量大小，设置音浪回调间隔时间，单位为 ms。

    ```javascript
    zg.setSoundLevelDelegate(true, 1000);
    ```

3. 停止音浪监听，调用 [setSoundLevelDelegate|_blank](@setSoundLevelDelegate) 接口停止监听音量大小。

    ```javascript
    zg.setSoundLevelDelegate(false);
    ```

## 混流场景使用步骤

1. 调用 [startMixerTask|_blank](@startMixerTask) 时，需进行混流配置 [ZegoMixStreamConfig|_blank](@-ZegoMixStreamConfig)，需要将 `enableSoundLevel` 配置为 true，并为 [inputList|_blank](@inputList) 配置`soundLevelID`，详情请参考 [混流|_blank](!Other_Functions/Mixer)。
    ```
    const mixConfig = {
        "taskID": "custom-task",
        "enableSoundLevel": true,
        "inputList": [
            {
                "streamID": streamID1,
                "soundLevelID": soundLevelID1,
                "layout": {
                    "top": 0,
                    "left": 0,
                    "bottom": 200,
                    "right": 200
                }
            },
            {
                "streamID": streamID2,
                "soundLevelID": soundLevelID2,
                "layout": {
                    "top": 200,
                    "left": 200,
                    "bottom": 400,
                    "right": 400
                }
            }
        ],
        "outputList": [
            "custom-mixwebrtc-1"
        ],
        "outputConfig": {
            "outputBitrate": 300,
            "outputFPS": 15,
            "outputWidth": 400,
            "outputHeight": 400
        }
    }
    zg.startMixerTask(mixConfig);
    ```
2. 调用 [mixerSoundLevelUpdate|_blank](@mixerSoundLevelUpdate) 接口监听混流音量变化。
    ```
    zg.on("mixerSoundLevelUpdate", (mixMap, id) => {
        console.warn("mixerSoundLevelUpdate", mixMap, id);
      });
    ```
3. 根据混流 streamID 拉流，若需要获取混流音量值，需要开启 SEI，详情请参考 [媒体补充增强信息（SEI）|_blank](!Other_Functions/SEI)。
    <div class="mk-warning">

    根据混流 streamID 拉流功能不是默认开启的，使用前请在 [ZEGO 控制台](https://console.zego.im) 自助开通（开通步骤请参考 [服务配置 - 混流](#14214)），或联系 ZEGO 技术支持开通。
    </div>

    ```
    // 拉流
    zg.startPlayingStream(mixStreamID, {
        // 开启解析 SEI
        isSEIStart: true 
    }).then(stream => {

    }).catch(err => {

    });
    ```
