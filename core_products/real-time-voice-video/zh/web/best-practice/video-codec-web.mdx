---
articleID: 12062
---
# 视频编码格式选择

- - -

## 概览
ZEGO Express WEB SDK 使用 WebRTC 作为音视频数据传输协议 ，其中视频编码支持 H.264 和 VP8 两种格式，阅读本文能帮助您更好的了解：不同编码格式优劣势，并根据业务场景选择适合的编码格式;

## 兼容性说明
2011 年 谷歌收购 GIPS，WebRTC 项目诞生;<br/>
2017 年 11 月 2 日 / W3C WebRTC 1.0 草案正式定稿;<br/>
2021 年 1  月 26 日 / 发布为正式标准;<br/>

WebRTC 协议最早由 google 牵头，经过漫长岁月沉淀和优化，今年已成为 W3C 正式标准； 早在草案阶段,主流浏览器就开始提供 WebRTC 支撑；虽然 W3C 划定了 WebRTC 协议和接口标准，但具体到不同浏览器上，实现方式和策略则有所不同，偏重的编码方案也会有不同；<br/>

开始音视频业务前，使用 ZEGO Express SDK 提供的兼容性检测接口， 对浏览器环境和设备做检测，并提示风险，无论选择哪种编码，对绝大多数用户影响并不大；不同编码格式对比如下：

| 名称 | 优势 | 劣势 |
|------|------|------|
| H.264 | • 配套生态成熟，可直接转推 CDN，以及直接和小程序互通 | • 在移动端浏览器上支持度稍差，例如微信浏览器，WebWiew 等 |
| VP8 | • google 主推，Chrome 上表现优于 H.264, 且完全开源<br/>• 在移动端浏览器上兼容性更好，例如微信浏览器，WebWiew 等 | • 配套较差，不可直接转推 CDN，不可直接和小程序互通 |

### 浏览器支持度

#### 桌面端
| 系统 | 浏览器 | H.264 | VP8 |
|------|--------|-------|-----|
| Windows | • Chrome<br/>• Edge<br/>• Firefox | 支持 | 支持 |
| macOS | • Chrome<br/>• Safari<br/>• Edge<br/>• Firefox | 支持 | 支持 |
| ChromeOS | • Chrome | 支持 | 支持 |

#### 已知限制：
##### Chrome
- 在所有使用 AMD 芯片和部分使用 Intel 芯片的 Windows 设备上，Chrome 使用 H.264 编码时，发送码率可能达不到设定值。你可以使用 VP8 编码或者尝试关闭硬件加速。
- macOS 上 Chrome 84 存在缺陷，采用 H.264 格式进行编码时， WebRTC 有概率出现帧率突然下降导致图像卡顿。详见 Google 官方说明 [Issue 1088650](https://bugs.chromium.org/p/chromium/issues/detail?id=1203206&can=2&q=webrtc%20drop%20component%3ABlink%3EWebRTC%3EVideo) 和 [Issue 12704](https://bugs.chromium.org/p/webrtc/issues/detail?id=12704#c3)。建议你在 macOS 上 Chrome 84 及以后版本中使用 VP8 ，直至 Google 修复该缺陷。
- Safari 12.1 及之前版本仅支持 H.264 编解码。
Firefox
在使用 Apple M1 芯片的 Mac 设备上 Firefox 不支持 H.264 编解码，详见 Firefox 官方说明。

#### 移动端
##### Android
Android 支持自研 WebWiew 或引入第三方 WebWiew，不同设备、不同应用的 WebWiew 可能实现不同，因此对 Web SDK 的支持与应用版本和设备硬件有关，如微信,企业微信，钉钉，头条等，推荐在使用前做兼容性检测。

| 浏览器 | H.264 | VP8 |
|--------|-------|-----|
| Chrome 浏览器 | 支持 | 支持 |
| 微信 | 支持 | 支持 |

##### 已知限制
- 在搭载联发科芯片的设备上无法使用 H.264 编码发送视频流。
- 在 Android Chrome 88 以下版本，搭载华为海思麒麟芯片的设备无法使用 H.264 编码发送视频流。
- 使用 H.264 编码发送视频流可能会导致发送视频流码率偏低，无法达到预期码率。
- 在 Android Chrome 81 以下版本，搭载联发科和华为海思麒麟芯片的设备无法使用 H.264 解码接收视频流。由于ZEGO Native SDK 发送的视频流默认为 H.264 编码，所以如果房间内有推流端使用 ZEGO Native SDK ，在使用华为海思麒麟或联发科芯片的设备上 Web SDK 接收 H.264 流必须使用 Chrome 81 或以上版本。

#### iOS
iOS 只支持系统 WebWiew，因此对 Web SDK 的支持只与 iOS 系统版本有关。

| 浏览器 | 功能 | H.264 | VP8 |
|--------|------|-------|-----|
| WebWiew | 推流 | iOS 14.3 及以后版本 | iOS 14.3 及以后版本 |
| WebWiew | 拉流 | iOS 12.1.4 及以后版本 | iOS 12.2 及以后版本 |
| Safari 浏览器 | 推/拉流 | iOS 11 及以后版本 | iOS 12.2 及以后版本 | 

#### 已知限制
- 在 iOS 上使用 H.264 编码发流，无法推送 1080P 及以上分辨率的视频到 CDN。

## 推荐方案
综合上述兼容性说明，以及 ZEGO 市场用户数据统计，不支持 VP8 的设备占比极少，VP8 在浏览器上兼容性略优于 H.264。可得出以下基本原则：
- Web 端场景为主情况，优先使用 VP8
- 在不考虑转推 CDN 和小程序互通情况下，优先使用 VP8 编码；
- 不管选择 H.264 还是 VP8 ，都要先对使用环境做检测，[点击查看兼容性检测接口](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~javascript_web~class~ZegoExpressEngine#check-system-requirements)


### 转码方案
因业务场景需要（需和小程序互通或大量转推CDN需求等），选择了 H.264 编码，同时期望在不支持 H.264 的环境下正常使用，可在业务层进一步兼容；

##### 不支持 H.264 但支持 VP8
可通过混流接口转码一条 VP8 编码格式的流， 混流需联系ZEGO打开配置；
若需推流：推 VP8 再转一条 H.264, 拉流端拉 H.264 的流；
若需拉流：转一条VP8, 再拉VP8的流

##### 不支持 H.264 也不支持 VP8，但支持 CDN 拉流
可采用 CDN 拉流，[点击查看CDN方案](/real-time-video-web/live-broadcast-capability/relay-to-cdn)；
