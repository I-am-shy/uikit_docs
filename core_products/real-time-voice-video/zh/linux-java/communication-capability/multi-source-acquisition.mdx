# 多源采集

- - -
## 功能简介

@@@Multi_source_acquisition_info@@@

## 示例源码

请参考 [下载示例源码](!DownloadDemo/DownloadDemo) 获取源码。

相关源码请查看 “/ZegoExpressExample/Others/src/main/java/com/example/others/multivideosource” 目录下的文件。

## 前提条件

在使用多源采集功能之前，请确保：

@@@Express-Video_Prerequisites@@@

## 实现流程

<div class="mk-warning">


实时语音产品仅支持设置音频采集源。
</div>

### 1 创建 ZegoExpressEngine 引擎

创建 ZegoExpressEngine 引擎流程，请参考实现视频通话的 [3.2 创建引擎](!Integration/Solution_Implementation#3_2)。

```Java
// 创建 ZegoExpress 实例，监听常用事件
    void createEngine() {
        // 创建引擎，通用场景接入，并注册 self 为 eventHandler 回调
        // 不需要注册回调的话，eventHandler 参数可以传 null，后续可调用 "setEventHandler:" 方法设置回调
        ZegoEngineProfile profile = new ZegoEngineProfile();
        profile.appID = appID;  // 请通过官网注册获取，格式为：1234567890L
        profile.appSign = appSign; //请通过官网注册获取，格式为：@"0123456789012345678901234567890123456789012345678901234567890123"（共64个字符）
        profile.scenario = ZegoScenario.BROADCAST;  // 指定使用直播场景 (请根据实际情况填写适合你业务的场景)
        profile.application = getApplication();
        engine = ZegoExpressEngine.createEngine(profile, null);
    }
```

### 2 设置音视频采集源

1. 调用 [setVideoSource](@setVideoSource) 接口设置视频采集源。

```java
/** 使用摄像头作为视频采集源 */
engine.setVideoSource(ZegoVideoSourceType.CAMERA);
```

<div class = 'mk-hint'>

- 如果需要使用自定义视频采集作为视频采集源，需设置视频采集源类型为 [ZegoVideoSourceTypeCustom](@ZegoVideoSourceTypeCustom)，调用 [enableCustomVideoCapture](@enableCustomVideoCapture) 接口设置要发送的视频帧数据类型，调用 [sendCustomVideoCaptureRawData](@sendCustomVideoCaptureRawData)，[sendCustomVideoCaptureTextureData](@sendCustomVideoCaptureTextureData) 或 [sendCustomVideoCaptureEncodedData](@sendCustomVideoCaptureEncodedData) 接口向 SDK 发送视频帧数据，详情请参考 [自定义视频采集](!ExpressVideoSDK-VideoAdvanced/CustomVideoCapture)。
- 如果需要使用媒体播放器作为视频采集源，需先调用 [createMediaPlayer](@createMediaPlayer) 接口创建媒体播放器，再通过调用 [setVideoSource](@setVideoSource) 接口设置视频采集源类型为 [ZegoVideoSourceTypePlayer](@ZegoVideoSourceTypePlayer) 和设置视频采集源所使用的媒体播放器实例索引，然后再使用刚创建的媒体播放器加载资源并播放，详情请参考 [媒体播放器](!Other_Functions/MediaPlayer) 。

</div>

2. 调用 [setAudioSource](@setAudioSource) 接口设置音频采集源。

```java
/** 使用麦克风作为音频采集源 */
engine.setAudioSource(ZegoAudioSourceType.MICROPHONE);
```

<div class = 'mk-hint'>

- 如果需要使用自定义音频采集作为音频采集源，需设置音频采集源类型为 [ZegoAudioSourceTypeCustom](@ZegoAudioSourceTypeCustom)，调用 [sendCustomAudioCaptureAACData](@sendCustomAudioCaptureAACData) 或 [sendCustomAudioCapturePCMData](@sendCustomAudioCapturePCMData) 等接口向 SDK 发送音频数据，详情请参考 [自定义音频采集与渲染](!AudioAdvanced/custom_audio_io)。
- 如果需要使用媒体播放器作为音频采集源，需设置音频采集源类型为 [ZegoAudioSourceTypeMediaPlayer](@ZegoAudioSourceTypeMediaPlayer)，调用 [createMediaPlayer](@createMediaPlayer) 接口创建媒体播放器，然后使用刚创建的媒体播放器加载资源并播放，详情请参考 [媒体播放器](!Other_Functions/MediaPlayer) 。

</div>

### 3 登录房间并推流

登录房间及推流流程，请参考实现视频通话的 [3.3 登录房间](!Integration/Solution_Implementation#3_3) 及 [3.4 推流](!Integration/Solution_Implementation#3_4) 。

### 4 （可选）切换音视频采集源

1. 调用 [setVideoSource](@setVideoSource) 接口切换视频采集源。

```java
/** 使用屏幕共享作为视频采集源 */
engine.setVideoSource(ZegoVideoSourceType.SCREEN_CAPTURE);
```

2. 调用 [setAudioSource](@setAudioSource) 接口切换音频采集源。

```java
/** 使用媒体播放器作为音频采集源 */
engine.setAudioSource(ZegoAudioSourceType.MEDIA_PLAYER);
```

### 5 结束推流

结束推流流程，请参考实现视频通话的 [3.6 停止推拉流](!Integration/Solution_Implementation#3_6)。

```java
// 停止推流
engine.stopPublishingStream();
```


##  常见问题

#### 1. **是否支持设置多个媒体播放器?**

支持，但需要注意相同的播放器实例仅能被一个通道占用。

#### 2. **组合使用视频源和音频源时有哪些限制？**

组合使用视频源和音频源限制如下：
1. 主路不能使用媒体播放器的视频或音频源。
2. 辅路使用媒体播放器作为音视频源时，需要主路使用并启动麦克风设备（`enableMicrophone`）。
如果您主路不需要麦克风声音，可通过 `mutePublishStreamAudio` 禁用音频推流保持麦克风启动。
3. 仅在主路使用摄像头视频源或者麦克风音频源时，辅路复制主路视频源或者音频源才能生效。
