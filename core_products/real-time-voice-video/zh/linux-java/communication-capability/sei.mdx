# 媒体补充增强信息（SEI）（SEI）

- - -

## 1 功能简介

在音视频流媒体应用中, 除了可以流媒体通道推拉音视频内容外, 还可以使用流媒体补充增强信息 SEI(Supplemental Enhancement Information)  通过流媒体通道将文本信息与音视频内容打包在一起, 从主播端(推流端)推出, 并从观众端(拉流端)接收, 以此实现文本数据与音视频内容的精准同步的目的。  
  
一般可用于视频画面的精准布局、远端歌词同步、直播答题等应用场景。

<div class="mk-hint">

SEI 的相关概念及原理请参考 [如何理解和使用 SEI（媒体补充增强信息）\|_blank](https://doc-zh.zego.im/faq/sei)。 
 
</div>

## 2 使用步骤

发送与接收 SEI 信息功能需要推流和拉流端配对使用才能展示效果，即需要在推流端发送 SEI 信息，拉流端接收SEI信息。以下内容将介绍各端如何使用发送与接收SEI信息功能。

![/Pics/Common/ZegoExpressEngine/send_and_recv_sei.png](/Pics/Common/ZegoExpressEngine/send_and_recv_sei.png)

主播推流发送SEI消息调用流程如下：

1. 调用 [createEngine \|_blank](/zh/api?doc=Express_Video_SDK_API~Java_linux~class~im-zego-zegoexpress-zego-express-engine#create-engine) 接口创建 engine 对象。

2. 调用 [loginRoom \|_blank](/zh/api?doc=Express_Video_SDK_API~Java_linux~class~im-zego-zegoexpress-zego-express-engine#login-room) 接口登录房间。

3. 调用 [startPublishingStream \|_blank](/zh/api?doc=Express_Video_SDK_API~Java_linux~class~im-zego-zegoexpress-zego-express-engine#start-publishing-stream) 接口推流。

4. 在推流成功后, 调用 [sendSEI \|_blank](/zh/api?doc=Express_Video_SDK_API~Java_linux~class~im-zego-zegoexpress-zego-express-engine#send-sei) 接口发送 SEI 信息。

观众拉流接收SEI消息调用流程如下：

1. 调用  [createEngine \|_blank](/zh/api?doc=Express_Video_SDK_API~Java_linux~class~im-zego-zegoexpress-zego-express-engine#create-engine) 接口创建 engine 对象。

2. 创建 [IZegoEventHandler \|_blank](/zh/api?doc=Express_Video_SDK_API~Java_linux~class~im-zego-zegoexpress-callback-i-zego-event-handler) 对象, 并重写接收SEI信息的 [onPlayerRecvSEI \|_blank](/zh/api?doc=Express_Video_SDK_API~Java_linux~class~im-zego-zegoexpress-callback-i-zego-event-handler#on-player-recv-sei) 方法, 调用 [setEventHandler \|_blank](/zh/api?doc=Express_Video_SDK_API~Java_linux~class~im-zego-zegoexpress-zego-express-engine#set-event-handler) 接口传入创建的 [IZegoEventHandler \|_blank](/zh/api?doc=Express_Video_SDK_API~Java_linux~class~im-zego-zegoexpress-callback-i-zego-event-handler) 监听 [onPlayerRecvSEI \|_blank](/zh/api?doc=Express_Video_SDK_API~Java_linux~class~im-zego-zegoexpress-callback-i-zego-event-handler#on-player-recv-sei) 的回调。

3. 调用 [loginRoom \|_blank](/zh/api?doc=Express_Video_SDK_API~Java_linux~class~im-zego-zegoexpress-zego-express-engine#login-room) 接口登录房间。

4. 调用 [startPlayingStream \|_blank](/zh/api?doc=Express_Video_SDK_API~Java_linux~class~im-zego-zegoexpress-zego-express-engine#start-playing-stream) 接口拉流。

5. 在拉流成功后, 接收到推流端发送的 SEI 信息之后触发 [onPlayerRecvSEI \|_blank](/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-callback-i-zego-event-handler#on-player-recv-sei) 回调。


### 2.1 推流方

发送 SEI 信息的接口需要在推流成功之后调用, 接口原型如下:

- 接口原型

    ```java
    /**
     * 发送媒体增强补充信息
     *
     * 此接口可在开发者推流传输音视频流数据同时，发送流媒体增强补充信息来同步一些其他附加信息。
     * 一般如同步音乐歌词或视频画面精准布局等场景，可选择使用发送 SEI。
     * 当推流方发送 SEI 后，拉流方可通过监听 [onPlayerRecvSEI] 的回调获取 SEI 内容。
     * 由于 SEI 信息跟随视频帧或音频帧，由于网络问题有可能丢帧，因此 SEI 信息也有可能丢，为解决这种情况，应该在限制频率内多发几次。
     * 限制频率：1秒钟不要超过30次。
     * SEI 数据长度限制为 4096 字节。
     * @param data SEI 内容
     */
    public void sendSEI(byte[] data)
    ```

- 调用示例如下

    ```java
    // 创建 enging 对象, appID, appSign 为开发者在 ZEGO 控制台申请的凭证信息, 未上线的开发者 isTestEnvironment 为 true, application 为安卓应用的上下文
    ZegoEngineProfile profile;
    profile.appID = ZegoUtilHelper::AppID();
    profile.appSign = ZegoUtilHelper::AppSign();
    profile.scenario = ZegoScenario::ZEGO_SCENARIO_DEFAULT;
    auto engine = ZegoExpressSDK::createEngine(profile, nullptr);
    // 登录房间
    engine.loginRoom("roomid", new ZegoUser("userid_1"));
    // 推流
    enging.startPublishingStream("streamid");
    // 开发者的其他业务逻辑
    ...;
    // 在业务场景需要的时机发送 SEI 信息
    enging.sendSEI("12345".getBytes());
    ```

### 2.2 拉流方

接收 SEI 信息的回调接口需要在拉流成功之后触发, 接口原型如下:

- 接口原型：

    ```java
    /**
     * 收到远端流的 SEI 内容
     *
     * 拉流成功后，当远端流调用 sendSEI 后，本端会收到此回调。
     * 若只拉纯音频流，将收不到推流端发送的 SEI 信息。
     * @param streamID 拉流的流 ID
     * @param data SEI 内容
     */
    public void onPlayerRecvSEI(String streamID, byte[] data){

    }
    ```

- 调用示例如下:

    ```java
    // 创建 enging 对象, appID, appSign 为开发者在 ZEGO 控制台申请的凭证信息, 未上线的开发者 isTestEnvironment 为 true, application 为安卓应用的上下文
    ZegoEngineProfile profile;
    profile.appID = ZegoUtilHelper::AppID();
    profile.appSign = ZegoUtilHelper::AppSign();
    profile.scenario = ZegoScenario::ZEGO_SCENARIO_DEFAULT;
    auto engine = ZegoExpressSDK::createEngine(profile, nullptr);    

    // 创建 IZegoEventHandler 对象, 并重写 onPlayerRecvSEI 方法
    IZegoEventHandler handler = new IZegoEventHandler(){
        // 监听其他回调
        ...;

        // 监听接收 SEI 信息的回调, 当发送端调用 sendSEI 发送信息时会触发此回调
        public void onPlayerRecvSEI(String streamID, byte[] data) {
            // 在这里实现业务场景相关的逻辑, 例如展现相关的UI等
            ...;
        }

    }
    // 添加监听的回调对象
    engine.setEventHandler(handler);
    // 登录房间
    engine.loginRoom("roomid", new ZegoUser("userid_2"));
    // 拉流, canvas 为 ZegoCanvas 类型的索引 UI 渲染控件的对象
    enging.startPlayingStream("streamid", canvas);
    // 开发者的其他业务逻辑
    ...;
    ```


## 3 API 参考列表

| 方法 | 描述 |
|-------|--------|
| [sendSEI \|_blank](/zh/api?doc=Express_Video_SDK_API~Java_linux~class~im-zego-zegoexpress-zego-express-engine#send-sei) | 发送 SEI 信息 |
| [onPlayerRecvSEI \|_blank](/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-callback-i-zego-event-handler#on-player-recv-sei) | 接收 SEI 信息 |
