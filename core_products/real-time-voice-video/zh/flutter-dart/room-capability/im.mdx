# 实时消息与信令

- - -

## 功能简介

@@@message_intro@@@

## 示例源码下载

请参考 [下载示例源码\|_blank](!DownloadDemo/DownloadDemo) 获取源码。

相关源码请查看 “lib\topics\CommonFunctions\room_message” 目录下的文件。

## 前提条件

在发送实时消息前，请确保：

@@@Express_Prerequisites_shortlinks@@@

## 使用步骤

### 收发广播消息

1. **发送广播消息**

  调用 [sendBroadcastMessage \|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineIM/sendBroadcastMessage.html) 接口向同一房间内的其他用户发送广播消息，长度不能超过 1024 字节。

  通过函数返回 [ZegoIMSendBroadcastMessageResult \|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoIMSendBroadcastMessageResult-class.html) 获取消息发送结果。

  ```dart
  // 发送广播消息
  ZegoExpressEngine.instance.sendBroadcastMessage(roomID, msg).then((ZegoIMSendBroadcastMessageResult result) {
        //发送消息结果成功或失败的处理
  });
  ```

2. **接收广播消息**

  实现 [ZegoExpressEngine.onIMRecvBroadcastMessage\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngine/onIMRecvBroadcastMessage.html) 回调，当发送方成功发送广播消息后，同一房间内的其他用户通过此回调接收相关信息，包括消息内容、消息 ID、发送时间及发送方信息。

  ```dart
    /**
     * 接收房间广播消息通知
     *
     * @param roomID 房间 ID
     * @param messageList 收到的消息列表
     */
    ZegoExpressEngine.onIMRecvBroadcastMessage = (String roomID, List<ZegoBroadcastMessageInfo> messageList) {
      // 收到其他用户发送消息的处理
    };
  ```

### 收发弹幕消息

1. **发送弹幕消息**

  调用 [sendBarrageMessage \|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineIM/sendBarrageMessage.html) 接口向同一房间内的其他用户发送弹幕消息，长度不能超过 1024 字节。

  通过函数返回 [ZegoIMSendBarrageMessageResult \|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoIMSendBarrageMessageResult-class.html) 获取消息发送结果。

  ```dart
  // 发送弹幕消息
  ZegoExpressEngine.instance.sendBarrageMessage("ChatRoom-1", "This is a barrage message").then((ZegoIMSendBarrageMessageResult result){
      //发送消息结果成功或失败的处理
  });
  ```

2. **接收弹幕消息**

  实现 [ZegoExpressEngine.onIMRecvBarrageMessage \|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngine/onIMRecvBarrageMessage.html) 回调，当发送方成功发送弹幕消息后，同一房间内的其他用户通过此回调接收相关信息，包括消息内容、消息 ID、发送时间及发送方信息。

  ```dart
    /**
     * 接收房间弹幕消息通知
     *
     * @param roomID 房间 ID
     * @param messageList 收到的消息列表
     */
    ZegoExpressEngine.onIMRecvBarrageMessage = (String roomID, List<ZegoBarrageMessageInfo> messageList) {
      // 收到其他用户发送消息的处理
    }; 
  ``` 

### 收发自定义信令

1. **发送自定义信令**

  调用 [sendCustomCommand \|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineIM/sendCustomCommand.html) 接口向同一房间内通过 “toUserList” 指定的用户发送自定义信令，长度不能超过 1024 字节。

  通过函数返回 [ZegoIMSendCustomCommandResult \|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoIMSendCustomCommandResult-class.html) 获取消息发送结果。

  ```dart
  // 发送自定义信令，`toUserList` 中指定的用户才可以通过 onIMSendCustomCommandResult 收到此信令
  // 若 `toUserList` 参数传 `[]` 则 SDK 将发送该信令给房间内所有用户
  ZegoExpressEngine.instance.sendCustomCommand(roomID, command, toUserList).then((ZegoIMSendCustomCommandResult result) {
       //发送消息结果成功或失败的处理
  });
  ```

2. **接收自定义信令**

  实现 [ZegoExpressEngine.onIMRecvCustomCommand \|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngine/onIMRecvCustomCommand.html) 回调，当发送方成功发送自定义消息后，同一房间内的指定用户通过此回调接收相关信息，包括消息内容和消息发送方信息。

  ```dart
    /**
     * 接收自定义信令通知
     *
     * @param roomID 房间 ID
     * @param fromUser 信令的发送人
     * @param command 信令内容
     */
    ZegoExpressEngine.onIMRecvCustomCommand = (String roomID, ZegoUser fromUser, String command) {
      // 收到其他用户发送消息的处理
    };
  ```
