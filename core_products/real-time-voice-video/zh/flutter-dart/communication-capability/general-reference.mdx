---
articleID: 14350
---
# 使用 Token 鉴权

---

## 1 功能介绍

@@@Introduction_to_Token_Authentication_Native@@@

## 2 前提条件

基础鉴权 Token 默认开通，权限认证 Token（即房间 ID 和推流 ID 权限位）请联系 ZEGO 技术支持开通。

<div class="mk-warning">

- 仅 2.17.1 及以上版本 ZEGO Express SDK，支持参考本文档使用 Token 鉴权。
- 若您集成的是 2.17.1 之前版本的 ZEGO Express SDK（使用 AppSign 鉴权），现在想升级到 2.17.1 版本且使用 Token 鉴权，可以通过 [如何从 AppSign 鉴权升级为 Token 鉴权\|_blank](/faq/token_upgrade) 文档了解 AppSign 鉴权和 Token 鉴权更多信息。
</div>


## 3 流程概述

@@@Token_implementation_process@@@


## 4 生成 Token 与使用

@@@Token_usage_steps_change@@@


### 4.2 在服务端生成 Token

@@@Server_generates_Token_change@@@

<a id="tab_item1"></a>
<div class="multipletabs-content">
    <!--tabs列表-->
    <div class="item-tabs">
        <div class="scroll-box">
          <span class="tab-item">
             生成基础鉴权 Token
          </span>
          <span class="tab-item">
             生成权限认证 Token
          </span>
        </div>
    </div>
<!--MarkDown内容要注意包裹在md-content标签内，且注意前面不能有空格，不然也会渲染异常-->
<div class="multipletabs-content-item ">
  <md-content>
@@@Server_generates_Token_change3@@@
  </md-content>
</div>
<!--嵌套其它html模板示例-->
<div class="multipletabs-content-item ">
@@@Server_generates_Token_change4@@@
</div>
</div>

@@@Server_generates_Token_change_warning@@@


### 4.3 使用 Token 

用户携带获取到的 Token 和 user、roomID 信息，通过 [loginRoom\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineRoom/loginRoom.html) 接口登录对应的房间。

<div class="mk-warning">

调用 [loginRoom\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineRoom/loginRoom.html) 接口登录房间时使用的 userID，必须和 “4.2 在服务端生成 Token” 时使用的 userID 保持一致。 
</div>


```dart
var config = ZegoRoomConfig.defaultConfig();
config.token = '您的token';
var user = ZegoUser('您的userID', '您的userName');
ZegoExpressEngine.instance.loginRoom('您的roomID', user, config: config);
```

如果开发者需要在登录房间后修改权限位，也可以调用 [renewToken\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineRoom/renewToken.html) 接口更新 Token，更新后会影响下一次登录某些房间和推某些流的权限，之前已经成功的房间登录和推流不受影响。


```dart
ZegoExpressEngine.instance.renewToken('你的roomID', '新的token');
```


### 4.4 Token 过期处理机制

@@@Token_overdue@@@


在 Token 过期前 30 秒，SDK 会通过 [onRoomTokenWillExpire\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngine/onRoomTokenWillExpire.html) 回调发出通知。

收到该回调后，开发者需要从自己的服务端获取新的有效 Token，并调用 SDK 提供的 [renewToken\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineRoom/renewToken.html) 接口更新 Token。

@@@Token expiration processing mechanism@@@


```dart
ZegoExpressEngine.onRoomTokenWillExpire = (String roomID, int remainTimeInSecond) {
    String token = getToken(); // 重新请求开发者服务端获取 Token；
    ZegoExpressEngine.instance.renewToken(roomID, token);
  };
```

## 5 其他

<details class="zg-primary">
    <summary>客户端生成 Token 与使用（不推荐）</summary>

@@@Client_generates_Token@@@

@@@Client_generates_Token_Step@@@
</details>



## 6 API 参考

| 方法 | 描述 |
|-------|--------|
| [loginRoom\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineRoom/loginRoom.html) | 登录房间 |
| [renewToken\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineRoom/renewToken.html) | 更新 Token |
| [onRoomTokenWillExpire\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngine/onRoomTokenWillExpire.html) | Token 过期回调 |


## 7 相关文档

[如何防止音视频互动中的幽灵麦或炸房的现象？\|_blank](https://doc-zh.zego.im/faq/bombing)
