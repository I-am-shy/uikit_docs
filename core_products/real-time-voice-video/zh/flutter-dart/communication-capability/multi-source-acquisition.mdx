# 多源采集

- - -
## 功能简介

@@@Multi_source_acquisition_info@@@

## 前提条件

在使用多源采集功能之前，请确保：

@@@Express-Video_Prerequisites@@@

## 实现流程

<div class="mk-warning">


实时语音产品仅支持设置音频采集源。
</div>

### 1 创建 ZegoExpressEngine 引擎

创建 ZegoExpressEngine 引擎流程，请参考实现视频通话的 [创建引擎\|_blank](!Integration/Solution_Implementation#CreateEngine)。

```dart
// 创建 ZegoExpress 实例，监听常用事件
    void createEngine() {
        // 创建引擎，通用场景接入
        // appID: 请通过官网注册获取，格式为：1234567890L
        // appSign: 请通过官网注册获取，格式为：@"0123456789012345678901234567890123456789012345678901234567890123"（共64个字符）
        // ZegoScenario.Broadcast 指定使用直播场景 (请根据实际情况填写适合你业务的场景)
        var profile = new ZegoEngineProfile(appID, ZegoScenario.Broadcast, appSign: appSign);
        ZegoExpressEngine.createEngineWithProfile(profile);
    }
```

### 2 设置音视频采集源

1. 调用 [setVideoSource\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEnginePublisher/setVideoSource.html) 接口设置视频采集源。

```dart
/** 使用摄像头作为视频采集源 */
ZegoExpressEngine.instance.setVideoSource(ZegoVideoSourceType.ZegoVideoSourceCamera);
```

<div class = 'mk-hint'>

- 如果需要使用媒体播放器作为视频采集源，需先调用 [createMediaPlayer\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineMediaPlayer/createMediaPlayer.html) 接口创建媒体播放器，再通过调用 [setVideoSource\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEnginePublisher/setVideoSource.html) 接口设置视频采集源类型为 `ZegoVideoSourceType.ZegoVideoSourcePlayer` 和设置视频采集源所使用的媒体播放器实例索引，然后再使用刚创建的媒体播放器加载资源并播放，详情请参考 [媒体播放器\|_blank](!Other_Functions/MediaPlayer) 。
- 如果需要使用屏幕共享作为视频采集源，需设置视频采集源类型为 `ZegoVideoSourceType.ZegoVideoSourceScreenCapture`，并开启屏幕共享向 SDK 推屏幕共享视频数据，详情请参考 [屏幕共享\|_blank](!ExpressVideoSDK-Other_Functions/Share_Screen) 。

</div>

2. 调用 [setAudioSource\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEnginePublisher/setAudioSource.html) 接口设置音频采集源。

```dart
/** 使用麦克风作为音频采集源 */
ZegoExpressEngine.instance.setAudioSource(ZegoAudioSourceType.Microphone);
```

<div class = 'mk-hint'>

- 如果需要使用自定义音频采集作为音频采集源，需设置音频采集源类型为 `ZegoAudioSourceType.Custom`，调用 [sendCustomAudioCaptureAACData\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineCustomAudioIO/sendCustomAudioCaptureAACData.html) 或 [sendCustomAudioCapturePCMData\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineCustomAudioIO/sendCustomAudioCapturePCMData.html) 等接口向 SDK 发送音频数据，详情请参考 [自定义音频采集与渲染\|_blank](!AudioAdvanced/custom_audio_io)。
- 如果需要使用媒体播放器作为音频采集源，需设置音频采集源类型为 `ZegoAudioSourceType.MediaPlayer`，调用 [createMediaPlayer\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineMediaPlayer/createMediaPlayer.html) 接口创建媒体播放器，然后使用刚创建的媒体播放器加载资源并播放，详情请参考 [媒体播放器\|_blank](!Other_Functions/MediaPlayer) 。

</div>

### 3 登录房间并推流

登录房间及推流流程，请参考实现视频通话的 [登录房间\|_blank](!Integration/Solution_Implementation#createroom) 及 [推流\|_blank](!Integration/Solution_Implementation#publishingStream) 。

### 4 （可选）切换音视频采集源

1. 调用 [setVideoSource\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEnginePublisher/setVideoSource.html) 接口切换视频采集源。

```dart
/** 使用屏幕共享作为视频采集源 */
ZegoExpressEngine.instance.setVideoSource(ZegoVideoSourceType.ZegoVideoSourceScreenCapture);
```

2. 调用 [setAudioSource\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEnginePublisher/setAudioSource.html) 接口切换音频采集源。

```dart
/** 使用媒体播放器作为音频采集源 */
ZegoExpressEngine.instance.setAudioSource(ZegoAudioSourceType.MediaPlayer);
```

### 5 结束推流

结束推流流程，请参考实现视频通话的 [停止推拉流\|_blank](!Integration/Solution_Implementation#stopPublishingStream)。

```dart
// 停止推流
ZegoExpressEngine.instance.stopPublishingStream();
```

## API 参考列表

| 方法 | 描述 |
|-------|--------|
| [setVideoSource\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEnginePublisher/setVideoSource.html) | 设置视频采集源 |
| [setAudioSource\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEnginePublisher/setAudioSource.html) | 设置音频采集源 |
| [sendCustomAudioCaptureAACData\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineCustomAudioIO/sendCustomAudioCaptureAACData.html) | 向 SDK 发送自定义采集的 AAC 数据 |
| [sendCustomAudioCapturePCMData\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineCustomAudioIO/sendCustomAudioCapturePCMData.html) | 向 SDK 发送自定义采集的 PCM 数据 |
| [createMediaPlayer\|_blank](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoExpressEngineMediaPlayer/createMediaPlayer.html) | 创建媒体播放器实例 |

##  常见问题

@@@Multi_source_acquisition_faq@@@
