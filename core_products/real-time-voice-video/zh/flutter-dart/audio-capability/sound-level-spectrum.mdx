---
articleID: 10920
---
# 音量变化与音频频谱

- - -

## 功能简介

<div class="mk-warning">

本文档暂不适用于 Web 平台。
</div>

<table>
  <colgroup>
    <col width="10%">
    <col width="25%">
    <col width="25%">
    <col width="40%">
  </colgroup>
<tbody><tr>
<th>概念</th>
<th>描述</th>
<th>应用场景</th>
<th>场景图</th>
</tr>
<tr>
<td>音量变化</td>
<td>指某条流的音量大小，下文简称为“声浪”。</td>
<td>在推拉流过程中，判断麦上的用户谁在说话，并做 UI 展示。</td>
<td>&nbsp; <img src="/Pics/Android/ZegoLiveRoom/SoundLevel.png" width=70%></td>
</tr>
<tr>
<td>音频频谱</td>
<td>指数字音频信号在各频点的能量值。</td>
<td>在主播 K 歌场景中，已经推流或拉流的前提下，让主播或观众看到音调与音量变化的动画。</td>
<td>&nbsp; &nbsp;<img src="/Pics/Android/ZegoLiveRoom/FrequencySpectrum.png" width=70%></td>
</tr>
</tbody></table> 


  
## 示例源码下载

请参考 [下载示例源码](!DownloadDemo/DownloadDemo) 获取源码。

相关源码请查看 “lib/topics/AudioAdvanced/soundlevel_spectrum” 目录下的文件。


## 前提条件

在实现声浪与音频频谱功能之前，请确保：

@@@Express_Prerequisites_shortlinks@@@


## 非混流场景使用步骤

### 1 监听声浪与音频频谱的回调接口

- 接口原型

    - 本地采集的声浪回调接口 [onCapturedSoundLevelUpdate ](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngine/onCapturedSoundLevelUpdate.html)：

        ```dart
        class ZegoExpressEngine {

        ...

        /**
         * 本地采集音频声浪回调
         *
         * 回调通知周期为 100 ms。
         * @param soundLevel 本地采集的声浪值，取值范围为 0.0 ~ 100.0
         */
        static void Function(double soundLevel)? onCapturedSoundLevelUpdate;

        ...
    
        }
        ```

    - 远端音频声浪回调接口 [onRemoteSoundLevelUpdate ](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngine/onRemoteSoundLevelUpdate.html)：

        ```dart
        class ZegoExpressEngine {

        ...

        /**
         * 远端拉流音频声浪回调
         *
         * 回调通知周期为 100 ms。
         * @param soundLevels 远端的声浪键值对，key 为流 ID，value 为对应的流的声浪值，value 取值范围为 0.0 ~ 100.0
         */
        static void Function(Map<String, double> soundLevels)? onRemoteSoundLevelUpdate;

        ...
        
        }
        ```

    - 本地采集的音频频谱回调接口 [onCapturedAudioSpectrumUpdate ](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngine/onCapturedAudioSpectrumUpdate.html)：

        ```dart
        class ZegoExpressEngine {

        ...

        /**
         * 本地采集音频频谱回调
         *
         * 回调通知周期为 100 ms。
         * @param audioSpectrum 本地采集的音频频谱值数组，频谱值范围为 [0-2^30]
         */
        static void Function(List<double> audioSpectrum)? onCapturedAudioSpectrumUpdate;

        ...

        }
        ```

    - 远端拉流音频频谱回调接口 [onRemoteAudioSpectrumUpdate ](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngine/onRemoteAudioSpectrumUpdate.html)：

        ```dart
        class ZegoExpressEngine {

        ...

        /**
         * 远端拉流音频频谱回调
         *
         * 回调通知周期为 100 ms。
         * @param audioSpectrums 远端音频频谱键值对，key 是流 ID，value 为对应的流的音频频谱值数组，频谱值范围为 [0-2^30]
         */
        static void Function(Map<String, List<double>> audioSpectrums)? onRemoteAudioSpectrumUpdate;

        ...

        }
        ```

- 调用示例

    远端拉流声浪和远端音频频谱的回调给的是 `Map`，`key` 是当前房间内正在推流的其他用户的流 ID，`value` 是对应这条流的声浪/音频频谱数据。

    可先通过 [onRoomStreamUpdate](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngine/onRoomStreamUpdate.html) 回调方法获取到当前房间内存在的流列表，并保存起来，然后通过保存的流列表来索引 `Map` 取得每条流对应的声浪/音频频谱数据。

    以下示例将演示如何从回调方法中获取到声浪/音频频谱的数据并传递给 UI，具体上下文请参考示例源码中 “lib/topics/AudioAdvanced/soundlevel_spectrum” 目录下的文件。

    ```dart
    ZegoExpressEngine.onCapturedSoundLevelUpdate = (double soundLevel) {
            // 开发者可以在这里进行获取本地声浪数据之后渲染到具体的 UI 控件上
    }    
    ZegoExpressEngine.onRemoteSoundLevelUpdate = (Map<String, double> soundLevels) {
            // 开发者可以在这里进行获取远端声浪数据之后渲染到具体的 UI 控件上
    }
    ZegoExpressEngine.onCapturedAudioSpectrumUpdate = (List<double> audioSpectrum) {
            // 开发者可以在这里进行获取本地音频频谱数据之后渲染到具体的 UI 控件上
    }
    ZegoExpressEngine.onRemoteAudioSpectrumUpdate = (Map<String, List<double>> audioSpectrums) {
            // 开发者可以在这里进行获取远端音频频谱数据之后渲染到具体的 UI 控件上
    }
    ```

### 2 启动监听声浪与音频频谱的回调的开关

可分别针对声浪与音频频谱，调用启动监听对应回调的开关。  
  
- 调用 [startSoundLevelMonitor ](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngineDevice/startSoundLevelMonitor.html) 启动声浪的监听：

    ```dart
    // 启动声浪监控
    ZegoExpressEngine.instance.startSoundLevelMonitor();
    ```

    在调用上述接口之后，[onCapturedSoundLevelUpdate ](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngine/onCapturedSoundLevelUpdate.html) 会立刻触发，未推流且未预览时回调值为 0；[onRemoteSoundLevelUpdate ](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngine/onRemoteSoundLevelUpdate.html) 需要在拉流 [startPlayingStream ](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEnginePlayer/startPlayingStream.html)之后，才会回调。  
  
- 调用 [startAudioSpectrumMonitor ](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngineDevice/startAudioSpectrumMonitor.html) 启动频谱的监听： 

    ```dart
    // 启动音频频谱监控
    ZegoExpressEngine.instance.startAudioSpectrumMonitor();
    ```

    在调用上述接口之后，[onCapturedAudioSpectrumUpdate ](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngine/onCapturedAudioSpectrumUpdate.html) 会立刻触发，未推流且未预览时回调值为 0；[onRemoteAudioSpectrumUpdate ](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngine/onRemoteAudioSpectrumUpdate.html) 需要在拉流 [startPlayingStream ](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEnginePlayer/startPlayingStream.html) 之后，才会回调。  

### 3 停止监听音频频谱与声浪的回调的开关

可分别针对声浪或音频频谱，调用停止监听对应回调的开关。  

- 调用 [stopSoundLevelMonitor ](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngineDevice/stopSoundLevelMonitor.html) 停止声浪的监听：

    ```dart
    // 停止声浪监控
    ZegoExpressEngine.instance.stopSoundLevelMonitor();
    ```

    在调用上述接口之后，[onCapturedSoundLevelUpdate ](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngine/onCapturedSoundLevelUpdate.html) 与 [onRemoteSoundLevelUpdate ](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngine/onRemoteSoundLevelUpdate.html) 不再回调。  
  
- 调用 [stopAudioSpectrumMonitor ](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngineDevice/stopAudioSpectrumMonitor.html) 停止频谱的监听：

    ```dart
    // 停止音频频谱监控
    ZegoExpressEngine.instance.stopAudioSpectrumMonitor();
    ```

    在调用上述接口之后，[onCapturedAudioSpectrumUpdate ](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngine/onCapturedAudioSpectrumUpdate.html) 与 [onRemoteAudioSpectrumUpdate ](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngine/onRemoteAudioSpectrumUpdate.html) 不再回调。

## 混流场景使用步骤

@@@Overvie_of_Mixed_Flow_Sound_Waves@@@
 
### 1 监听混流声浪的回调接口

- 接口原型

    - 手动混流中每条单流的声浪更新回调接口 [onMixerSoundLevelUpdate](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngine/onMixerSoundLevelUpdate.html)：

        ```dart
        class ZegoExpressEngine {

        ...

        /**
         * 手动混流音频频谱回调
         *
         * 回调通知周期为 100 ms。
         * @param soundLevels 远端音频频谱键值对，key 是soundLevelID，value 为对应的流的音频频谱值数组，频谱值范围为 [0.0 ~ 100.0]
         */
        static void Function(Map<int, double> soundLevels)? onMixerSoundLevelUpdate;

        ...

        }
        ```

    - 自动混流中每条单流的声浪更新回调接口 [onAutoMixerSoundLevelUpdate](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngine/onAutoMixerSoundLevelUpdate.html)：

        ```dart
        class ZegoExpressEngine {

        ...

        /**
         * 自动混流音频频谱回调
         *
         * 回调通知周期为 100 ms。
         * @param soundLevels 远端音频频谱键值对，key 是流 ID，value 为对应的流的音频频谱值数组，频谱值范围为 [0.0 ~ 100.0]
         */
        static void Function(Map<String, double> soundLevels)? onAutoMixerSoundLevelUpdate;

        ...

        }
        ```

### 2 启动监听声浪回调的开关

在开始/更新混流时，可启动监听声浪回调的开关。

- 手动混流场景 

  调用 [startMixerTask](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngineMixer/startMixerTask.html) 接口发起手动混流任务时，设置 `enableSoundLevel` 参数为 `true` 可启动声浪的监听，并为每条输入流指定设置唯一的 `soundLevelID`：

    ```dart
    ZegoMixerTask task = ZegoMixerTask("task123");

    // 开启混流声浪
    task.enableSoundLevel = true;
     
    ZegoMixerInput input = ZegoMixerInput.defaultConfig();
    // 给输入流分配一个 soundLevelID
    input.soundLevelID = 123;
    
    // 其他配置

    ZegoExpressEngine.instance.startMixerTask(task);
    ```

- 自动混流场景

  调用 [startAutoMixerTask](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngineMixer/startAutoMixerTask.html) 接口发起一个自动混流任务时，设置 `enableSoundLevel` 参数为 `true` 可启动声浪的监听：

    ```dart
    var task = ZegoAutoMixerTask();
    task.roomID = "room123";
    task.taskID = "autotask123";

    // 开启混流声浪
    task.enableSoundLevel = true;
    // 其他配置

    ZegoExpressEngine.instance.startAutoMixerTask(task);
    ```


### 3 停止监听声浪回调的开关

在更新混流任务时，可设置停止监听声浪回调的开关。  

- 手动混流场景 

  在调用 [startMixerTask](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngineMixer/startMixerTask.html) 的客户端接口更新一个混流任务时，设置 `enableSoundLevel` 参数为 `false` 可停止声浪的监听：

    ```dart
    ZegoMixerTask task = ZegoMixerTask("task123");

    // 开启混流声浪
    task.enableSoundLevel = false;
     
    ZegoMixerInput input = ZegoMixerInput.defaultConfig();
    // 给输入流分配一个 soundLevelID
    input.soundLevelID = 123;
    
    // 其他配置

    ZegoExpressEngine.instance.startMixerTask(task);
    ```

- 自动混流场景

  调用 [startAutoMixerTask](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngineMixer/startAutoMixerTask.html) 的客户端接口更新一个自动混流任务时，设置 `enableSoundLevel` 参数为 `false` 可停止声浪的监听：

    ```dart
    var task = ZegoAutoMixerTask();
    task.roomID = "room123";
    task.taskID = "autotask123";

    // 开启混流声浪
    task.enableSoundLevel = false;
    // 其他配置

    ZegoExpressEngine.instance.startAutoMixerTask(task);
    ```

## 相关文档

- [媒体音量和通话音量有什么区别？](https://doc-zh.zego.im/faq/system_volume)
- [怎么处理无声问题？](https://doc-zh.zego.im/faq/noaudio)
- [怎么处理音量太小问题？](https://doc-zh.zego.im/faq/audio_low)
