---
articleID: 16869
---
# 超分辨率

- - -

## 功能简介

@@@Express_super_resolution_info@@@


## 前提条件

@@@Express_super_resolution_pre@@@


## 实现流程

### 1 初始化和登录房间

初始化和登录房间的具体流程，请参考实现视频通话文档中的 “[3.1 创建引擎](!Integration/Solution_Implementation#3_1)”及“[3.2 登录房间](!Integration/Solution_Implementation#3_2)”。

### 2 监听超分状态回调

开启超分功能后，可通过 [onPlayerVideoSuperResolutionUpdate](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngine/onPlayerVideoSuperResolutionUpdate.html) 确认超分功能是否成功开启。

超分功能状态定义如下：

|枚举值|说明|
|-|-|
|ZegoSuperResolutionState.Off| 超分功能关闭。|
|ZegoSuperResolutionState.On|超分功能开启。|

通过 [onPlayerVideoSizeChanged](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngine/onPlayerVideoSizeChanged.html) 可获取超分功能开启后的拉流视频分辨率。

```dart
// 拉流视频分辨率发生变化的通知
ZegoExpressEngine.onPlayerVideoSizeChanged(String streamID, int width, int height) {
    
}
// 超分状态发生变化的通知
ZegoExpressEngine.onPlayerVideoSuperResolutionUpdate(String streamID, ZegoSuperResolutionState state, int errorCode) {
    if(state == ZegoSuperResolutionState.On)
    {
        // 超分已开启
    }
    else
    {
        // 超分已关闭
        if(errorCode == 0){
            // 正常关闭
        }
        else if(errorCode == 1004004){
            // 该设备不支持超分
        }
        else if(errorCode == 1004005){
            // 超分流数量超过限制，仅支持一条流超分
        }
        else if(errorCode == 1004006){
            // 超分原始分辨率超过限制
        }
        else if(errorCode == 1004007){
            // 超分设备性能不足
        }
        else if(errorCode == 1004008){
            // 超分正在初始化，请勿频繁操作
        }
    }
}
```

### 3 初始化视频超分

在使用超分功能前，需要调用 [initVideoSuperResolution](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEnginePlayer/initVideoSuperResolution.html) 接口初始化超分。

<div class = "mk-warning">

初始化视频超分为耗时操作，在 SDK 生命周期执行一次即可，不建议频繁初始化、反初始化超分。

</div>

```dart
ZegoExpressEngine.instance.initVideoSuperResolution();
```

### 4 开启视频超分

开发者可以选择在拉流前或者拉流中开启视频超分功能，以在拉流前对流 “STREAM_ID” 开启超分功能为例：

```dart
ZegoExpressEngine.instance.enableVideoSuperResolution("STREAM_ID", true);
```

开启超分功能后，需要监听回调 [onPlayerVideoSuperResolutionUpdate](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEngine/onPlayerVideoSuperResolutionUpdate.html) ，以确认此次超分功能是否开启成功。

<div class = "mk-warning">

为了便于管理超分状态，建议在收到超分状态回调后，再开启下一次超分功能。

</div>

### 5 开始拉流

调用 [startPlayingStream](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEnginePlayer/startPlayingStream.html)，传入 “STREAM_ID” 拉取远端用户的音视频流。

```dart
var playCanvas = ZegoCanvas.view(playView);
ZegoExpressEngine.instance.startPlayingStream("STREAM_ID", canvas:playCanvas);
```

### 6 关闭视频超分功能

当不需要超分功能或者开启超分功能过程中发生错误（性能不足或原始视频分辨率超过限制）时，可关闭超分功能以释放系统资源。

```dart
ZegoExpressEngine.instance.enableVideoSuperResolution("STREAM_ID", false);
```

### 7 停止拉流

停止拉流后，SDK 会自动关闭超分功能并释放占用的系统资源。

```dart
ZegoExpressEngine.instance.stopPlayingStream("STREAM_ID");
```

### 8 反初始化视频超分

当不需要视频超分功能时，可以调用 [uninitVideoSuperResolution](/unique-api/express-video-sdkhttps://doc-zh.zego.im/article/dart_flutter/zego_express_engine/ZegoExpressEnginePlayer/uninitVideoSuperResolution.html) 接口反初始化视频超分，以节省内存。

```dart
ZegoExpressEngine.instance.uninitVideoSuperResolution();
```
