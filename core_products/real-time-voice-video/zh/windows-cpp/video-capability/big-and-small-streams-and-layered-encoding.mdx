---
articleID: 17944
---
# 视频大小流和分层编码

- - -

@@@Big_and_small_streams_and_Layered_Encoding@@@

## 示例源码下载

请参考 [下载示例源码\|_blank](!DownloadDemo/DownloadDemo) 获取源码。

相关源码请查看 “/ZegoExpressExample/Examples/AdvancedVideoProcessing/EncodingAndDecoding” 目录下的文件。

## 前提条件

在实现两种视频编码功能之前，请确保：

@@@Express-Video_Prerequisites@@@


## 实现步骤

### 分层视频编码

#### 1 开启分层视频编码

在调用 [startPublishingStream\|_blank](@startPublishingStream) 之前，调用 [setVideoConfig\|_blank](@setVideoConfig-IZegoExpressEngine) 接口，设置 [ZegoVideoConfig\|_blank](@-ZegoVideoConfig) 类中的参数 `codecID` 为 `ZegoVideoCodecIDSVC`，开启分层视频编码；并调用 [startPublishingStream\|_blank](@startPublishingStream) 接口开始推流。

```cpp
ZegoVideoConfig videoConfig;
videoConfig.codecID = ZEGO_VIDEO_CODEC_ID_SVC;
engine->setVideoConfig(videoConfig);

std::string streamID = "MultiLayer-1";
engine->startPublishingStream(streamID);
```

<div class="mk-hint">

“codecID” 设置为 “ZegoVideoCodecIDDefault”、“ZegoVideoCodecIDVP8” 或 “ZegoVideoCodecIDH265” 可关闭该功能。
</div>

#### 2 指定拉取的分层视频

在推流端开启了分层视频编码后，拉流端用户在拉流前后均可调用 [setPlayStreamVideoType\|_blank](@setPlayStreamVideoType) 接口，传入具体的拉流参数以拉取特定的视频分层。目前支持的视频分层如下：

|枚举值|说明|
|-|-|
|ZegoVideoStreamTypeDefault|（默认值）根据网络状态自动选择合适的视频分层，例如弱网只拉取基本层。|
|ZegoVideoStreamTypeSmall| 基本层，小分辨率类型。|
|ZegoVideoStreamTypeBig| 扩展层，大分辨率类型。|

```cpp
ZegoExpressSDK::getEngine()->setPlayStreamVideoType(ZegoVideoStreamTypeBig,streamID);
ZegoExpressSDK::getEngine()->startPlayingStream(streamID, canvas:playCanvas);
```

### 大小流视频编码

`大小流视频编码` 与 `分层视频编码` 的实现步骤基本一致，不同的是 `大小视频流编码` 功能支持在推流前，分别设置大流和小流的分辨率、帧率和码率等信息。

#### 1 开启大小流视频编码

在调用 [startPublishingStream\|_blank](@startPublishingStream) 之前，调用 [setVideoConfig\|_blank](@setVideoConfig-ZegoExpressEngine) 接口，设置 [ZegoVideoConfig\|_blank](@-ZegoVideoConfig) 类中的参数 `codecID` 为 `ZEGO_VIDEO_CODEC_ID_H264_DUAL_STREAM`，开启大小流视频编码；并调用 [startPublishingStream\|_blank](@startPublishingStream) 接口开始推流。


```cpp
ZegoVideoConfig videoConfig;
videoConfig.codecID = ZEGO_VIDEO_CODEC_ID_H264_DUAL_STREAM;
ZegoExpressSDK::getEngine()->setVideoConfig(video_config); 
```

<div class="mk-hint">

“codecID” 设置为 “ZegoVideoCodecIDDefault”、“ZegoVideoCodecIDVP8” 或 “ZegoVideoCodecIDH265” 可关闭该功能。
</div>

#### 2 设置基本层、扩展层的参数

通过 [setPublishDualStreamConfig\|_blank](@setPublishDualStreamConfig) 接口，分别设置大流和小流的分辨率、帧率和码率等信息，并调用 [startPublishingStream\|_blank](@startPublishingStream) 接口开始推流。

@@@Big_and_small_streams_and_Layered_Encoding_Warning@@@

```cpp
std::vector<ZegoPublishDualStreamConfig> dual_stream_config;
ZegoPublishDualStreamConfig stream_config_big;
stream_config_big.streamType = ZEGO_VIDEO_STREAM_TYPE_BIG;
stream_config_big.encodeWidth = 960;
stream_config_big.encodeHeight = 540;
stream_config_big.fps = 15;
stream_config_big.bitrate = 1200;
dual_stream_config.push_back(stream_config_big);

ZegoPublishDualStreamConfig stream_config_small;
stream_config_small.streamType = ZEGO_VIDEO_STREAM_TYPE_SMALL;
stream_config_small.encodeWidth = 320;
stream_config_small.encodeHeight = 180;
stream_config_small.fps = 15;
stream_config_small.bitrate = 300;
dual_stream_config.push_back(stream_config_small);
ZegoExpressSDK::getEngine()->setPublishDualStreamConfig(dual_stream_config, ZegoPublishChannel::ZEGO_PUBLISH_CHANNEL_MAIN);

std::string streamid = "dual_stream";
ZegoExpressSDK::getEngine()->startPublishingStream(streamid);
```

#### 3 指定拉取的视频码流

在推流端开启了视频大小流编码后，拉流端用户在拉流前后均可调用 [setPlayStreamVideoType\|_blank](@setPlayStreamVideoType) 接口，传入具体的拉流参数以拉取特定的视频分层。目前支持的视频分层如下：

|枚举值|说明|
|-|-|
|ZegoVideoStreamTypeDefault|（默认值）根据网络状态自动选择合适的视频分层，例如弱网只拉取基本层。|
|ZegoVideoStreamTypeSmall| 基本层，小分辨率类型。|
|ZegoVideoStreamTypeBig| 扩展层，大分辨率类型。|

```cpp
ZegoExpressSDK::getEngine()->setPlayStreamVideoType(ZegoVideoStreamTypeBig,streamID);
ZegoExpressSDK::getEngine()->startPlayingStream(streamID, canvas:playCanvas);
```


## 常见问题

@@@Big_and_small_streams_and_Layered_Encoding_FAQ@@@
