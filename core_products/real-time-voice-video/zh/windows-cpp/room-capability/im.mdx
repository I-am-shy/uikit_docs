---
articleID: 1047
---
# 实时消息与信令


- - -

## 功能简介

@@@message_intro@@@


## 示例源码下载

请参考 [下载示例源码](!DownloadDemo/DownloadDemo) 获取源码。

相关源码请查看 “/ZegoExpressExample/Examples/CommonFeatures/RoomMessage” 目录下的文件。

## 前提条件

在发送实时消息前，请确保：

@@@Express-Video_Prerequisites@@@


## 使用步骤

### 收发广播消息

1. **发送广播消息**

    调用 [sendBroadcastMessage](/zh/api?doc=Express_Video_SDK_API~CPP_windows~class~zego-express-i-zego-express-engine#send-broadcast-message) 接口向同一房间内的其他用户发送广播消息，长度不能超过 1024 字节。

    通过 [ZegoIMSendBroadcastMessageCallback](@ZegoIMSendBroadcastMessageCallback) 回调获取消息发送结果。

    ```C++
    // 发送广播消息
    engine->sendBroadcastMessage("ChatRoom-1", "This is a broadcast message", [=](int errorCode, unsigned long long messageID){
        printf("send broadcast message: errorCode=%d", errorCode);
    })
    ```
2. **接收广播消息**

    实现 [IZegoEventHandler](@-IZegoEventHandler) 代理中的 [onIMRecvBroadcastMessage ](/zh/api?doc=Express_Video_SDK_API~CPP_windows~class~zego-express-i-zego-event-handler#on-im-recv-broadcast-message) 回调，当发送方成功发送广播消息后，同一房间内的其他用户通过此回调接收相关信息，包括消息内容、消息 ID、发送时间及发送方信息。

    ```C++
    class MyEventHandler: public IZegoEventHandler{
        /**
        * 接收房间广播消息通知
        *
        * @param roomID 房间 ID
        * @param messageList 收到的消息列表
        */
        void onIMRecvBroadcastMessage(const std::string& roomID, std::vector<ZegoBroadcastMessageInfo> messageList) override {
            printf("received broadcast message");
            // 收到其他用户发送消息的处理
        }
    }    
    ```

### 收发弹幕消息

1. **发送弹幕消息**

    调用 [sendBarrageMessage ](/zh/api?doc=Express_Video_SDK_API~CPP_windows~class~zego-express-i-zego-express-engine#send-barrage-message) 接口向同一房间内的其他用户发送弹幕消息，长度不能超过 1024 字节。

    通过 [ZegoIMSendBarrageMessageCallback](@ZegoIMSendBroadcastMessageCallback) 回调获取消息发送结果。

    ```C++
    // 发送弹幕消息
    engine->sendBarrageMassage("ChatRoom-1", "This is a barrage message", [=](int errorCode, std::string messageID){
        printf("send barrage message: errorCode=%d", errorCode);
    })
    ```
2. **接收弹幕消息**

    实现 [IZegoEventHandler](@-IZegoEventHandler) 代理中的 [onIMRecvBarrageMessage ](/zh/api?doc=Express_Video_SDK_API~CPP_windows~class~zego-express-i-zego-event-handler#on-im-recv-barrage-message) 回调，当发送方成功发送弹幕消息后，同一房间内的其他用户通过此回调接收相关信息，包括消息内容、消息 ID、发送时间及发送方信息。

    ```C++
    class MyEventHandler: public IZegoEventHandler{
        /**
        * 接收房间弹幕消息通知
        *
        * @param roomID 房间 ID
        * @param messageList 收到的消息列表
        */
        void onIMRecvBarrageMessage(const std::string& roomID, std::vector<ZegoBarrageMessageInfo> messageList) override {
            printf("received barrage message");
            // 收到其他用户发送消息的处理
        }
    }    
    ```   

### 收发自定义信令

1. **发送自定义信令**

    调用 [sendCustomCommand ](/zh/api?doc=Express_Video_SDK_API~CPP_windows~class~zego-express-i-zego-express-engine#send-custom-command) 接口向同一房间内通过 “toUserList” 指定的用户发送自定义信令，长度不能超过 1024 字节。

    通过 [ZegoIMSendCustomCommandCallback](@ZegoIMSendCustomCommandCallback) 回调获取消息发送结果。

    ```C++
    // 发送自定义信令，toUserList 中指定的用户才可以通过 onIMRecvCustomCommand 收到此信令
    auto user1 = ZegoUser("userID1", "userName1");
    auto user2 = ZegoUser("userID2", "userName2");
    std::vector<ZegoUser> toUserList = {user1, user2};
    engine->sendCustomCommand("ChatRoom-1", "This is a custom command", toUserList, [=](int errorCode){
        printf("send custom command: errorCode=%d", errorCode);
    })
    ```

2. **接收自定义信令**

    实现 [IZegoEventHandler](@-IZegoEventHandler) 代理中的 [onIMRecvCustomCommand ](/zh/api?doc=Express_Video_SDK_API~CPP_windows~class~zego-express-i-zego-event-handler#on-im-recv-custom-command) 回调，当发送方成功发送自定义信令后，同一房间内的指定用户通过此回调接收相关信息，包括消息内容和消息发送方信息。

    ```C++
    class MyEventHandler: public IZegoEventHandler{
        /**
        * 接收自定义信令通知
        *
        * @param roomID 房间 ID
        * @param fromUser 信令的发送人
        * @param command 信令内容
        */
        void onIMRecvCustomCommand(const std::string& roomID, ZegoUser fromUser, const std::string& command) override {
            printf("received custom command");
            // 收到其他用户发送消息的处理
        }
    }
    ```
