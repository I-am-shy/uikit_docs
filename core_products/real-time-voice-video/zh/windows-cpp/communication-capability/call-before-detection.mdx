---
articleID: 12057
---
# 通话前检测

---

## 1 功能简介

为了保证实时通信体验，通话前可以进行网络与设备的检测，提前识别并排查问题。
网络检测：检测网络环境，可用于判断或预测网络环境是否适合推/拉指定码率的流。
设备检测：检测本地麦克风、摄像头以及播放设备是否能正常工作。
本文将介绍如何使用 ZEGO SDK 接口，实现上述两个角度的检测。


## 2 网络检测

请根据 [网络与性能](#6642) 进行操作。


## 3 设备检测


### 3.1 麦克风检测

#### 3.1.1 检测逻辑
麦克风设备检测流程如下图所示：

![麦克风检测流程](/Pics/Common/ZegoExpressEngine/Microphone_detection.png)

#### 3.1.2 对应接口

**1. 启动麦克风**

通过 [startPreview](/article/api?doc=Express_Video_SDK_API~ObjectiveC_ios~class~zego-express-engine&jumpType=route#start-preview) 接口在不推流的情况下启动音频采集。

***++需贴代码++***

**2. 检测麦克风权限**

ZEGO SDK 自动检查麦克风权限。若未授权，则会请求用户同意。

***++需贴代码++***

**3. 检测麦克风是否可用**

通过 [onDeviceError](/article/api?doc=Express_Video_SDK_API~ObjectiveC_ios~protocol~zego-event-handler&jumpType=route#on-device-error-device-name) 监听设备是否异常，若未检测到任何异常反馈（可同步启动“4. 检测麦克风收音数据”），且麦克风收音数据检测正常，则麦克风设备可用。

***++需贴代码++***

**4. 检测麦克风收音数据**

通过声浪接口，获取麦克风采集到声音的能量值，如果数据无异常则麦克风正常，可用于通话。

***++需补充声浪接口，然后贴上相应代码++***


### 3.2 摄像头检测   

#### 3.2.1 检测逻辑

摄像头设备检测流程如下图所示：

![摄像头检测流程](/Pics/Common/ZegoExpressEngine/Camera_detection.png)


#### 3.2.2 对应接口

**1. 启动摄像头** 

通过 [startPreview](/article/api?doc=Express_Video_SDK_API~ObjectiveC_ios~class~zego-express-engine&jumpType=route#start-preview) 接口绑定摄像头预览画面的 View，在不推流的情况下启动视频采集并预览。

***++需贴代码++***

**2. 检测摄像头权限**

ZEGO SDK 会自动检查摄像头权限。若未授权，则会请求用户同意。

***++需贴代码++***

**3. 检测摄像头是否可用**

通过 [onDeviceError](/article/api?doc=Express_Video_SDK_API~ObjectiveC_ios~protocol~zego-event-handler&jumpType=route#on-device-error-device-name) 监听设备是否异常，若未检测到任何异常反馈（可同步启动“4. 检测画面是否正常”），且画面显示正常，则设备可用。

***++需贴代码++***

**4. 检测画面是否正常**

若此时画面显示正常，则摄像头正常，可用于通话。


### 3.3 播放设备检测   

#### 3.3.1 检测逻辑

播放设备检测流程如下图所示：

![播放设备检测流程](/Pics/Common/ZegoExpressEngine/Playback_device_detection.png)

#### 3.3.2 对应接口

**1. 使用媒体播放器播放音频文件** 

如果使用的是 ZEGO 媒体播放器，则可以使用以下接口播放您用于测试的音频文件（研发补充）。

***++使用哪些接口需补充，需贴代码；如果使用非ZEGO媒体播放器，需要使用哪些接口？++***

**2. 检测是否听到声音**

如果可以听到相应的音频，则播放设备正常，可用于通话。

***++需贴代码++***


## 4 API 参考列表

| 方法 | 描述 |
|----|----|
|[setRoomMode](@setRoomMode)|设置房间模式|
|[loginRoom](@loginRoom)|登录房间|
|[logoutRoom](@logoutRoom)|退出房间|
|[startPublishingStream](/article/api?doc=Express_Video_SDK_API~ObjectiveC_ios~class~zego-express-engine&jumpType=route#start-publishing-stream-config-channel)|开始推流|
|[startPlayingStream](/article/api?doc=Express_Video_SDK_API~ObjectiveC_ios~class~zego-express-engine&jumpType=route#start-playing-stream-canvas-config)|开始拉流|


## 5 常见问题

#### 1. 设备异常如何恢复？

FAQ需要着重于onDeviceError返回的错误解释和恢复，同时常见的异常问题且无法捕获错误的也要说明，如：mic静音，播放设备播放音量为0等等
