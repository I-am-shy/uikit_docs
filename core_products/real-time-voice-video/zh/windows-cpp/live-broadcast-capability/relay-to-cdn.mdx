# 使用 CDN 直播

---

## 功能简介
	 
@@@Push_Pull_Streaming_via_CDN@@@

## 前提条件

在使用 CDN 直播之前，请确保：

@@@Express-Video_Prerequisites@@@

@@@Enable_CDN@@@

## 示例源码下载

请参考 [下载示例源码\|_blank](!DownloadDemo/DownloadDemo) 获取源码。

相关源码请查看 “/ZegoExpressExample/Examples/AdvancedStreaming/StreamByCDN” 目录下的文件。

## 转推 CDN

@@@Express_Started_to_Retweet@@@                     

```C++
// 推流成功后，开始转推到 CDN

// 推流时使用的流 ID
std::string streamID = "STREAM_ID";
// 需要转推的 CDN 地址，请开发者按照实际 URL 填入，streamID 为推流的流名，可自定义
std::string URL = "rtmp://推流域名/接入点/streamID";
engine->addPublishCdnUrl(streamID, URL, [=](int errorCode){
    if(errorCode == 0) 
    {
        // 转推成功
    } else 
    {
        // 转推失败，可能由于网络原因转推请求发送失败        
    }
});
```
   
   
### 4 （可选）监听 CDN 回调的状态通知

若需监听 CDN 回调的状态通知，可参考 [监控 CDN 转推状态\|_blank](!Publisher_Player_Advanced/MonitorStreamQuality#4_8)。

### 5 停止转推

调用 [removePublishCdnUrl\|_blank](@removePublishCdnUrl) 即可删除动态转推至 CDN 的 URL。**调用 [removePublishCdnUrl\|_blank](@removePublishCdnUrl) 接口停止转推时，请确保当前流 streamID 是存在的。**

<div class = 'mk-warning'>
	 
该接口并不会停止推往 ZEGO 实时音视频云的音视频流。

</div>

```C++
// 推流时使用的流 ID
std::string streamID = "STREAM_ID";
// 需要停止转推的 CDN 地址，请开发者按照实际 URL 填入，streamID 为推流的流名
std::string URL = "rtmp://推流域名/接入点/streamID";
engine->removePublishCdnUrl(streamID, URL, [=](int errorCode){
    if(errorCode == 0) 
    {
        // 停止转推成功
    } else 
    {
        // 停止转推失败，可能由于网络原因停止转推请求发送失败
    }
});
```

## 直推 CDN 
@@@Express_Started_to_Push_Directly@@@

```C++
ZegoCDNConfig config;
// URL 需要开发者根据实际情况填写，streamID 为推流的流名，可自定义
config.url = "rtmp://推流域名/接入点/streamID";
engine->enablePublishDirectToCDN(true, &config);
engine->startPublishingStream("STREAM_ID");
```

### 2 停止直推 CDN 

若需停止直推 CDN，调用 [stopPublishingStream\|_blank](@stopPublishingStream) 接口停止推流即可。

停止推流后，若下一次推流无需直推 CDN，则可以调用 [enablePublishDirectToCDN\|_blank](@enablePublishDirectToCDN) 接口并传值为 “false” 关闭直推 CDN 功能。在推流途中调用此接口不会影响此次推流。

```C++
engine->stopPublishingStream();
ZegoCDNConfig cdnConfig;
engine->enablePublishDirectToCDN(false, &cdnConfig);
```

## 观众拉流

@@@Audience_Pull@@@
