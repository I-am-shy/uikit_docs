---
articleID: 18876
---
# 推流视频增强

- - -

@@@Publishing_Video_Enhanced_intro_new@@@

## 前提条件

在使用推流视频增强功能前，请确保：

@@@Express-Video_Prerequisites@@@

## 使用步骤

### 1 初始化和登录房间

初始化和登录房间的具体流程，请参考实现视频通话文档中的 “[创建引擎](!Integration/Solution_Implementation#CreateEngine)” 及 “[登录房间](!Integration/Solution_Implementation#createroom)”。

### 2 设置推流视频增强效果

请根据需要，选择对应的功能进行配置。

<details class="zg-primary">
    <summary>基础美颜</summary>

<div class="mk-hint">

此功能为 ZEGO Express SDK 内置 ZEGO Effects SDK 的基础美颜功能，仅包含美白、红润、磨皮、锐化四种美颜效果。如需使用更多进阶的美颜功能，请参考 [实时音视频和 AI 美颜的搭配使用](https://doc-zh.zego.im/article/11256)。
</div>

#### 1 初始化基础美颜环境

若您需要使用基础美颜功能，则必须在 [startPreview](@startPreview) 开始预览、[startPublishingStream](@startPublishingStream) 推流前，调用 [startEffectsEnv](@startEffectsEnv) 接口初始化美颜环境。

```java
// 创建美颜环境
ZegoExpressEngine.getEngine().startEffectsEnv();
```

当初始化美颜环境后，SDK 内部会使用固定的视频帧数据类型进行传输，如果您使用基础美颜功能时还需要使用到视频自定义前处理，则只能配置相对应的视频帧数据类型：

Android 平台：只支持 Texture 2D 类型的数据，即 [ZegoCustomVideoCaptureConfig](/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-entity-zego-custom-video-capture-config&jumpType=route) 的 [bufferType](/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-entity-zego-custom-video-capture-config&jumpType=route#buffer-type) 取值为 “GL_TEXTURE_2D”。

#### 2 开关基础美颜效果 

@@@Express_switch_basic_beauty@@@

```java
// 开关美颜效果
ZegoExpressEngine.getEngine().enableEffectsBeauty(true);
```

#### 3 设置基础美颜效果参数

@@@Express_set_basic_beauty_parameters@@@

```java
// 创建美颜参数对象
ZegoEffectsBeautyParam beautyParam = new ZegoEffectsBeautyParam();

// 美白、红润、磨皮、锐化
beautyParam.whitenIntensity = 50;
beautyParam.rosyIntensity = 50;
beautyParam.smoothIntensity = 50;
beautyParam.sharpenIntensity = 50;

// 设置美颜参数
ZegoExpressEngine.getEngine().setEffectsBeautyParam(beautyParam);
```

#### （可选）销毁基础美颜环境

@@@Express_destroys_the_basic_beauty_environment@@@

```java
// 销毁美颜环境
ZegoExpressEngine.getEngine().stopEffectsEnv();
```
</details>


<details class="zg-primary">
    <summary>低照度增强</summary>

ZEGO 提供两种低照度增强的方式：
    
<table>
  <colgroup>
    <col width="30%">
    <col width="70%">
  </colgroup>
<tbody><tr>
<th>方式</th>
<th>描述</th>
</tr>
<tr>
<td>开启自适应帧率进行增强</td>
<td>在设定的帧率范围内动态降低采集帧率，以延长每一帧的画面曝光时间，达到增强采集到的画面亮度的效果。
<br> 例如：开发者开启并设置自适应帧率范围为 [10, 25]。环境光照充足的时候，采集帧率依然是 25 帧，环境光照度较低的时候，采集帧率会在 [10, 25] 之间动态调整，以延长每一帧的曝光时间增强采集画面的亮度。</td>
</tr>
<tr>
<td>算法对采集到的画面亮度进行增强</td>
<td><ul>
<li>手动控制：开发者自主控制算法开关。</li>
<li>智能控制：根据画面光照情况，智能开启或关闭算法。</li></ul></td>
</tr>
</tbody></table>

两种处理方式可以独立使用，也可以同时使用，均兼容美颜功能。

#### 1 设置低照度增强模式

RTC SDK 支持不同的算法低照度增强模式，调用 [setLowlightEnhancement](@setLowlightEnhancement) 接口进行设置低照度增强模式 [ZegoLowlightEnhancementMode](@-ZegoLowlightEnhancementMode)：

|枚举值|说明|
|-|-|
|ZegoLowlightEnhancementMode.OFF| 关闭低照度增强功能。|
|ZegoLowlightEnhancementMode.ON|开启低照度增强功能，由开发者自主控制。|
|ZegoLowlightEnhancementMode.AUTO|智能控制低照度增强功能，根据画面光照情况，智能开启或关闭功能。|

低照度增强类型 [ZegoExpLowlightEnhancementType](@-ZegoExpLowlightEnhancementType) 包括如下类型：

|枚举值|说明|
|-|-|
| ZegoExpLowlightEnhancementType.Normal | 常规低照度增强。|
| ZegoExpLowlightEnhancementType.AI | AI 低照度增强。如需要使用此功能，需要联系 ZEGO 技术支持。|

以开启自动低照度增强功能为例：

```java
ZegoExpLowlightEnhancementParams params = new ZegoExpLowlightEnhancementParams();
params.mode = ZegoLowlightEnhancementMode.AUTO;
params.type = ZegoExpLowlightEnhancementType.AI;
engine.setLowlightEnhancementParams(params, ZegoPublishChannel.MAIN);
```


#### 2 （可选）开启摄像头自适应帧率

当环境光照度较低，且摄像头采集帧率过高时，每一帧画面的曝光时间不足，可能导致采集的视频画面偏暗，此时可以通过 [enableCameraAdaptiveFPS](@enableCameraAdaptiveFPS) 开启摄像头自适应帧率。SDK 会根据设置的帧率范围匹配摄像头支持的采集帧率范围，在此范围内，根据环境亮度动态调整摄像头采集帧率，提升设置的帧率过高时的画面亮度。

```java
//设置最小帧率
int minCamFPS = getIntent().getIntExtra("camMinFPS", 0);
//设置最大帧率
int maxCamFPS = getIntent().getIntExtra("camMaxFPS", 0);
engine.enableCameraAdaptiveFPS(true, minCamFPS, maxCamFPS, ZegoPublishChannel.MAIN);
```
</details>

<details class="zg-primary">
    <summary>视频降噪</summary>

调用 [setVideoDenoiseParams](@setVideoDenoiseParams) 接口，设置视频降噪参数 [ZegoVideoDenoiseParams](@-ZegoVideoDenoiseParams) 包括：视频降噪模式 [ZegoVideoDenoiseMode](@-ZegoVideoDenoiseMode) 及视频降噪强度 [ZegoVideoDenoiseStrength](@-ZegoVideoDenoiseStrength)。

<div class="mk-warning">

默认不开启视频降噪功能，即 [ZegoVideoDenoiseMode](@-ZegoVideoDenoiseMode) 默认值为 `ZegoVideoDenoiseMode.off`。
</div>

以设置自动降噪为例：

```java
ZegoVideoDenoiseParams p = new ZegoVideoDenoiseParams();
p.mode = ZegoVideoDenoiseMode.AUTO;
p.strength = ZegoVideoDenoiseStrength.LIGHT;
engine.setVideoDenoiseParams(p, ZegoPublishChannel.MAIN);
```

</details>

<details class="zg-primary">
    <summary>色彩增强</summary>

调用 [enableColorEnhancement](@enableColorEnhancement) 接口，设置色彩增强参数 [ZegoColorEnhancementParams](@-ZegoColorEnhancementParams)（参数属性如下表）、以及其它参数，开启色彩增强功能。**默认不开启色彩增强功能。**

|色彩增强参数|描述|
|-|-|
| intensity|<p>色彩增强的强度，取值范围 [0.0, 1.0]，默认为 0.0。</p><p>取值越大，色彩增强的效果越大。</p>|
| skinToneProtectionLevel |<p>肤色保护的强度，取值范围 [0.0, 1.0]，默认为 1.0。</p><p>取值越大，保护效果越好。</p>|
| lipColorProtectionLevel |<p>唇色保护的强度，取值范围 [0.0, 1.0]，默认为 0.0。</p><p>取值越大，保护效果越好。</p>|


```java
ZegoColorEnhancementParams p = new ZegoColorEnhancementParams();
p.intensity = 1;//取值范围：[0,1]，取值越大，色彩增强的强度越大。默认值：0。
p.skinToneProtectionLevel = 1;//取值范围：[0,1]，取值越大，肤色保护程度越大。默认值：1。
p.lipColorProtectionLevel = 1;//取值范围：[0,1]，取值越大，唇色保护程度越大。默认值：0。
engine.enableColorEnhancement(true, p, ZegoPublishChannel.MAIN);//开启色彩增强
```

</details>

### 3 开始预览

调用 [startPreview](@startPreview) 接口开启预览后，可以设置不同的视频增强功能，并实时体验效果。

```java
ZegoCanvas previewCanvas = new ZegoCanvas(preview);
engine.startPreview(previewCanvas);
```

### 4 开始推流

当预览效果达到预期后，可以调用 [startPublishingStream](@startPublishingStream) 接口开始推流，推流画面效果将与预览效果一致。

```java
engine.startPublishingStream("STREAM_ID");
```

以上，即可实现推流前视频增强功能。
