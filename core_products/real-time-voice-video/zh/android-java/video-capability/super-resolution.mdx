# 超分辨率

- - - -

## 功能简介

@@@Express_super_resolution_info@@@


## 示例源码

请参考 [下载示例源码\|_blank](#3125) 获取源码。

相关源码请查看 “/ZegoExpressExample/Others/SuperResolution” 目录下的文件。

## 前提条件

@@@Express_super_resolution_pre@@@



## 实现流程

### 1 初始化和登录房间

初始化和登录房间的具体流程，请参考实现视频通话文档中的 “[3.1 创建引擎\|_blank](!Integration/Solution_Implementation#4_1)”及“[3.2 登录房间\|_blank](!Integration/Solution_Implementation#4_2)”。

### 2 监听超分状态回调

开启超分功能后，可通过 [onPlayerVideoSuperResolutionUpdate\|_blank](@onPlayerVideoSuperResolutionUpdate) 确认超分功能是否成功开启。

超分功能状态定义如下：

|枚举值|说明|
|-|-|
|ZegoSuperResolutionStateOff| 超分功能关闭。|
|ZegoSuperResolutionStateOn|超分功能开启。|

通过 [onPlayerVideoSizeChanged\|_blank](@onPlayerVideoSizeChanged) 可获取超分功能开启后的拉流视频分辨率。

```java
engine.setEventHandler(new IZegoEventHandler() {
    // 拉流视频分辨率发生变化的通知
    @Override
    public void onPlayerVideoSizeChanged(String streamID, int width, int height) {
        super.onPlayerVideoSizeChanged(streamID, width, height);

    }
    // 超分状态发生变化的通知
    @Override
    public void onPlayerVideoSuperResolutionUpdate(String streamID, ZegoSuperResolutionState state, int errorCode) {
        super.onPlayerVideoSuperResolutionUpdate(streamID, state, errorCode);

        if(state == ZegoSuperResolutionState.ON) {
            // 超分已开启
        }else if(state == ZegoSuperResolutionState.OFF) {
            // 超分已关闭
            if(errorCode == 0){
                // 正常关闭
            }
            else if(errorCode == 1004004){
                // 该设备不支持超分
            }
            else if(errorCode == 1004005){
                // 超分流数量超过限制，仅支持一条流超分
            }
            else if(errorCode == 1004006){
                // 超分原始分辨率超过限制
            }
            else if(errorCode == 1004007){
                // 超分设备性能不足
            }
            else if(errorCode == 1004008){
                // 超分未初始化，请先初始化超分
            }
        }
    }
});
```

### 3 初始化视频超分

在使用超分功能前，需要调用 [initVideoSuperResolution\|_blank](@initVideoSuperResolution) 接口初始化超分。

<div class = "mk-warning">

初始化视频超分为耗时操作，在 SDK 生命周期执行一次即可，不建议频繁初始化、反初始化超分。

</div>

```java
engine.initVideoSuperResolution();
```


### 4 开启视频超分

开发者可以选择在拉流前或者拉流中开启视频超分功能，以在拉流前对流 “STREAM_ID” 开启超分功能为例：

```java
engine.enableVideoSuperResolution("STREAM_ID", true);
```

开启超分功能后，需要监听回调 [onPlayerVideoSuperResolutionUpdate\|_blank](@onPlayerVideoSuperResolutionUpdate) ，以确认此次超分功能是否开启成功。

<div class = "mk-warning">

为了便于管理超分状态，建议在收到超分状态回调后，再开启下一次超分功能。

</div>

### 5 开始拉流

调用 [startPlayingStream\|_blank](@startPlayingStream)，传入 “STREAM_ID” 拉取远端用户的音视频流。

```java
engine.startPlayingStream("STREAM_ID", new ZegoCanvas(playView));
```

### 6 关闭视频超分

当不需要超分功能或者开启超分功能过程中发生错误（性能不足或原始视频分辨率超过限制）时，可关闭超分功能以释放系统资源。

```java
engine.enableVideoSuperResolution("STREAM_ID", false);
```

### 7 停止拉流

停止拉流后，SDK 会自动关闭超分功能并释放占用的系统资源。

```java
engine.stopPlayingStream("STREAM_ID");
```

### 8 反初始化视频超分

当不需要视频超分功能时，可以调用 [uninitVideoSuperResolution\|_blank](@uninitVideoSuperResolution) 接口反初始化视频超分，以节省内存。

```java
engine.uninitVideoSuperResolution();
```
