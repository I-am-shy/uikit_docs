---
articleID: 17421
---
# 播放透明礼物特效

- - -

## 功能简介

@@@gift_special_effects_info@@@

## 前提条件

在使用媒体播放器播放 MP4 动态效果，即实现播放透明礼物特效之前，请确保：

@@@Express-Video_Prerequisites@@@



## 实现流程

### 1 输出素材

@@@Express_gift_special_effects_step1@@@

### 2 对 view 进行特殊设置

在播放透明礼物特效前，需要提前设置用于播放器渲染透明特效的 view，目前支持 TextureView 和 SurfaceView 两种。

- 若 view 为 TextureView 类型，需要调用 `setOpaque`，将 opaque 属性设置为 false。  

```java
TextureView mediaPlayerView;//用于播放的 view
mediaPlayerView.setOpaque(false);
```

- 若 view 为 SurfaceView 类型，需要调用 `setFormat`，将 PixelFormat 属性设置为 TRANSLUCENT，并且需要把 view 置于显示窗口的最顶层。

```java
SurfaceView mediaPlayerView;//用于播放的 view
mediaPlayerView.getHolder().setFormat(PixelFormat.TRANSLUCENT)
mediaPlayerView.setZOrderOnTop(true)//把 SurfaceView 置于显示窗口的最顶层
```

### 3 创建媒体播放器

调用 [createMediaPlayer\|_blank](@createMediaPlayer) 创建媒体播放器，并调用 [setPlayerCanvas\|_blank](@setPlayerCanvas-ZegoMediaPlayer) 设置媒体播放器 canvas 的 alphaBlend 属性为 true。

```java
mediaPlayer = engine.createMediaPlayer();
ZegoCanvas canvas = new ZegoCanvas(mediaPlayerView);
canvas.alphaBlend = true;//支持 Alpha 通道渲染
mediaPlayer.setPlayerCanvas(canvas);
```

### 4 加载素材

调用 [createMediaPlayer\|_blank](@createMediaPlayer) 创建媒体播放器后，通过 [loadResourceWithConfig\|_blank](@loadResourceWithConfig) 接口，通过**文件路径**或**二进制内存数据**，播放拼接后的特效素材。

<div class="mk-warning">

虽然 [loadResourceWithConfig\|_blank](@loadResourceWithConfig) 接口支持通过版权音乐资源 ID 加载多媒体资源，但是版权音乐目前不支持视频，因此无法通过版权音乐资源 ID 加载方式来加载礼物特效。
</div>

<div class="multiple-select-codes">
    <div class="code-tabs hide-scrollbar">
      <div class="scroll-box">
        <span class="tab-item">
          <span>通过文件路径加载</span>
        </span>
        <span class="tab-item">
          <span>通过二进制内存数据加载</span>
        </span>
      </div>
    </div>

  <div class="code-list">
  
  ```java
  ZegoMediaPlayerResource resource = new ZegoMediaPlayerResource();
  resource.loadType = ZegoMultimediaLoadType.FILE_PATH; // 加载方式选择文件路径加载
  resource.filePath = "path";//文件路径
  resource.alphaLayout = ZegoAlphaLayoutType.LEFT; // 根据实际资源选择 Alpha 通道布局
  mediaPlayer.loadResourceWithConfig(resource, new IZegoMediaPlayerLoadResourceCallback() {
      @Override
      public void onLoadResourceCallback(int errorCode) {
          //资源加载结果
          // 可执行更新 UI 等逻辑
          if (errorCode == 0){
              //加载文件成功，此时可以开始播放媒体资源
              mediaPlayer.start();
          }
      }
  });
  ```
  
  ```java
  ZegoMediaPlayerResource resource = new ZegoMediaPlayerResource();
  resource.loadType = ZegoMultimediaLoadType.MEMORY; // 加载方式选择二进制内存数据
  resource.alphaLayout = ZegoAlphaLayoutType.LEFT; // 根据实际资源选择 Alpha 通道布局

  File file = new File(path); // 资源文件
  int fileLength = (int)file.length();

  resource.memory = ByteBuffer.allocateDirect(fileLength); // ByteBuffer 类型二进制内存数据
  resource.memoryLength = bufferLength; // 二进制内存数据长度

  // 将资源加载到内存中
  try {
      BufferedInputStream stream = new BufferedInputStream(new FileInputStream(file));
      int data_byte=0;
      while((data_byte = stream.read()) != -1){
          resource.memory.put((byte)data_byte);
      }
  } catch (FileNotFoundException e) {
      e.printStackTrace();
  } catch (IOException e) {
      e.printStackTrace();
  }

  mediaPlayer.loadResourceWithConfig(resource, new IZegoMediaPlayerLoadResourceCallback() {
      @Override
      public void onLoadResourceCallback(int errorCode) {
          // 资源加载结果
          // 可执行更新 UI 等逻辑
          if (errorCode == 0){
              //加载文件成功，此时可以开始播放媒体资源
              mediaPlayer.start();
          }
      }    
  });
  ```
  
  </div>
</div>

### 5 播放素材

在调用 [loadResourceWithConfig\|_blank](@loadResourceWithConfig-ZegoMediaPlayer) 加载文件成功后，可调用 [start\|_blank](@start-ZegoMediaPlayer)、[pause\|_blank](@pause-ZegoMediaPlayer)、[resume\|_blank](@resume-ZegoMediaPlayer)、[stop\|_blank](@stop-ZegoMediaPlayer) 来启停播放。一旦播放器的内部状态改变，[ZegoMediaPlayer\|_blank](@-ZegoMediaPlayer) 的 [onMediaPlayerStateUpdate](@onMediaPlayerStateUpdate-IZegoMediaPlayerEventHandler) 回调将会被触发。

用户也可通过调用 [getCurrentState\|_blank](@getCurrentState-ZegoMediaPlayer) 随时获取播放器的当前状态。

如果 [enableRepeat\|_blank](@enableRepeat-ZegoMediaPlayer) 设置为 `YES`，则播放器会在播放完文件后自动重播。

```java
// 开始播放，播放之前需要先调用接口加载媒体文件
mediaPlayer.start();
// 暂停
mediaPlayer.pause();
// 恢复
mediaPlayer.resume();
// 停止
mediaPlayer.stop();
```
