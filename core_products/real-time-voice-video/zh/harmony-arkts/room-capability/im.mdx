---
articleID: 19414
---
# 实时消息与信令

- - -

## 功能简介

@@@message_intro@@@

## 示例源码下载

请参考 [下载示例源码](!DownloadDemo/DownloadDemo) 获取源码。

相关源码请查看 “/page/Topics/RoomMessage/” 目录下的文件 RoomMessage.ets。

## 前提条件

在实现房间实时消息之前，请确保：

@@@Express-Video_Prerequisites@@@

## 使用步骤

### 收发广播消息

1. **发送广播消息**

    调用 [sendBroadcastMessage ](/unique-api/express-video-sdk/zh/ets_ohos/classes/_zegoexpressengine_.zegoexpressengine.html#sendbroadcastmessage) 接口向同一房间内的其他用户发送广播消息，长度不能超过 1024 字节。

    通过 [ZegoIMSendBroadcastMessageResult ](/unique-api/express-video-sdk/zh/ets_ohos/interfaces/_zegoexpressdefines_.zegoimsendbroadcastmessageresult.html) 异步结果的返回获取消息发送结果。

    ```ets
    // 发送广播消息
    this.ZegoExpressInstance.sendBroadcastMessage(this.currentRoomID, this.broadMessage).then((result: ZegoIMSendBroadcastMessageResult) => {
        // 获取消息发送结果
    })
    ```

2. **接收广播消息**

    通过监听 [onIMRecvBroadcastMessage ](/unique-api/express-video-sdk/zh/ets_ohos/interfaces/_zegoexpresseventhandler_.zegoeventlistener.html#onimrecvbroadcastmessage) 的事件回调，当发送方成功发送广播消息后，同一房间内的其他用户通过此回调接收相关信息，包括消息内容、消息 ID、发送时间及发送方信息。

    ```ets
    // 收到其他用户发送消息
    this.ZegoExpressInstance.on('onIMRecvBroadcastMessage', (roomID: string, messageList: ZegoBroadcastMessageInfo[]) => {
        if(messageList.length >0)
        {
            this.logInfo('onIMRecvBroadcastMessage. roomID: ' + roomID + ", message: "  + messageList[0].message)
        }
    })
    ```

### 收发弹幕消息

1. **发送弹幕消息**

    调用 [sendBarrageMessage ](/unique-api/express-video-sdk/zh/ets_ohos/classes/_zegoexpressengine_.zegoexpressengine.html#sendbarragemessage) 接口向同一房间内的其他用户发送弹幕消息，长度不能超过 1024 字节。

    通过 [ZegoIMSendBarrageMessageResult ](/unique-api/express-video-sdk/zh/ets_ohos/interfaces/_zegoexpressdefines_.zegoimsendbarragemessageresult.html) 异步结果的返回获取消息发送结果。

    ```ets
    // 发送房间弹幕消息
    this.ZegoExpressInstance.sendBarrageMessage(this.currentRoomID, this.barraMessage).then((result: ZegoIMSendBarrageMessageResult) => {
        // 获取消息发送结果
    })
    ```

2. **接收弹幕消息**

    通过监听 [onIMRecvBarrageMessage ](/unique-api/express-video-sdk/zh/ets_ohos/interfaces/_zegoexpresseventhandler_.zegoeventlistener.html#onimrecvbarragemessage) 的事件回调，当发送方成功发送弹幕消息后，同一房间内的其他用户通过此回调接收相关信息，包括消息内容、消息 ID、发送时间及发送方信息。

    ```ets
    // 收到其他用户发送消息
    this.ZegoExpressInstance.on('onIMRecvBarrageMessage', (roomID: string, messageList: ZegoBarrageMessageInfo[]) => {
        if(messageList.length >0)
        {
            this.logInfo('onIMRecvBarrageMessage. roomID: ' + roomID + ", message: "  + messageList[0].message)
        }
    })
    ```

### 收发自定义信令

1. **发送自定义信令**

    调用 [sendCustomCommand ](/unique-api/express-video-sdk/zh/ets_ohos/classes/_zegoexpressengine_.zegoexpressengine.html#sendcustomcommand) 接口向同一房间内通过 “toUserList” 指定的用户发送自定义信令，长度不能超过 1024 字节。

    通过 [ZegoIMSendCustomCommandResult ](/unique-api/express-video-sdk/zh/ets_ohos/interfaces/_zegoexpressdefines_.zegoimsendcustomcommandresult.html) 异步结果的返回获取消息发送结果。

    ```ets
    // 发送自定义信令，`toUserList` 中指定的用户才可以通过 IMRecvCustomCommand 事件收到此信令
    // 若 `toUserList` 参数不传， 则 SDK 将发送该信令给房间内所有用户
    this.ZegoExpressInstance.sendCustomCommand(this.currentRoomID, this.customMessage, this.currentSelectUserIDList);
    ```

2. **接收自定义信令**

    通过监听 [onIMRecvCustomCommand ](/unique-api/express-video-sdk/zh/ets_ohos/interfaces/_zegoexpresseventhandler_.zegoeventlistener.html#onimrecvcustomcommand) 的事件回调，当发送方成功发送自定义信令后，同一房间内的指定用户通过此回调接收相关信息，包括消息内容和消息发送方信息。

    ```ets
   // 收到其他用户发送消息
   this.ZegoExpressInstance.on('onIMRecvCustomCommand', (roomID: string, fromUser: ZegoUser, command: string) => {
        this.logInfo('onIMRecvCustomCommand. roomID: ' + roomID + ", message: "  + command)
    })
    ```
