# 自定义音频处理

---

## 功能简介

自定义音频处理一般用于去除语音中的干扰，由于 SDK 已经对采集的音频原始数据进行了回声消除、噪声抑制等处理，通常情况下，开发者无需再重复处理。

如果开发者想在采集音频数据后或拉取远端音频数据渲染前，通过自定义处理实现特殊功能时（例如变声、美声等），可以参考本文档。


@@@Express_audio_pre_data@@@



## 前提条件

在自定义音频处理之前，请确保：

@@@Express-Video_Prerequisites@@@


## 使用步骤

### 1 创建 SDK 引擎

调用 [createEngineWithProfile \|_blank](@createEngineWithProfile) 接口创建 SDK 引擎实例，详情请参考 [快速开始 - 实现流程\|_blank](!Integration/Solution_Implementation#CreateEngine) 的 “创建引擎”。


### 2 设置音频自定义处理对象并实现回调方法

调用 [setCustomAudioProcessHandler\|_blank](@setCustomAudioProcessHandler) 接口设置音频自定义处理对象，并实现回调方法：自定义音频处理本地采集 PCM 音频帧回调 [onProcessCapturedAudioData\|_blank](@onProcessCapturedAudioData) 和自定义音频处理远端拉流 PCM 音频帧回调 [onProcessRemoteAudioData\|_blank](@onProcessRemoteAudioData)。在回调方法中直接处理获取的 `data`，即可实现对推拉流音频数据的处理。

```objc
[[ZegoExpressEngine sharedEngine] setCustomAudioProcessHandler:self];
- (void)onProcessCapturedAudioData:(unsigned char *)data dataLength:(unsigned int)dataLength param:(ZegoAudioFrameParam *)param timestamp:(double)timestamp{

}

- (void)onProcessRemoteAudioData:(unsigned char *)data dataLength:(unsigned int)dataLength param:(ZegoAudioFrameParam *)param streamID:(NSString *)streamID timestamp:(double)timestamp{

}
```


### 3 自定义音频处理

- 在开始推流或启动本地预览前，调用 [enableCustomAudioCaptureProcessing \|_blank](@enableCustomAudioCaptureProcessing) 接口开启**本地采集**自定义音频处理。开启后，开发者可以通过 [onProcessCapturedAudioData \|_blank](@onProcessCapturedAudioData) 回调收到本地采集的音频帧，并可以对音频数据进行修改。

- 在开始拉流前，调用 [enableCustomAudioRemoteProcessing \|_blank](@enableCustomAudioRemoteProcessing) 接口开启**远端拉流**自定义音频处理。开启后，开发者可以通过 [onProcessRemoteAudioData \|_blank](@onProcessRemoteAudioData) 收到远端拉流的音频帧，并且可以对音频数据进行修改。


```objc
ZegoCustomAudioProcessConfig *config = [[ZegoCustomAudioProcessConfig alloc] init];
config.channel = ZegoAudioChannelMono;
config.sampleRate = ZegoAudioSampleRate16K;
config.samples = 0;

[[ZegoExpressEngine sharedEngine] enableCustomAudioCaptureProcessing:YES config:config];
[[ZegoExpressEngine sharedEngine] enableCustomAudioRemoteProcessing:YES config:config];
```
