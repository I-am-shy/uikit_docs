---
articleID: 4431
---
# 设置视频编码方式

- - -

## 功能简介

针对 H.264 和 H.265 两种视频编码标准，ZEGO Express SDK 提供了多种视频编码方式，开发者可以根据自己的业务需要，选择合适的视频编码方式，实现推、拉视频流。

<table>
  <colgroup>
    <col width="20%">
    <col width="45%">
    <col width="35%">
  </colgroup>
<tbody><tr>
<th>视频编码方式分类</th>
<th>说明</th>
<th>适用场景</th>
</tr>
<tr>
<td>硬件编码</td>
<td><p>通过专用的硬件芯片或电路来实现视频编码功能。</p><p>同时支持 H.264 和 H.265 硬件编码。</p></td>
<td>【待补充】</td>
</tr>
<tr>
<td>软件编码</td>
<td><p>通过计算机的中央处理器（CPU）来进行视频压缩和编码。</p><ul><li>同时支持 OpenH264 和 x265 软件编码。</li><li>具有良好的视频压缩性能和广泛的兼容性。</li><li>支持多种分辨率和比特率的视频编码，并提供了各种编码参数的配置选项，以满足不同场景下的需求。</li><li>x265 软件编码比 OpenH264 软件编码压缩率更高，视觉质量更好。</li></ul></td>
<td>【待补充】</td>
</tr>
<tr>
<td><a href="!Big_and_small_streams_and_Layered_Encoding" target="blank">分层视频编码</a></td>
<td><p>启动 1 个编码器（目前仅支持 OpenH264 软件编码器，不支持硬件编码）分别编出不同的参数的码流，将码流分为基本层和扩展层，为不同网络状态的用户提供更好的体验。</p><p>基本层保证了最基本的视频质量，而扩展层则是对基本层的补充。对于网络较好的用户，可只拉取扩展层获得更好的体验，对于网络状态较差的用户，只拉取基本层可以保证基本的视频质量。</p></td>
<td rowspan="2"><p>“视频大小流编码”与“分层视频编码”的共同作用，是将码流分为大分辨率类型和小分辨率类型。适用于如下场景：</p><ul><li>需要不同终端显示不同质量的视频流。</li><li>需要在较差的网络环境中保持连麦的流畅。</li><li>需要根据网络状态自适应拉取视频流的质量。</li></ul><p>开发者请参考 <a href="!Big_and_small_streams_and_Layered_Encoding" target="blank">视频大小流和分层编码</a>，结合二者差异和业务具体诉求，选择实现“分层视频编码”或“视频大小流编码”。</p></td>
</tr>
<tr>
<td><a href="!Big_and_small_streams_and_Layered_Encoding" target="blank">视频大小流编码</a></td>
<td><p>启动 2 个编码器分别编出不同的参数的码流，将码流分为 “大流” 和 “小流”。</p><ul><li>同时支持硬件编码、软件编码。</li><li>同时支持 H.264 和 H.265 编码。</li></ul><p>开发者可以根据业务需要，设置“大流”、“小流”的搭配方式。</p></td>
</tr>
</tbody></table>

<div class="mk-hint">

由于少部分机型设备对硬件编码/解码的支持不佳，SDK 默认使用软件编码与软件解码的方式。        
</div>

## 示例源码下载

请参考 [下载示例源码\|_blank](!DownloadDemo/DownloadDemo) 获取源码。

相关源码请查看 “/ZegoExpressExample/Examples/AdvancedVideoProcessing/Encoding&Decoding” 目录下的文件。

## 前提条件

在设置视频编码方式之前，请确保：

@@@Express-Video_Prerequisites@@@


## 实现步骤

### 设置视频编码方式

在推流（[startPublishingStream\|_blank](@startPublishingStream)）前，调用 [setVideoConfig\|_blank](@setVideoConfig-ZegoExpressEngine) 接口，设置 “ZegoVideoConfig” 类下的参数 “codecID”，即可设置视频编码方式。目前支持的视频编码方式及取值如下：

<table>
  <colgroup>
    <col width="30%">
    <col width="30%">
    <col width="40%">
  </colgroup>
<tbody><tr>
<th>枚举值</th>
<th>编码方式（软件编码）</th>
<th>说明</th>
</tr>
<tr>
<td>ZegoVideoCodecIDDefault</td>
<td>默认编码（H.264）</td>
<td>H.264 是被广泛使用的高精度视频的录制、压缩和发布格式，拥有很好的兼容性。</td>
</tr>
<tr>
<td>ZegoVideoCodecIDSVC</td>
<td>分层视频编码（H.264 SVC）</td>
<td>启动 1 个编码器分别编出不同的参数的码流，作为码流的基本层和扩展层。</td>
</tr>
<tr>
<td>ZegoVideoCodecIDVP8</td>
<td>VP8</td>
<td>常用于 Web 视频，但不能用在 CDN 录制场景中，否则会造成录制文件异常。</td>
</tr>
<tr>
<td>ZegoVideoCodecIDH265</td>
<td>H.265</td>
<td>与 H.264 相比，拥有更好的压缩率，但使用时需要考虑兼容性。</td>
</tr>
<tr>
<td>ZegoVideoCodecIDH264DualStream</td>
<td>视频大小流编码（H.264 DualStream）</td>
<td>启动 2 个编码器分别编出不同的参数的码流，作为码流的基本层和扩展层。<br>适用于 SVC 不满足业务需要的场景（例如：希望同时使用硬件编码）。</td>
</tr>
</tbody></table>

以设置编码方式为 H.265 为例：

```objc
ZegoVideoConfig *videoConfig = [[ZegoVideoConfig alloc] init];
videoConfig.codecID = ZegoVideoCodecIDH265;
[[ZegoExpressEngine sharedEngine] setVideoConfig:videoConfig];
```

指定视频编码方式后，调用 [startPublishingStream\|_blank](@startPublishingStream) 接口推流、调用 [startPlayingStream\|_blank](@startPlayingStream) 接口拉流即可。

<div class="mk-hint">

- 如果您通过 [setVideoConfig\|_blank](@setVideoConfig-ZegoExpressEngine) 接口指定视频编码方式为 `ZegoVideoCodecIDSVC`，请参考 <a href="!Big_and_small_streams_and_Layered_Encoding#4_1" target="blank">分层视频编码</a>，拉取指定的分层视频流。
- 如果您通过 [setVideoConfig\|_blank](@setVideoConfig-ZegoExpressEngine) 接口指定视频编码方式为 `ZegoVideoCodecIDH264DualStream`，请参考 <a href="!Big_and_small_streams_and_Layered_Encoding#4_2" target="blank">视频大小流编码</a>，设置大流、小流参数后，再拉取指定的视频流。
</div>


### 设置硬件编解码

如果您的硬件设备支持使用硬件解码，请参考如下设置。

1. 开发者需要调用 [enableHardwareEncoder\|_blank](@enableHardwareEncoder) 接口，开启硬件编码。

    - 该接口调用后，SDK 同时支持 H.264 和 H.265 硬件编码。
    - 该接口需要在 [startPublishingStream\|_blank](@startPublishingStream) 接口之前调用才能生效；如果正在推流，需要调用 [stopPublishingStream\|_blank](@stopPublishingStream) 接口停止推流后、再重新推流才可以生效。

    ```objc
    // 开启硬件编码
    [[ZegoExpressEngine sharedEngine] enableHardwareEncoder:YES];
    ```

2. 开发者需要调用 [enableHardwareDecoder\|_blank](@enableHardwareDecoder) 接口，开启硬件解码。

    该接口需要在 [startPlayingStream\|_blank](@startPlayingStream) 接口之前调用才能生效；如果正在拉流，需要调用 [stopPlayingStream\|_blank](@stopPlayingStream) 接口停止拉流后、再重新拉流才可以生效。

    ```objc
    // 开启硬件解码
    [[ZegoExpressEngine sharedEngine] enableHardwareDecoder:YES];
    ```

## 常见问题

@@@Big_and_small_streams_and_Layered_Encoding_FAQ@@@

2. [如何解决 Web 平台和 Native 平台互通时出现的画面异常问题（如黑屏、绿屏、花屏等）？\|_blank](https://doc-zh.zego.im/faq/web_native_video)
