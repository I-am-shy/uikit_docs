# 播放透明礼物特效

- - -

## 功能简介

@@@gift_special_effects_info@@@

## 前提条件

在使用媒体播放器播放 MP4 动态效果，即实现播放透明礼物特效之前，请确保：

@@@Express-Video_Prerequisites@@@



## 实现流程

### 1 输出素材

@@@Express_gift_special_effects_step1@@@


### 2 创建媒体播放器

调用 [createMediaPlayer\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressengine_.zegoexpressengine.html#createmediaplayer) 创建媒体播放器。

```javascript
ZegoExpressEngine.instance().createMediaPlayer().then((player) => {
  this.mediaPlayer = player;
});
```

### 3 加载素材

调用 [createMediaPlayer\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressengine_.zegoexpressengine.html#createmediaplayer) 创建媒体播放器后，通过 [loadResourceWithConfig\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressdefines_.zegomediaplayer.html#loadresourcewithconfig) 接口，通过**文件路径**或**二进制内存数据**，播放拼接后的特效素材。

<div class="mk-warning">

虽然 [loadResourceWithConfig\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressdefines_.zegomediaplayer.html#loadresourcewithconfig) 接口支持通过版权音乐资源 ID 加载多媒体资源，但是版权音乐目前不支持视频，因此无法通过版权音乐资源 ID 加载方式来加载礼物特效。
</div>

<div class="multiple-select-codes">
    <div class="code-tabs hide-scrollbar">
      <div class="scroll-box">
        <span class="tab-item">
          <span>通过文件路径加载</span>
        </span>
        <span class="tab-item">
          <span>通过二进制内存数据加载</span>
        </span>
      </div>
    </div>

  <div class="code-list">
  
  ```javascript
  let resource = new ZegoMediaPlayerResource()
  let path = "/static/source1_complex_rl.mp4"
  resource.loadType = ZegoMultimediaLoadType.FilePath //加载方式选择文件路径加载
  resource.filePath = plus.io.convertLocalFileSystemURL(path) //文件路径
  resource.alphaLayout = ZegoAlphaLayoutType.Left //根据实际资源选择 Alpha 通道布局
  this.mediaPlayer.loadResourceWithConfig(resource).then((ret) => {
      console.log("load resource error: " + ret.errorCode)
  });
  ```

  ```javascript
  // 加载资源文件并返回二进制数据
  let path = "/static/source1_complex_rl.mp4"
  plus.io.resolveLocalFileSystemURL(path, function(entry) {  
      entry.file(function(file) {  
          var fileReader = new plus.io.FileReader()  
          fileReader.onload = function(data) {  
              let base64 = data.result.split(',')[1] // 获取base64字符串
              const arrayBuffer = uni.base64ToArrayBuffer(base64) // 转换为arrayBuffer 格式
              const int8array = new Uint8Array(arrayBuffer)
            
              let resource = new ZegoMediaPlayerResource()
              resource.loadType = ZegoMultimediaLoadType.Memory // 加载方式选择二进制数据加载
              resource.alphaLayout = ZegoAlphaLayoutType.Left // 根据实际资源选择 Alpha 通道布局
              resource.memory = int8array

              this.mediaPlayer.loadResourceWithConfig(resource).then((ret) => {
                console.log("load resource error: " + ret.errorCode)
              });
          }  
          fileReader.readAsDataURL(file)  
      }, function(error) {  
          console.log("load resource error: " + JSON.stringify(error));  
      })  
  }, function(error) {  
      console.log("load resource error: " + JSON.stringify(error))
  })               
  ```
  
  </div>
</div>

### 4 播放素材

在调用 [loadResourceWithConfig\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressdefines_.zegomediaplayer.html#loadresourcewithconfig) 加载文件成功后，可调用 [start\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressdefines_.zegomediaplayer.html#start)、[pause\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressdefines_.zegomediaplayer.html#pause)、[resume\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressdefines_.zegomediaplayer.html#resume)、[stop\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressdefines_.zegomediaplayer.html#stop) 来启停播放。一旦播放器的内部状态改变，[ZegoMediaPlayer\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressdefines_.zegomediaplayer.html) 的 [mediaPlayerStateUpdate\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/interfaces/_zegoexpresseventhandler_.zegomediaplayerlistener.html#mediaplayerstateupdate) 回调将会被触发。

用户也可通过调用 [getCurrentState\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressdefines_.zegomediaplayer.html#getcurrentstate) 随时获取播放器的当前状态。

如果 [enableRepeat\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressdefines_.zegomediaplayer.html#enablerepeat) 设置为 `YES`，则播放器会在播放完文件后自动重播。

```javascript
// 开始播放，播放之前需要先调用接口加载媒体文件
this.mediaPlayer.start();
// 暂停
this.mediaPlayer.pause();
// 恢复
this.mediaPlayer.resume();
// 停止
this.mediaPlayer.stop();
```

### 5 播放器透明视图控制

当播放视频资源时，使用 `<zego-mediaplayer-view>` 标签，并设置 `alphaBlend` 参数为 `true`，开启播放器透明效果，然后调用 [setPlayerView\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressdefines_.zegomediaplayer.html#setplayerview) 接口设置视频的显示视图。

<div class="mk-warning">

初次创建生效后，不可实时更改。如需更改，需要重新创建或刷新视图标签。
</div>



```
<template>
    <zego-mediaplayer-view :playerID="playerID" :alphaBlend="true" style="height: 260.38rpx"></zego-mediaplayer-view>
</template>

//JS 部分:
let mediaPlayer = await ZegoExpressEngine.instance().createMediaPlayer();
this.playerID = mediaPlayer.getIndex();
mediaPlayer.setPlayerView(this.playerID);
```

### 6 销毁媒体播放器

媒体播放器使用完毕后，需要及时调用 [destroyMediaPlayer\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressengine_.zegoexpressengine.html#destroymediaplayer) 接口销毁播放器实例变量，释放占用的资源。

```javascript
// 销毁媒体播放器 
ZegoExpressEngine.instance().destroyMediaPlayer(this.mediaPlayer)
```
