---
articleID: 10338
---
# 设置视频编码方式

- - -

## 1 功能简介

@@@Layered_Video_Coding_Function_Introduction@@@

## 2 示例源码下载

请参考 [下载示例源码\|_blank](!DownloadDemo/DownloadDemo) 获取源码。

相关源码请查看 “/pages/example/advance-video/video-codec.nvue” 目录下的文件。

## 3 前提条件

在实现视频编解码功能之前，请确保：

@@@Express-Video_Prerequisites@@@

## 4 实现步骤

### 4.1 分层视频编码

使用分层视频编码需要以下两个步骤：

- 推流前通过指定特定的编码器来开启分层视频编码。
- 拉流时指定要拉取的分层视频。

#### 4.1.1 开启分层视频编码

在推流（[startPublishingStream\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressengine_.zegoexpressengine.html#startpublishingstream)）前调用 [setVideoConfig\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressengine_.zegoexpressengine.html#setvideoconfig) 设置 [ZegoVideoConfig\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressdefines_.zegovideoconfig.html) 类中的参数 “codecID”，即可开启/关闭分层视频编码功能。

<div class="mk-warning">


目前 Web 只支持设置 `ZegoVideoCodecID.Default` 及 `ZegoVideoCodecID.VP8`。  
</div>


- “codecID” 设置为 “ZegoVideoCodecID.SVC”，可以开启该功能。
- “codecID” 设置为 “ZegoVideoCodecID.Default”、“ZegoVideoCodecID.VP8” 或 “ZegoVideoCodecID.H265” 可关闭该功能。

```javascript
let videoConfig = {};
videoConfig.codecID = ZegoVideoCodecID.SVC;
ZegoExpressEngine.instance().setVideoConfig(videoConfig);

let streamID = "MultiLayer-1";
ZegoExpressEngine.instance().startPublishingStream(streamID);
```

#### 4.1.2 指定要拉取的分层视频

在推流端开启了分层视频编码后，拉流端在拉流前后均可调用 [setPlayStreamVideoType\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressengine_.zegoexpressengine.html#setplaystreamvideotype) 接口，拉流端默认会根据网络情况拉取合适的视频分层，例如弱网只拉取基本层。开发者也可以传入具体的拉流参数以拉取特定的视频分层，目前支持的视频分层如下：

<div class="mk-warning">
Web 目前不支持指定要拉取的分层视频。
</div>

|枚举值|说明|
|-|-|
|ZegoVideoStreamType.Default|根据网络状态选择图层|
|ZegoVideoStreamType.Small|小分辨率类型|
|ZegoVideoStreamType.Big|大分辨率类型|

以拉取扩展层为例：

```javascript
ZegoExpressEngine.instance().setPlayStreamVideoType(playStreamID,ZegoVideoStreamType.Big);
ZegoExpressEngine.instance().startPlayingStream(playStreamID);
```

### 4.2 硬件编解码

由于少部分机型设备对硬件编码/解码的支持不佳，SDK 默认使用软件编码与软件解码的方式，若开发者有使用硬件编码的需求，可参照本节自行设置。

<div class="mk-warning">
Web 目前不支持硬件编解码。
</div>

#### 4.2.1 开启硬件编码

<div class="mk-warning">

该功能需在推流前设置才能生效，如果在推流后设置，停止推流后重新推流才可以生效。
</div>

若开发者需要开启硬件编码，可调用 [enableHardwareEncoder\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressengine_.zegoexpressengine.html#enablehardwareencoder) 接口。

```javascript
// 开启硬件编码
ZegoExpressEngine.instance().enableHardwareEncoder(true);
```

#### 4.2.2 开启硬件解码

<div class="mk-warning">

该功能需在拉流前设置才能生效，如果在拉流后设置，停止拉流后重新拉流才可以生效。
</div>

若开发者需要开启硬件解码，可调用 [enableHardwareDecoder\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressengine_.zegoexpressengine.html#enablehardwaredecoder) 接口。

```javascript
// 开启硬件解码
ZegoExpressEngine.instance().enableHardwareDecoder(true);
```

### 4.3 设置视频编码方式

在推流（[startPublishingStream\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressengine_.zegoexpressengine.html#startpublishingstream)）前调用 [setVideoConfig\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressengine_.zegoexpressengine.html#setvideoconfig) 接口设置 “ZegoVideoConfig” 类下的参数 “codecID”，即可设置视频编码方式。目前支持的视频编码方式如下：

<div class="mk-warning">

目前 Web 仅支持 H.264、VP8，其他编码方式暂不支持。
</div>

|枚举值|编码方式|使用场景|
|-|-|-|
|ZegoVideoCodecID.Default|默认编码（H.264）|H.264 是被广泛使用的高精度视频的录制、压缩和发布格式，拥有很好的兼容性。|
|ZegoVideoCodecID.SVC|分层编码 （H.264 SVC）|需要使用分层编码的场景。|
|ZegoVideoCodecID.VP8|VP8|常用于 Web 视频，但不能用在 CDN 录制场景中，否则会造成录制文件异常。|
|ZegoVideoCodecID.H265|H.265|拥有更好的压缩率，但需考虑兼容性。|

以设置编码方式为 H.265 为例：

```javascript
let videoConfig = {};
videoConfig.codecID = ZegoVideoCodecID.H265;
ZegoExpressEngine.instance().setVideoConfig(videoConfig);

let streamID = "MultiLayer-1";
ZegoExpressEngine.instance().startPublishingStream(streamID);
```

## 5 API 参考列表

|方法 | 描述  |
| ---- | ---- |
| [setVideoConfig \|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressengine_.zegoexpressengine.html#setvideoconfig) | 设置视频参数 |
|[enableHardwareEncoder\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressengine_.zegoexpressengine.html#enablehardwareencoder)|开/关硬件编码|
|[enableHardwareDecoder\|_blank](/unique-api/express-video-sdk/zh/javascript_uni-app/classes/_zegoexpressengine_.zegoexpressengine.html#enablehardwaredecoder)|开/关硬件解码|

## 6 常见问题

@@@Layered_Video_Coding_FAQ@@@
