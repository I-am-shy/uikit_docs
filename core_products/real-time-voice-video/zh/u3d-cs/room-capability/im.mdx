# 实时消息与信令【待修改】

- - -

##  功能简介

@@@message_intro@@@

##  示例源码下载

请参考 [下载示例源码](!DownloadDemo/DownloadDemo) 获取源码。

相关源码请查看 “/ZegoExpressExample/CommonFeatures/src/main/java/im/zego/roommessage” 目录下的文件。

##  前提条件

在发送实时消息前，请确保：

@@@Express-Video_Prerequisites@@@

##  使用步骤

### 收发广播消息

1. **发送广播消息**

  调用 [SendBroadcastMessage ](@SendBroadcastMessage) 接口向同一房间内的其他用户发送广播消息，长度不能超过 1024 字节。

  通过 [OnIMSendBroadcastMessageResult ](@OnIMSendBroadcastMessageResult) 回调获取消息发送结果。

  ```java
  // 发送广播消息
  engine.SendBroadcastMessage(roomID, msg, new IZegoIMSendBroadcastMessageCallback() {
      // 发送广播消息结果回调处理
      @Override
      public void onIMSendBroadcastMessageResult(int errorCode, long messageID) {
          // 发送消息结果成功或失败的处理
      }
  });
  ```
2. **接收广播消息**

  实现 [IZegoEventHandler](@-IZegoEventHandler) 代理中的 [OnIMRecvBroadcastMessage](@OnIMRecvBroadcastMessage) 回调，当发送方成功发送广播消息后，同一房间内的其他用户通过此回调接收相关信息，包括消息内容、消息 ID、发送时间及发送方信息。

  ```java
  public abstract class IZegoEventHandler {

      /**
       * 接收房间广播消息通知
       *
       * @param roomID 房间 ID
       * @param messageList 收到的消息列表
       */
      @Override
      public void OnIMRecvBroadcastMessage(String roomID, ArrayList<ZegoBroadcastMessageInfo> messageList){
          // 收到其他用户发送消息的处理
      }

  }
  ```

### 收发弹幕消息


1. **发送弹幕消息**

  调用 [SendBarrageMessage ](@SendBarrageMessage) 接口向同一房间内的其他用户发送弹幕消息，长度不能超过 1024 字节。

  通过 [OnIMSendBarrageMessageResult ](@OnIMSendBarrageMessageResult) 回调获取消息发送结果。

  ```java
  // 发送房间弹幕消息
  engine.SendBarrageMessage("ChatRoom-1", "This is a barrage message", new IZegoIMSendBarrageMessageCallback(){
      // 发送弹幕消息结果回调处理
      @Override
      public void OnIMSendBarrageMessageResult(int errorCode, String messageID) {
           // 发送消息结果成功或失败的处理
      }
  });
  ```
2. **接收弹幕消息**

  实现 [IZegoEventHandler](@-IZegoEventHandler) 代理中的 [OnIMRecvBarrageMessage ](@OnIMRecvBarrageMessage) 回调，当发送方成功发送弹幕消息后，同一房间内的其他用户通过此回调接收相关信息，包括消息内容、消息 ID、发送时间及发送方信息。

  ```java
  public abstract class IZegoEventHandler {

      /**
       * 接收房间弹幕消息通知
       *
       * @param roomID 房间 ID
       * @param messageList 收到的消息列表
       */
      @Override
      public void OnIMRecvBarrageMessage(String roomID, ArrayList<ZegoBarrageMessageInfo> messageList){
           // 收到其他用户发送消息的处理
      }

  }
  ``` 

### 收发自定义信令

1. **发送自定义信令**

  调用 [SendCustomCommand ](@SendCustomCommand) 接口向同一房间内通过 “toUserList” 指定的用户发送自定义信令，长度不能超过 1024 字节。

  通过 [OnIMSendCustomCommandResult ](@OnIMSendCustomCommandResult) 回调获取消息发送结果。

  ```java
  // 发送自定义信令，`toUserList` 中指定的用户才可以通过 OnIMSendCustomCommandResult 收到此信令
  // 若 `toUserList` 参数传 `null`，则 SDK 将发送该信令给房间内所有用户
  engine.SendCustomCommand(roomID, command, toUserList, new IZegoIMSendCustomCommandCallback() {
      // 发送用户自定义消息结果回调处理
      @Override
      public void OnIMSendCustomCommandResult(int errorCode) {
          // 发送消息结果成功或失败的处理
      }
  });
  ```
2. **接收自定义信令**

  实现 [IZegoEventHandler](@-IZegoEventHandler) 代理中的 [OnIMRecvCustomCommand ](@OnIMRecvCustomCommand) 回调，当发送方成功发送自定义消息后，同一房间内的指定用户通过此回调接收相关信息，包括消息内容和消息发送方信息。

  ```java
  public abstract class IZegoEventHandler {

      /**
       * 接收自定义信令通知
       *
       * @param roomID 房间 ID
       * @param fromUser 信令的发送人
       * @param command 信令内容
       */
      @Override
      public void OnIMRecvCustomCommand(String roomID, ZegoUser fromUser, String command){
          // 收到其他用户发送消息的处理
      }

  }
  ```
