---
articleID: 17975
---
# 多源采集

- - -
## 功能简介

@@@Multi_source_acquisition_info@@@


## 前提条件

在使用多源采集功能之前，请确保：

@@@Express-Video_Prerequisites@@@

## 实现流程

<div class="mk-warning">


实时语音产品仅支持设置音频采集源。
</div>

### 1 创建 ZegoExpressEngine 引擎

创建 ZegoExpressEngine 引擎流程，请参考实现视频通话的 [创建引擎\|_blank](!Integration/Solution_Implementation#CreateEngine)。

```C#
// 创建 ZegoExpress 实例，监听常用事件
void CreateEngine() {
    // 创建引擎，通用场景接入
    ZegoEngineProfile profile = new ZegoEngineProfile();
    profile.appID = appID;  // 请通过官网注册获取，格式为：1234567890L
    profile.appSign = appSign; //请通过官网注册获取，格式为：@"0123456789012345678901234567890123456789012345678901234567890123"（共64个字符）
    profile.scenario = ZegoScenario.Broadcast;  // 指定使用直播场景 (请根据实际情况填写适合你业务的场景)

    engine = ZegoExpressEngine.CreateEngine(profile);
}
```

### 2 设置音视频采集源

1. 调用 [SetVideoSource\|_blank](@SetVideoSource) 接口设置视频采集源。

    ```C#
    /** 使用摄像头作为视频采集源 */
    engine.SetVideoSource(ZegoVideoSourceType.Camera);
    ```

    <div class = 'mk-hint'>

    - 如果需要使用自定义视频采集作为视频采集源，需设置视频采集源类型为 [ZegoVideoSourceTypeCustom\|_blank](@ZegoVideoSourceTypeCustom)，调用 [EnableCustomVideoCapture\|_blank](@EnableCustomVideoCapture) 接口设置要发送的视频帧数据类型，调用 [SendCustomVideoCaptureRawData\|_blank](@SendCustomVideoCaptureRawData) 接口向 SDK 发送视频帧数据。
    - 如果需要使用媒体播放器作为视频采集源，需先调用 [CreateMediaPlayer\|_blank](@CreateMediaPlayer) 接口创建媒体播放器，再通过调用 [SetVideoSource\|_blank](@SetVideoSource) 接口设置视频采集源类型为 [ZegoVideoSourceTypePlayer\|_blank](@ZegoVideoSourceTypePlayer) 和设置视频采集源所使用的媒体播放器实例索引，然后再使用刚创建的媒体播放器加载资源并播放，详情请参考 [媒体播放器\|_blank](!ExpressVideoSDK-Other_Functions/MediaPlayer)。
    - 如果需要使用屏幕共享作为视频采集源，需设置视频采集源类型为 [ZegoVideoSourceTypeScreenCapture\|_blank](@ZegoVideoSourceTypeScreenCapture)，并开启屏幕共享向 SDK 推屏幕共享视频数据，详情请参考 [屏幕共享\|_blank](!ExpressVideoSDK-Other_Functions/Share_Screen)。
    </div>

2. 调用 [SetAudioSource\|_blank](@SetAudioSource) 接口设置音频采集源。

    - 仅设置音频采集源
  
    ```C#
    /** 使用麦克风作为音频采集源 */
    engine.SetAudioSource(ZegoAudioSourceType.Microphone);
    ```

    - 设置音频采集源，同时设置混音配置

    ```C#
    ZegoAudioSourceMixConfig audioSourceMixConfig = new ZegoAudioSourceMixConfig();

    /** 混入序号为 0 的媒体播放器播放的声音*/
    audioSourceMixConfig.mediaPlayerIndexList = new List<int>();
    audioSourceMixConfig.mediaPlayerIndexList.Add(0);

    /** 混入序号为 0 的音效播放器播放的声音*/
    audioSourceMixConfig.audioEffectPlayerIndexList = new List<int>();
    audioSourceMixConfig.audioEffectPlayerIndexList.Add(0);

    /** 使用麦克风作为音频采集源，且设置混音配置 */
    engine.SetAudioSource(ZegoAudioSourceType.Microphone, audioSourceMixConfig);
    ```

    <div class = 'mk-hint'>

        - 如果需要使用自定义音频采集作为音频采集源，需设置音频采集源类型为 [ZegoAudioSourceTypeCustom\|_blank](@ZegoAudioSourceTypeCustom)，调用 [SendCustomAudioCaptureAACData\|_blank](@SendCustomAudioCaptureAACData) 或 [SendCustomAudioCapturePCMData\|_blank](@SendCustomAudioCapturePCMData) 等接口向 SDK 发送音频数据。
        - 如果需要使用媒体播放器作为音频采集源，需设置音频采集源类型为 [ZegoAudioSourceTypeMediaPlayer\|_blank](@ZegoAudioSourceTypeMediaPlayer)，调用 [CreateMediaPlayer\|_blank](@CreateMediaPlayer) 接口创建媒体播放器，然后使用刚创建的媒体播放器加载资源并播放，详情请参考 [媒体播放器\|_blank](!ExpressVideoSDK-Other_Functions/MediaPlayer)。
    </div>

### 3 登录房间并推流

登录房间及推流流程，请参考实现视频通话的 [登录房间\|_blank](!Integration/Solution_Implementation#createroom) 及 [推流\|_blank](!Integration/Solution_Implementation#publishingStream)。

### 4 （可选）切换音视频采集源

1. 调用 [SetVideoSource\|_blank](@SetVideoSource) 接口切换视频采集源。

    ```C#
    /** 使用屏幕共享作为视频采集源 */
    engine.SetVideoSource(ZegoVideoSourceType.ScreenCapture);
    ```

2. 调用 [SetAudioSource\|_blank](@SetAudioSource) 接口切换音频采集源。

    ```C#
    /** 使用媒体播放器作为音频采集源 */
    engine.SetAudioSource(ZegoAudioSourceType.Player);
    ```

### 5 结束推流

结束推流流程，请参考实现视频通话的 [停止推拉流\|_blank](!Integration/Solution_Implementation#StopPublishingStream)。

```C#
/** 停止推流 */
engine.StopPublishingStream();
```


##  常见问题

@@@Multi_source_acquisition_faq@@@
