# 音频 3A 处理

- - -

## 1 功能简介

在实时音视频通话时，可以对音频进行 3A 处理，主要包括 AEC（Acoustic Echo Cancelling，回声消除），AGC（Automatic Gain Control，自动增益）和 ANS（Active Noise Control，降噪），以提高通话质量和用户体验。

- AEC（回声消除）：对采集到的音频数据进行过滤以降低音频中的回音成分。
- AGC（自动增益）：对音频的响度进行调整，开启后该功能后声音会被放大，但会一定程度上影响音质。
- ANS（降噪）：识别声音中的背景噪声并进行消除，开启该功能后可以使人声更加清晰。

## 2 示例源码下载

请参考 [下载示例源码](#9972) 获取源码。

相关源码请查看 “/ZegoExpressExample/Examples/AdvancedAudioProcessing/AEC_ANS_AGC”

## 3 前提条件

在使用音频 3A 处理之前，请确保：

- 已在项目中集成 ZEGO Express SDK，实现基本的实时音视频功能，详情请参考  [快速开始 - 集成\|_blank](#9975) 和  [快速开始 - 实现流程\|_blank](#9976)。
- 已在 [ZEGO 控制台\|_blank](https://console.zego.im) 创建项目，并申请有效的 AppID 和 AppSign，详情请参考 [控制台 - 项目管理\|_blank](#1265)。

## 4 使用步骤

### 4.1 设置 AEC（回声消除）

<div class = "mk-warning">

[enableAEC\|_blank](@enableAEC) 、[enableHeadphoneAEC\|_blank](@enableHeadphoneAEC) 和 [setAECMode\|_blank](@setAECMode) 需要在 [startPublishingStream\|_blank](@startPublishingStream)、 [startPlayingStream\|_blank](@startPlayingStream)、 [startPreview\|_blank](@startPreview)、 [createMediaPlayer\|_blank](@createMediaPlayer) 和 [createAudioEffectPlayer\|_blank](@createAudioEffectPlayer) 这些接口之前调用才有效。

</div>

在进行回声消除相关设置之前，开发者需先开启。调用 [enableAEC\|_blank](@enableAEC) 接口开启回声消除。该功能开启后，SDK 会对采集到的音频数据进行过滤以降低音频中的回音成分。


此外，开发者可通过调用 [enableHeadphoneAEC\|_blank](@enableHeadphoneAEC) 接口设置是否在使用耳机的时候开启回声消除。

开启回声消除后，开发者可通过调用 [setAECMode\|_blank](@setAECMode) 接口设置回声消除模式。SDK 支持以下三种回声消除模式：

|枚举值|说明|
|-|-|
|ZEGO_AEC_MODE_AGGRESSIVE| 激进的回声抵消，可能会影响音质稍微明显，但是回声会消除得很干净。|
|ZEGO_AEC_MODE_MEDIUM|适度的回声抵消，可能会稍微影响一点点音质，但是残留的回声会更少。|
|ZEGO_AEC_MODE_SOFT|舒适的回声抵消，回声抵消基本不会影响声音的音质，可能有时会残留一点回声，但不会影响正常听音。|

以设置适度的回声抵消为例：
```C++
// 开启 AEC
engine->enableAEC(true);
// 在使用耳机时开启 AEC
engine->enableHeadphoneAEC(true);
// 设置 AEC 模式为 MEDIUM
engine->setAECMode(ZEGO_AEC_MODE_MEDIUM);
```

### 4.2 设置 AGC （自动增益）

<div class = "mk-warning">

[enableAGC\|_blank](@enableAGC) 需要在 [startPublishingStream\|_blank](@startPublishingStream)、 [startPlayingStream\|_blank](@startPlayingStream)、 [startPreview\|_blank](@startPreview)、 [createMediaPlayer\|_blank](@createMediaPlayer) 和 [createAudioEffectPlayer\|_blank](@createAudioEffectPlayer) 这些接口之前调用才有效。

</div>

调用 [enableAGC\|_blank](@enableAGC) 接口开启自动增益后声音会被放大，但会一定程度上影响音质。

```C++
// 开启 AGC
engine->enableAGC(true);
```

### 4.3 设置 ANS (噪声抑制)

<div class = "mk-warning">

[enableANS\|_blank](@enableANS) 、[enableTransientANS\|_blank](@enableTransientANS) 和 [setANSMode\|_blank](@setANSMode) 需要在 [startPublishingStream\|_blank](@startPublishingStream)、 [startPlayingStream\|_blank](@startPlayingStream)、 [startPreview\|_blank](@startPreview)、 [createMediaPlayer\|_blank](@createMediaPlayer) 和 [createAudioEffectPlayer\|_blank](@createAudioEffectPlayer) 这些接口之前调用才有效。

</div>

在进行噪声抑制模式设置之前，开发者需先调用 [enableANS\|_blank](@enableANS) 接口开启噪声抑制。开启噪声抑制可以使人声更加清晰。


此外，开发者可通过调用 [enableTransientANS\|_blank](@enableTransientANS) 接口设置是否开启瞬态噪声抑制。瞬态噪声抑制用于抑制敲击键盘、桌子等瞬态噪声。

开启噪声抑制后，开发者可通过调用 [setANSMode\|_blank](@setANSMode) 接口设置噪声抑制模式。默认值为 “MEDIUM”。

SDK 支持以下三种噪声抑制模式：

|枚举值|说明|
|-|-|
|ZEGO_ANS_MODE_AGGRESSIVE|激进的噪声抑制，有可能明显损伤音质，但有很好的降噪效果。|
|ZEGO_ANS_MODE_MEDIUM|适度的噪声抑制，有可能损伤一些音质，但有不错的降噪效果。|
|ZEGO_ANS_MODE_SOFT|轻度的噪声抑制，基本不会损伤音质，但会残留一些噪声。|

以设置轻度的噪声抑制为例：
```C++
// 开启 ANS
engine->enableANS(true);
// 开启瞬态噪声抑制
engine->enableTransientANS(true);
// 设置 ANS 模式为 MEDIUM
engine->setANSMode(ZEGO_ANS_MODE_SOFT);
```

## 5 API 参考列表

| 方法        | 描述           |
| ----------- | -------------- |
| [enableAEC\|_blank](@enableAEC)|开/关回声消除  |
| [enableHeadphoneAEC\|_blank](@enableHeadphoneAEC) | 是否在使用耳机时开启回声消除  |
|[setAECMode\|_blank](@esetAECMode) |设置回声消除模式|
|[enableAGC\|_blank](@enableAGC)|开/关自动增益|
|[enableANS\|_blank](@enableANS)|开/关噪声抑制|
|[enableTransientANS\|_blank](@enableTransientANS)|开/关瞬态噪声抑制|
|[setANSMode\|_blank](@setANSMode)|设置音频噪声抑制模式|
