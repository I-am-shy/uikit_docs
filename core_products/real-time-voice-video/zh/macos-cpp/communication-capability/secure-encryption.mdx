# 安全加密

- - -

## 1 功能简介

该功能可用于加密流信息以保护通信安全。

开发者可在推流时对流进行加密。对于已经加密的流，在拉流时，开发者需提供与加密密钥一致的解密密钥，否则无法成功拉流。

## 2 示例源码下载

请参考 [下载示例源码\|_blank](#9972) 获取源码。

相关源码请查看 “/ZegoExpressExample/Examples/Others/Security”目录下的文件。

## 3 前提条件

在使用安全加密功能之前，请确保：

- 已在项目中集成 ZEGO Express SDK，实现基本的实时音视频功能，详情请参考  [快速开始 - 集成\|_blank](#9975) 和  [快速开始 - 实现流程\|_blank](#9976)。
- 已在 [ZEGO 控制台\|_blank](https://console.zego.im) 创建项目，并申请有效的 AppID 和 AppSign，详情请参考 [控制台 - 项目管理\|_blank](#1265)。

## 4 使用步骤

### 4.1 设置推流加密密钥

调用 [setPublishStreamEncryptionKey\|_blank](@setPublishStreamEncryptionKey) 可设置推流加密密钥，该接口在推流前后调用都可生效。

<div class="mk-warning">

- 该接口仅当向 **Zego RTC 服务器**推流时调用有效。

- 支持在推流中途调用 [setPublishStreamEncryptionKey\|_blank](@setPublishStreamEncryptionKey) 更新加密密钥，注意此时需要先更新拉流端解密密钥后才能更新推流端加密密钥，否则会导致拉流失败。
- 调用 [stopPublishingStream\|_blank](@stopPublishingStream) 或 [logoutRoom\|_blank](@logoutRoom) 都将会清空加密密钥。

</div>

```C++
// key 为加密密钥，长度仅支持16/24/32 字节。
engine->setPublishStreamEncryptionKey(key);
```

### 4.2 设置拉流解密密钥

调用 [setPlayStreamDecryptionKey\|_blank](@setPlayStreamDecryptionKey) 可设置拉流解密密钥，该接口在推流前后调用都可生效。

<div class="mk-warning">

- 该接口仅当从 **Zego RTC 或 L3 服务器**拉流时调用有效。
- 支持在拉流中途调用 [setPlayStreamDecryptionKey\|_blank](@setPlayStreamDecryptionKey) 更新解密密钥，注意需要先更新拉流端解密密钥后才能更新推流端加密密钥，否则会导致拉流失败。
- 调用 [stopPlayingStream\|_blank](@stopPlayingStream) 或 [logoutRoom\|_blank](@logoutRoom) 都将会清空加密密钥。

</div>

```C++
// playStreamID 为拉流ID
// key 为解密密钥，长度仅支持16/24/32 字节。
engine->setPlayStreamDecryptionKey(playStreamID,key);
```

### 4.3 开始推流、拉流

请参考 [快速开始-实现流程|_blank](#9976) 依次完成推流和拉流相关操作。


## 5 API 参考列表

| 方法 | 描述 |
|-------|--------|
| [setPublishStreamEncryptionKey\|_blank](@setPublishStreamEncryptionKey) | 设置推流加密密钥 |
| [setPlayStreamDecryptionKey\|_blank](@setPlayStreamDecryptionKey) |设置拉流解密密钥|
