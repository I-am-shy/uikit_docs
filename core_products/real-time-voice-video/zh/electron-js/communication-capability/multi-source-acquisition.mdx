---
articleID: 17809
---
# 多源采集

- - -
## 功能简介

@@@Multi_source_acquisition_info@@@

## 示例源码

相关源码请查看官网示例源码，详情请参考 [跑通示例源码\|_blank](!DownloadDemo/DownloadDemo) 获取源码。



## 前提条件

在使用多源采集功能之前，请确保：

@@@Express-Video_Prerequisites@@@

## 实现流程

<div class="mk-warning">


实时语音产品仅支持设置音频采集源。
</div>

### 1 创建 ZegoExpressEngine 引擎

创建 ZegoExpressEngine 引擎流程，请参考实现视频通话的 [创建引擎\|_blank](!Integration/Solution_Implementation#createEngine)。

```js
// 引入 ZegoExpressEngine
const zgEngine = window.require('zego-express-engine-electron/ZegoExpressEngine');
const zgDefines = window.require('zego-express-engine-electron/ZegoExpressDefines');

// 指定使用直播场景 (请根据实际情况填写适合你业务的场景)
const profile = {
appID : xxx,
appSign : "xxx",
scenario : zgDefines.ZegoScenario.Default
};

zgEngine.createEngine(profile)
.then(() => {
    console.log("init succeed")
}).catch((e) => {
    console.log("init failed", e)
});
```

### 2 设置音视频采集源

1. 调用 [setVideoSource\|_blank](@setVideoSource) 接口设置视频采集源。

```js
/** 使用摄像头作为视频采集源 */
zgEngine.setVideoSource(zgDefines.ZegoVideoSourceType.Camera, 0, zgDefines.ZegoPublishChannel.Main)
```

<div class = 'mk-hint'>

- 如果需要使用自定义视频采集作为视频采集源，需设置视频采集源类型为 `Custom`，调用 [enableCustomVideoCapture\|_blank](@enableCustomVideoCapture) 接口设置要发送的视频帧数据类型，然后向 SDK 注册自定义视频采集插件 [registerCustomVideoCapturePlugin\|_blank](@registerCustomVideoCapturePlugin)。
- 如果需要使用媒体播放器作为视频采集源，需先调用 [createMediaPlayer\|_blank](@createMediaPlayer) 接口创建媒体播放器，再通过调用 [setVideoSource\|_blank](@setVideoSource) 接口设置视频采集源类型为 `Player` 和设置视频采集源所使用的媒体播放器实例索引，然后再使用刚创建的媒体播放器加载资源并播放。
- 如果需要使用屏幕共享作为视频采集源，需设置视频采集源类型为 `ScreenCapture`，并开启屏幕共享向 SDK 推屏幕共享视频数据，详情请参考 [屏幕共享\|_blank](!ExpressVideoSDK-Other_Functions/Share_Screen) 。

</div>

2. 调用 [setAudioSource\|_blank](@setAudioSource) 接口设置音频采集源。

    - 仅设置音频采集源
        ```js
        /** 使用麦克风作为音频采集源 */
        zgEngine.setAudioSource(zgDefines.ZegoAudioSourceType.Microphone, zgDefines.ZegoPublishChannel.Main)
        ```

    - 设置音频采集源，同时设置混音配置
        ```js
        let audioSourceMixConfig;
        /** 混入系统声卡播放的声音*/
        audioSourceMixConfig.enableMixSystemPlayout = true;
        /** 混入 SDK 播放的声音*/
        audioSourceMixConfig.enableMixEnginePlayout = true;

        /** 混入媒体播放器播放的声音*/
        let mediaplayerList = []
        mp = zgEngine.createMediaPlayer();
        mediaplayerList.push(mp.getIndex())
        audioSourceMixConfig.mediaPlayerIndexList = mediaplayerList;

        /** 混入音效播放器播放的声音*/
        let audioplayerList = []
        audioEffectPlayer = zgEngine.createAudioEffectPlayer();
        audioplayerList.push(audioEffectPlayer.getIndex())
        audioSourceMixConfig.audioEffectPlayerIndexList = audioplayerList ;

        /** 使用麦克风作为音频采集源，且设置混音配置 */
        zgEngine.setAudioSourceWithConfig(zgDefines.ZegoAudioSourceType.Microphone, audioSourceMixConfig);
        ```

<div class = 'mk-hint'>

- 如果需要使用自定义音频采集作为音频采集源，需设置音频采集源类型为 `Custom`，并且向 SDK 注册音频采集插件 [registerCustomAudioCapturePlugin\|_blank](@registerCustomAudioCapturePlugin)。
- 如果需要使用媒体播放器作为音频采集源，需设置音频采集源类型为 `MediaPlayer`，调用 [createMediaPlayer\|_blank](@createMediaPlayer) 接口创建媒体播放器，然后使用刚创建的媒体播放器加载资源并播放。

</div>

### 3 登录房间并推流

登录房间及推流流程，请参考实现视频通话的 [登录房间\|_blank](!Integration/Solution_Implementation#loginRoom) 及 [推流\|_blank](!Integration/Solution_Implementation#startPublishingStream) 。

### 4 （可选）切换音视频采集源

1. 调用 [setVideoSource\|_blank](@setVideoSource) 接口切换视频采集源。

```js
/** 使用屏幕共享作为视频采集源 */
zgEngine.setVideoSource(zgDefines.ZegoVideoSourceType.ScreenCapture, 0, zgDefines.ZegoPublishChannel.Main)
```

2. 调用 [setAudioSource\|_blank](@setAudioSource) 接口切换音频采集源。

```js
/** 使用媒体播放器作为音频采集源 */
zgEngine.setAudioSource(zgDefines.ZegoAudioSourceType.MediaPlayer, zgDefines.ZegoPublishChannel.Main)
```

### 5 结束推流

结束推流流程，请参考实现视频通话的 [停止推拉流\|_blank](!Integration/Solution_Implementation#stopPublishingStream)。

```js
/** 停止推流*/
zgEngine.stopPublishingStream(zgDefines.ZegoPublishChannel.Main);
```


## 常见问题

@@@Multi_source_acquisition_faq@@@
