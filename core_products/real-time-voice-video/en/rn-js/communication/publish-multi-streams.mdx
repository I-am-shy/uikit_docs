# Publish Multiple Streams

- - -

## Feature Overview

Express SDK provides the capability to publish multiple streams simultaneously. When developers encounter the following situations in their business, it is recommended to use SDK's multi-stream publishing feature:

- Game streamers publish camera footage on the main stream and screen capture footage on the second stream.
- Outdoor streamers publish front camera footage on the main stream and rear camera footage on the second stream.

<Note title="Note">

Currently, the SDK supports a maximum of 4 publishing stream channels. Versions before 2.14.0 default to a maximum of 2 publishing stream channels. If you need to support more publishing channels, please contact ZEGO technical support for special packaging.
</Note>

## Example Source Code Download

Please refer to [Download Example Source Code](/real-time-video-rn/quick-start/run-example-code) to obtain the source code.

For related source code, please check the files in the "/ZegoExpressExample/AdvancedStreaming/src/main/java/im/zego/publishingmultiplestreams" directory in the downloaded example source code.


## Prerequisites

Before implementing multi-stream publishing functionality, please ensure:

- You have created a project in the [ZEGO Console](https://console.zego.im) and applied for a valid AppID and AppSign. For details, please refer to [Console - Project Information](/console/project-info).
- You have integrated ZEGO Express SDK in your project and implemented basic audio and video streaming functionality. For details, please refer to [Quick Start - Integration](/real-time-video-rn/quick-start/integrating-sdk) and [Quick Start - Implementation](/real-time-video-rn/quick-start/implementing-video-call).




## Usage Steps

<Warning title="Warning">


- Streams other than the main stream cannot directly obtain camera data.
- By default, non-main streams can only publish audio data. If you need to publish audio and video data, you need to enable custom video capture functionality.
- This article will introduce the implementation method for publishing auxiliary streams. The implementation method for other non-main streams is the same.

</Warning>



### 1 Create ZegoExpressEngine Engine

Please refer to [Quick Start - Implementing Video Call](/real-time-video-rn/quick-start/implementing-video-call#create-engine) for "3.1 Create Engine".

```java
ZegoEngineProfile profile = new ZegoEngineProfile();
profile.appID = appID;
profile.appSign = appSign;
profile.scenario = ZegoScenario.DEFAULT;
profile.application = getApplication();
engine = ZegoExpressEngine.createEngine(profile, null);
```

### 2 (Optional) Set Custom Video Capture Configuration

<Accordion title="Custom Video Capture Configuration Settings" defaultOpen="false">
Call the [ZegoCustomVideoCaptureConfig](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-entity-zego-custom-video-capture-config) interface to create a custom video capture object, set the property [bufferType](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-entity-zego-custom-video-capture-config#buffer-type) to provide the video frame data type to the SDK; call the interface [enableCustomVideoCapture](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#enable-custom-video-capture-1) to enable custom video capture functionality. For details, please refer to [Custom Video Capture](/real-time-video-rn/video/custom-video-capture).

<Note title="Note">



Due to the diversity of Android capture, the SDK supports multiple video frame data types [bufferType](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-entity-zego-custom-video-capture-config#buffer-type). Developers need to inform the SDK of the data type being used.

</Note>





```java
ZegoCustomVideoCaptureConfig videoCaptureConfig = new ZegoCustomVideoCaptureConfig();
// Select RAW_DATA type video frame data
videoCaptureConfig.bufferType = ZegoVideoBufferType.RAW_DATA;
engine.enableCustomVideoCapture(true, videoCaptureConfig, ZegoPublishChannel.AUX);
```
</Accordion>


### 3 (Optional) Set Auxiliary Publisher Custom Video Capture Callback

<Accordion title="Auxiliary Publisher Custom Video Capture Callback Settings" defaultOpen="false">
Call [setCustomVideoCaptureHandler](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#set-custom-video-capture-handler) to set custom video capture notification callbacks, and implement [onStart](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-callback-i-zego-custom-video-capture-handler#on-start) and [onStop](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-callback-i-zego-custom-video-capture-handler#on-stop) custom capture callback methods.

```java
// Set itself as the custom video capture callback object
sdk.setCustomVideoCaptureHandler(new IZegoCustomVideoCaptureHandler() {
    @Override
    public void onStart(ZegoPublishChannel channel) {
        // After receiving the callback, developers need to execute business logic related to starting video capture, such as turning on the camera, etc.
        ...
    }
    @Override
    public void onStop(ZegoPublishChannel channel) {
        // After receiving the callback, developers need to execute business logic related to stopping video capture, such as turning off the camera, etc.
        ...
    }
});
```
</Accordion>


### 4 Call Auxiliary Publisher Methods to Implement Preview and Publish Stream

After logging in to the room, call the start preview interface [startPreview](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#start-preview) or start publishing stream interface [startPublishingStream](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#start-publishing-stream), which triggers the [onStart](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java~class~im-zego-zegoexpress-callback-i-zego-custom-video-capture-handler#on-start) of [3 Set Auxiliary Publisher Custom Video Capture Callback](#3-optional-set-auxiliary-publisher-custom-video-capture-callback). When the [onStart](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-callback-i-zego-custom-video-capture-handler#on-start) callback is triggered, developers can start capturing video frame data.


When stopping publishing stream [stopPublishingStream](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#stop-publishing-stream) and stopping preview [stopPreview](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java~class~im-zego-zegoexpress-zego-express-engine#stop-preview), the [onStop](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-callback-i-zego-custom-video-capture-handler#on-stop) callback of [3 Set Auxiliary Publisher Custom Video Capture Callback](#3-optional-set-auxiliary-publisher-custom-video-capture-callback) will be triggered. At this time, developers should stop capturing video data.

```java
/**
*  Start preview, set local preview view, view mode uses SDK default mode, proportional scaling to fill the entire View
*  The following preview_view is a SurfaceView/TextureView/SurfaceTexture object on the UI interface
*/
engine.startPreview(new ZegoCanvas(preview_view), ZegoPublishChannel.AUX);

/** Start publishing stream */
engine.startPublishingStream("stream1", ZegoPublishChannel.AUX);
```

### 5 (Optional) Send Captured Video Frame Data to SDK


<Accordion title="Send Captured Video Frame Data to SDK" defaultOpen="false">
After the [onStart](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-callback-i-zego-custom-video-capture-handler#on-start) callback is triggered, developers can call [sendCustomVideoCaptureRawData](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#send-custom-video-capture-raw-data) or [sendCustomVideoCaptureTextureData](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#send-custom-video-capture-texture-data) to send the captured video data to the SDK.

- Call [sendCustomVideoCaptureRawData](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#send-custom-video-capture-raw-data)

    ```java
    engine.sendCustomVideoCaptureRawData(buffer, data.length, param, System.currentTimeMillis(), ZegoPublishChannel.AUX);
    ```

- Call [sendCustomVideoCaptureTextureData](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#send-custom-video-capture-texture-data)

    ```java
    engine.sendCustomVideoCaptureTextureData(textureID, width, height, System.currentTimeMillis(), ZegoPublishChannel.AUX);
    ```
</Accordion>


### 6 Set Auxiliary Publisher Event Callbacks

Call the auxiliary publisher's [setEventHandler](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#set-event-handler) interface to set event callbacks for the auxiliary publisher, to receive notifications such as "publishing state change callback", "publishing quality callback", "publishing first frame callback", etc.

```java
engine.setEventHandler(new IZegoEventHandler(){

    // Other overridden callbacks
    ...

    @Override
    public void onPublisherStateUpdate(String streamID, ZegoPublisherState state, int errorCode, JSONObject extendedData){
        // Perform logic corresponding to the publishing action result
        ...
    }
    @Override
    public void onPublisherQualityUpdate(String streamID, ZegoPublishStreamQuality quality){
        // Perform business logic such as displaying stream quality during publishing
        ...
    }
    @Override
    public void onPublisherCapturedVideoFirstFrame(ZegoPublishChannel channel){
        // Notification that SDK received video data for the first time
        ...
    }
    @Override
    public void onPublisherVideoSizeChanged(int width, int height, ZegoPublishChannel channel){
        // Developers can remove logic such as UI mask space for displaying video in this callback
    }
    @Override
    public void onPublisherRelayCDNStateUpdate(String streamID, ArrayList<ZegoStreamRelayCDNInfo> infoList){
        // Notification that stream is relayed to CDN
    }

    // Other overridden callbacks
    ...

});

```


## FAQ

1. **When will [onStart](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-callback-i-zego-custom-video-capture-handler#on-start) be called back?**

    When custom video capture is enabled, it will be triggered when the SDK starts publishing stream [startPublishingStream](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#start-publishing-stream) or starts preview [startPreview](https://doc-zh.zego.im/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine#start-preview).

2. **Does it support publishing more than 4 streams simultaneously?**

    To coordinate with real-time signaling functionality, the current SDK defaults to a maximum of 4 publishing stream channels, but versions before 2.14.0 default to a maximum of 2 publishing stream channels. If you need to support more publishing channels, please contact ZEGO technical support for special packaging.
