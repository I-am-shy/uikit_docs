---
articleID: 4987
---
# 实时消息与信令
- - -

## 1 功能简介

ZEGO 实时消息主要提供纯文本消息的收发功能，开发者可调用相关 API 向同一房间内的其他用户发送广播消息和弹幕消息，或者对某些指定用户发送自定义信令，并可以根据需要自行实现点赞、送礼物、答题等互动功能。

三种消息的区别如下：

| 消息类型 | 功能描述 | 应用场景 | 发送频率限制 |
|-------|--------|--------|--------|
| 广播消息 | 向同一房间内所有用户发送文本消息，默认支持最多前 500 个加入房间的用户能收到该消息。 | 一般当直播房间人数小于 500 时发送该类消息。 | 请参考 [限制说明\|_blank](#7580)。 |
| 弹幕消息 | 观众在直播过程中可以发表自己的评论，并以滑动而过的字幕显示出来，增加了观众之间的互动性。 | 一般用于房间内有大量消息收发，且不需要保证消息可靠性的场景，例如直播弹幕。 | 请参考 [限制说明\|_blank](#7580)。|
| 自定义信令 | 向同一房间内指定的单个或多个用户发送信令消息。 | 一般用于远程控制信令或向特定的用户发送消息，例如在线娃娃机场景中，远程控制娃娃机夹子的移动。 | 请参考 [限制说明\|_blank](#7580)。 |



## 2 示例源码下载

请参考 [下载示例源码\|_blank](#3126) 获取源码。

相关源码请查看 “/ZegoExpressExample/Topics/RoomMessage/ZGRoomMessageViewController.m” 文件。

## 3 前提条件

在发送实时消息前，请确保：

@@@Express_Audio_Prerequisites@@@

## 4 使用步骤

### 4.1 发送消息

- **发送广播消息**

  调用 [sendBroadcastMessage \|_blank](/zh/api?doc=Express_Video_SDK_API~ObjectiveC_ios~class~zego-express-engine#send-broadcast-message-room-id-callback) 接口向同一房间内的其他用户发送广播消息，长度不能超过 1024 字节。

  通过 [ZegoIMSendBroadcastMessageCallback \|_blank](@ZegoIMSendBroadcastMessageCallback) 回调获取消息发送结果。

  ```objc
  // 发送广播消息，每个登录房间的用户都会通过 -onIMRecvBroadcastMessage:roomID: 回调收到此消息
  [self.engine sendBroadcastMessage:@"This is a broadcast message" roomID:@"ChatRoom-1" callback:^(int errorCode, unsigned long long messageID) {
      NSLog(@"send broadcast message result block");
  }];
  ```


- **发送弹幕消息**

  调用 [sendBarrageMessage \|_blank](/zh/api?doc=Express_Video_SDK_API~ObjectiveC_ios~class~zego-express-engine#send-barrage-message-room-id-callback) 接口向同一房间内的其他用户发送弹幕消息，长度不能超过 1024 字节。

  通过 [ZegoIMSendBarrageMessageCallback \|_blank](@ZegoIMSendBarrageMessageCallback) 回调获取消息发送结果。

  ```objc
  // 发送房间弹幕消息，每个登录房间的用户都会通过 -onIMRecvBarrageMessage:roomID: 回调收到此消息
  [self.engine sendBarrageMessage:@"This is a barrage message" roomID:@"ChatRoom-1" callback:^(int errorCode, NSString *messageID) {
      NSLog(@"send barrage message result block");
  }];
  ```


- **发送自定义信令**

  调用 [sendCustomCommand \|_blank](/zh/api?doc=Express_Video_SDK_API~ObjectiveC_ios~class~zego-express-engine#send-custom-command-to-user-list-room-id-callback) 接口向同一房间内通过 “toUserList” 指定的用户发送自定义信令，长度不能超过 1024 字节。

  通过 [ZegoIMSendCustomCommandCallback \|_blank](@ZegoIMSendCustomCommandCallback) 回调获取消息发送结果。

  ```objc
  // 发送自定义信令，`toUserList` 中指定的用户才可以通过 -onIMRecvCustomCommand:fromUser:roomID: 收到此信令
  // 若 `toUserList` 参数传 `nil` 则 SDK 将发送该信令给房间内所有用户
  NSArray<ZegoUser *> *toUserList = @[[ZegoUser userWithUserID:@"user1"], [ZegoUser userWithUserID:@"user2"]];
  [self.engine sendCustomCommand:@"This is a custom command" toUserList:toUserList roomID:@"ChatRoom-1" callback:^(int errorCode) {
      NSLog(@"send custom command result block");
  }];
  ```

### 4.2 接收消息

- **接收广播消息**

  实现 [ZegoEventHandler\|_blank](@-ZegoEventHandler) 代理中的 [onIMRecvBroadcastMessage\|_blank](@onIMRecvBroadcastMessage) 回调，当发送方成功发送广播消息后，同一房间内的其他用户通过此回调接收相关信息，包括消息内容、消息 ID、发送时间及发送方信息。

  ```objc
  - (void)onIMRecvBroadcastMessage:(NSArray<ZegoMessageInfo *> *)messageInfoList roomID:(NSString *)roomID {
      NSLog(@"received broadcast message");
  }
  ```

- **接收弹幕消息**

  实现 IZegoEventHandler 代理中的 [onIMRecvBarrageMessage \|_blank](/zh/api?doc=Express_Video_SDK_API~ObjectiveC_ios~protocol~zego-event-handler#on-im-recv-barrage-message-room-id) 回调，当发送方成功发送弹幕消息后，同一房间内的其他用户通过此回调接收相关信息，包括消息内容、消息 ID、发送时间及发送方信息。

  ```objc
  - (void)onIMRecvBarrageMessage:(NSArray<ZegoBarrageMessageInfo *> *)messageList roomID:(NSString *)roomID {
       NSLog(@"received barrage message");
  }
  ```
 
- **接收自定义信令**

  实现 [ZegoEventHandler\|_blank](@-ZegoEventHandler) 代理中的 [onIMRecvCustomCommand \|_blank](/zh/api?doc=Express_Video_SDK_API~ObjectiveC_ios~protocol~zego-event-handler#on-im-recv-custom-command-from-user-room-id) 回调，当发送方成功发送自定义信令后，同一房间内的指定用户通过此回调接收相关信息，包括消息内容和消息发送方信息。

  ```objc
  - (void)onIMRecvCustomCommand:(NSString *)command fromUser:(ZegoUser *)fromUser roomID:(NSString *)roomID {
      NSLog(@"received custom command");
  }
  ```
