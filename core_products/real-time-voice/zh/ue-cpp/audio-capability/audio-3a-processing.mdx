<style>
table th:nth-of-type(1) {width: 25%;}
table {width: 100%;}
</style>

# 音频 3A 处理

- - -

## 功能简介

@@@audio_3a_intro@@@

## 前提条件

在使用音频 3A 处理之前，请确保：

@@@Express_Audio_Prerequisites@@@

## 使用步骤

### 1 设置 AEC（回声消除）

<div class = "mk-warning">

[enableAEC\|_blank](@enableAEC)、[enableHeadphoneAEC\|_blank](@enableHeadphoneAEC) 和 [setAECMode\|_blank](@setAECMode) 都需要在 [startPublishingStream\|_blank](@startPublishingStream)、 [startPlayingStream\|_blank](@startPlayingStream)、 [startPreview\|_blank](@startPreview)、 [createMediaPlayer\|_blank](@createMediaPlayer)、[createAudioEffectPlayer\|_blank](@createAudioEffectPlayer) 和 [createRealTimeSequentialDataManager\|_blank](@createRealTimeSequentialDataManager) 这些接口之前调用才有效。

</div>

开发者可以按照以下步骤完成回声消除相关设置：

1. 调用 [enableAEC\|_blank](@enableAEC) 接口开启回声消除，该功能开启后，SDK 会对采集到的音频数据进行过滤以减少音频中的回声。
2. （可选）开发者可通过调用 [enableHeadphoneAEC\|_blank](@enableHeadphoneAEC) 接口设置是否在使用耳机的时候开启回声消除。
3. 开启回声消除后，开发者可通过调用 [setAECMode\|_blank](@setAECMode) 接口设置回声消除模式。SDK 支持以下三种回声消除模式：

|枚举值|说明|
|-|-|
|ZEGO_AEC_MODE_AGGRESSIVE| 激进的回声抵消，可能会比较明显的影响音质，但是回声会消除得很干净。|
|ZEGO_AEC_MODE_MEDIUM|适度的回声抵消，可能会稍微影响一点点音质，但是残留的回声会更少。|
|ZEGO_AEC_MODE_SOFT|舒适的回声抵消，回声抵消基本不会影响声音的音质，可能有时会残留一点回声，但不会影响正常听音。|

以设置适度的回声抵消为例：

```C++
// 开启 AEC
engine->enableAEC(true);
// 设置 AEC 模式为 ZEGO_AEC_MODE_MEDIUM
engine->setAECMode(ZEGO_AEC_MODE_MEDIUM);
```

### 2 设置 AGC （自动增益控制）

<div class = "mk-warning">

[enableAGC\|_blank](@enableAGC) 需要在 [startPublishingStream\|_blank](@startPublishingStream)、 [startPlayingStream\|_blank](@startPlayingStream)、 [startPreview\|_blank](@startPreview)、 [createMediaPlayer\|_blank](@createMediaPlayer)、[createAudioEffectPlayer\|_blank](@createAudioEffectPlayer) 和 [createRealTimeSequentialDataManager\|_blank](@createRealTimeSequentialDataManager) 这些接口之前调用才有效。
</div>

调用 [enableAGC\|_blank](@enableAGC) 接口开启自动增益控制，开启该功能后，SDK 能够自动调节麦克风音量，适应远近拾音，保持音量稳定。

```C++
// 开启 AGC
engine->enableAGC(true);
```

### 3 设置 ANS (噪声抑制)

<div class = "mk-warning">

[enableANS\|_blank](@enableANS) 、[enableTransientANS\|_blank](@enableTransientANS) 和 [setANSMode\|_blank](@setANSMode) 都需要在 [startPublishingStream\|_blank](@startPublishingStream)、 [startPlayingStream\|_blank](@startPlayingStream)、 [startPreview\|_blank](@startPreview)、 [createMediaPlayer\|_blank](@createMediaPlayer)、[createAudioEffectPlayer\|_blank](@createAudioEffectPlayer) 和 [createRealTimeSequentialDataManager\|_blank](@createRealTimeSequentialDataManager) 这些接口之前调用才有效。

</div>

开发者可以按照以下步骤完成噪声抑制相关设置：

1. 调用 [enableANS\|_blank](@enableANS) 接口开启噪声抑制，该功能开启后可以使人声更加清晰。

2. （可选）开发者可通过调用 [enableTransientANS\|_blank](@enableTransientANS) 接口设置是否开启瞬态噪声抑制，瞬态噪声抑制用于抑制敲击键盘、桌子等瞬态噪声。

3. 开启噪声抑制后，开发者可通过调用 [setANSMode\|_blank](@setANSMode) 接口设置噪声抑制模式，默认值为 “ZEGO_ANS_MODE_MEDIUM”。
SDK 支持以下四种噪声抑制模式：

|枚举值|说明|
|-|-|
|ZEGO_ANS_MODE_AGGRESSIVE|激进的噪声抑制，有可能明显损伤音质，但有很好的降噪效果。|
|ZEGO_ANS_MODE_MEDIUM|（默认值）适度的噪声抑制，有可能损伤一些音质，但有不错的降噪效果。|
|ZEGO_ANS_MODE_SOFT|轻度的噪声抑制，基本不会损伤音质，但会残留一些噪声。|
|ZEGO_ANS_MODE_AI | AI 模式噪声抑制，会对音乐有较大损伤，可用于处理非稳态噪声，但不能用于需要采集背景音的音源处理，详情请参考 [AI 降噪\|_blank](!AIDenoise)。|

以设置轻度的噪声抑制为例：

```C++
// 开启 ANS
engine->enableANS(true);
// 开启瞬态噪声抑制
engine->enableTransientANS(true);
// 设置 ANS 模式为 ZEGO_ANS_MODE_SOFT
engine->setANSMode(ZEGO_ANS_MODE_SOFT);
```
4. （可选）开启音乐检测。请联系 ZEGO 技术支持配置开启音乐检测功能。

## 推荐配置

SDK 中音频 3A 处理的默认配置和推荐配置如下：

|接口名称|接口描述|默认配置|推荐配置
|-|-|-|-|
|[enableAEC\|_blank](@enableAEC)|开/关回声消除 |未调用此函数前，SDK 内部会自动判断是否需要使用 AEC，一旦调用此函数，则不再自动判断|在一般使用场景中，建议不修改该配置，保持默认即可。|
|[setAECMode\|_blank](@setAECMode)|设置回声消除模式|ZEGO_AEC_MODE_AGGRESSIVE（激进的回声抵消）|在一般使用场景中，建议不修改该配置，保持默认即可。|
|[enableAGC\|_blank](@enableAGC)|开/关自动增益控制|未调用此函数前，SDK 内部会自动判断是否需要使用 AGC，一旦调用此函数，则不再自动判断|<ul><li>在普通语聊场景中，建议使用默认配置。</li><li>在音乐电台场景中，建议不开启自动增益控制以还原人声。</li><li>在教育场景中，如大班课、小班课和 1V1 等，建议开启自动增益控制。</li></ul>|
|[enableANS\|_blank](@enableANS)|开/关噪声抑制|未调用此函数前，SDK 内部会自动判断是否需要使用 ANS，一旦调用此函数，则不再自动判断|在一般使用场景中，建议不修改该配置，保持默认即可。|
|[setANSMode\|_blank](@setANSMode)|设置音频噪声抑制模式|ZEGO_ANS_MODE_MEDIUM（适度的噪声抑制）|在一般使用场景中，建议不修改该配置，保持默认即可。|


## 相关文档

- [怎么处理音频回声问题？\|_blank](https://doc-zh.zego.im/faq/echo)
- [怎么处理音频噪声问题？\|_blank](https://doc-zh.zego.im/faq/audio_noise)
