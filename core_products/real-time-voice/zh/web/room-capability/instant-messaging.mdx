---
articleID: 4969
---
# 实时消息与信令
---
articleID: 4969
---
# 实时消息与信令


- - -

## 1 功能简介

ZEGO 实时消息主要提供纯文本消息的收发功能，开发者可调用相关 API 向同一房间内的其他用户发送广播消息和弹幕消息，或者对某些指定用户发送自定义信令，并可以根据需要自行实现点赞、送礼物、答题等互动功能。

三种消息的区别如下：

| 消息类型 | 功能描述 | 应用场景 | 发送频率限制 |
|-------|--------|--------|--------|
| 广播消息 | 向同一房间内所有用户发送文本消息，默认支持最多前 500 个加入房间的用户能收到该消息。 | 一般当直播房间人数小于 500 时发送该类消息。 | 请参考 [限制说明\|_blank](#7584)。|
| 弹幕消息 | 观众在直播过程中可以发表自己的评论，并以滑动而过的字幕显示出来，增加了观众之间的互动性。 | 一般用于房间内有大量消息收发，且不需要保证消息可靠性的场景，例如直播弹幕。 | 请参考 [限制说明\|_blank](#7584)。|
| 自定义信令 | 向同一房间内指定的单个或多个用户发送信令消息。 | 一般用于远程控制信令或向特定的用户发送消息，例如在线娃娃机场景中，远程控制娃娃机夹子的移动。 | 请参考 [限制说明\|_blank](#7584)。|


## 2 示例源码下载

请参考 [下载示例源码\|_blank](#3211) 获取源码。

相关源码请查看 “/src/message” 目录下的文件。

## 3 前提条件

在发送实时消息前，请确保：

@@@Express_Audio_Prerequisites_Web@@@


## 4 使用步骤

### 4.1 发送消息

- **发送广播消息**

  调用 [sendBroadcastMessage \|_blank](/zh/api?doc=Express_Video_SDK_API~javascript_web~class~ZegoExpressEngine#send-broadcast-message) 接口向同一房间内的其他用户发送广播消息，长度不能超过 1024 字节。

  通过 [ZegoServerResponse \|_blank](/zh/api?doc=Express_Video_SDK_API~javascript_web~interface~ZegoServerResponse) 中的 “errorCode” 获取消息发送结果，“0” 表示成功，非 “0” 表示失败。

  ```javascript
  try {
      const isSent = await zg.sendBroadcastMessage(this.data.roomID, this.data.inputMessage)
      console.log('>>> sendMsg success, ', isSent);
  } catch (error) {
      console.log('>>> sendMsg, error: ', error);
  };
  ```


- **发送弹幕消息**

  调用 [sendBarrageMessage \|_blank](/zh/api?doc=Express_Video_SDK_API~javascript_web~class~ZegoExpressEngine#send-barrage-message) 接口向同一房间内的其他用户发送弹幕消息，长度不能超过 1024 字节。

  通过 [ZegoServerResponse \|_blank](/zh/api?doc=Express_Video_SDK_API~javascript_web~interface~ZegoServerResponse) 中的 “errorCode” 获取消息发送结果，“0” 表示成功，非 “0” 表示失败。

  ```javascript
  try {
      const isSent = await zg.sendBarrageMessage(this.data.roomID, this.data.inputMessage)
      console.log('>>> barrageMessage success, ', isSent);
  } catch (error) {
      console.log('>>> barrageMessage, error: ', error);
  };   
  ```

- **发送自定义信令**

  调用 [sendCustomCommand \|_blank](/zh/api?doc=Express_Video_SDK_API~javascript_web~class~ZegoExpressEngine#send-custom-command) 接口向同一房间内通过 “toUserIDList” 指定的用户发送自定义信令，长度不能超过 1024 字节。

  通过 [ZegoServerResponse \|_blank](/zh/api?doc=Express_Video_SDK_API~javascript_web~interface~ZegoServerResponse) 中的 “errorCode” 获取消息发送结果，“0” 表示成功，非 “0” 表示失败。

  ```javascript
  try {
      const res =  await zg.sendCustomCommand(this.data.roomID, this.data.inputMessage, toUserIDList);
      console.warn('send custom success ' + res)
  } catch(error) {
      console.error(JSON.stringify(error))
  }
  ```

### 4.2 接收消息

- **接收广播消息**

  房间内成员注册 [IMRecvBroadcastMessage\|_blank](/article/api?doc=Express_Video_SDK_API~javascript_web~interface~ZegoRTMEvent#im-recv-broadcast-message) 回调，当发送方成功发送广播消息后，同一房间内的其他用户通过此回调接收相关信息，包括消息内容、消息 ID、发送时间及发送方信息。

  ```javascript
  zg.on('IMRecvBroadcastMessage', (roomID, chatData) => {
      console.log('IMRecvBroadcastMessage', roomID, chatData);
      let message = {
          ID: 'zego' + chatData[0].fromUser.userID + chatData[0].sendTime,
          name: chatData[0].fromUser.userName,
          time: format(chatData[0].sendTime),
          content: chatData[0].message + '(广播发送)'
      }
  });
  ```

- **接收弹幕消息**

  房间内成员注册 [IMRecvBarrageMessage \|_blank](/article/api?doc=Express_Video_SDK_API~javascript_web~interface~ZegoRTMEvent#im-recv-barrage-message) 回调，当发送方成功发送弹幕消息后，同一房间内的其他用户通过此回调接收相关信息，包括消息内容、消息 ID、发送时间及发送方信息。

  ```javascript
  zg.on('IMRecvBarrageMessage', (roomID, chatData) => {
      console.log('IMRecvBroadcastMessage', roomID, chatData);
      let message = {
          ID: 'zego' + chatData[0].fromUser.userID + chatData[0].sendTime,
          name: chatData[0].fromUser.userName,
          // @ts-ignore
          time: format(chatData[0].sendTime),
          content: chatData[0].message + '(弹幕发送)'
        }
  });
  ```

- **接收自定义信令**

  房间内成员注册 [IMRecvCustomCommand \|_blank](/article/api?doc=Express_Video_SDK_API~javascript_web~interface~ZegoRTMEvent#im-recv-custom-command) 回调，当发送方成功发送自定义信令后，同一房间内的指定用户通过此回调接收相关信息，包括消息内容和发送方信息。

  ```javascript
  zg.on('IMRecvCustomCommand', (roomID, fromUser, command) => {
      console.log('IMRecvCustomCommand',roomID, fromUser, command);
      let message = {
          ID: fromUser.userID,
          name: fromUser.userName,
          time: format(new Date().getTime()),
          content: command + '(自定义发送)'
      }
  });
  ```

## 5 API 参考列表

| 方法 | 描述 |
|-------|--------|
| [sendBroadcastMessage \|_blank](/zh/api?doc=Express_Video_SDK_API~javascript_web~class~ZegoExpressEngine#send-broadcast-message) | 发送房间广播消息 |
| [IMRecvBroadcastMessage \|_blank](/article/api?doc=Express_Video_SDK_API~javascript_web~interface~ZegoRTMEvent#im-recv-broadcast-message) | 房间消息通知 |
| [sendBarrageMessage \|_blank](/zh/api?doc=Express_Video_SDK_API~javascript_web~class~ZegoExpressEngine#send-barrage-message) | 发送房间弹幕消息 |
| [IMRecvBarrageMessage \|_blank](/article/api?doc=Express_Video_SDK_API~javascript_web~interface~ZegoRTMEvent#im-recv-barrage-message) | 房间弹幕消息通知 |
| [sendCustomCommand \|_blank](/zh/api?doc=Express_Video_SDK_API~javascript_web~class~ZegoExpressEngine#send-custom-command) | 发送自定义信令 |
| [IMRecvCustomCommand \|_blank](/article/api?doc=Express_Video_SDK_API~javascript_web~interface~ZegoRTMEvent#im-recv-custom-command)| 自定义信令通知 |
