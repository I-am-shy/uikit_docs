import { getPlatformData } from "/snippets/utils-content-parser.js"

export const onUserStatusUpdatedMap = {
  'Android': <a href='https://www.zegocloud.com/article/api?doc=zim_API~java_android~class~ZIMEventHandler#on-user-status-updated' target='_blank'>onUserStatusUpdated</a>,
  'iOS': <a href='https://www.zegocloud.com/article/api?doc=zim_API~objective-c_ios~protocol~ZIMEventHandler#zim-user-status-updated' target='_blank'>userStatusUpdated</a>,
  'mac': <a href='https://www.zegocloud.com/article/api?doc=zim_API~objective-c_macos~protocol~ZIMEventHandler#zim-user-status-updated' target='_blank'>userStatusUpdated</a>,
  'window': <a href='https://www.zegocloud.com/article/api?doc=zim_API~cpp_windows~class~ZIMEventHandler#on-user-status-updated' target='_blank'>onUserStatusUpdated</a>,
  'Flutter': <a href='https://pub.dev/documentation/zego_zim/latest/zego_zim/ZIMEventHandler/onUserStatusUpdated.html' target='_blank'>onUserStatusUpdated</a>,
  'web': <a href='https://www.zegocloud.com/article/api?doc=zim_API~javascript_web~interface~ZIMEventHandler#user-status-updated' target='_blank'>userStatusUpdated</a>,
}
export const subscribeUsersStatusMap = {
  'Android': <a href='https://www.zegocloud.com/article/api?doc=zim_API~java_android~class~ZIM#subscribe-users-status' target='_blank'>subscribeUsersStatus</a>,
  'iOS': <a href='https://www.zegocloud.com/article/api?doc=zim_API~objective-c_ios~protocol~ZIM#subscribe-users-status-config-callback' target='_blank'>subscribeUsersStatus</a>,
  'mac': <a href='https://www.zegocloud.com/article/api?doc=zim_API~objective-c_macos~protocol~ZIM#subscribe-users-status-config-callback' target='_blank'>subscribeUsersStatus</a>,
  'window': <a href='https://www.zegocloud.com/article/api?doc=zim_API~cpp_windows~class~ZIM#subscribe-users-status' target='_blank'>subscribeUsersStatus</a>,
  'Flutter': <a href='https://pub.dev/documentation/zego_zim/latest/zego_zim/ZIM/subscribeUsersStatus.html' target='_blank'>subscribeUsersStatus</a>,
  'web': <a href='https://www.zegocloud.com/article/api?doc=zim_API~javascript_web~class~ZIM#subscribe-users-status' target='_blank'>subscribeUsersStatus</a>,
}
export const querySubscribedUserStatusListMap = {
  'Android': <a href='https://www.zegocloud.com/article/api?doc=zim_API~java_android~class~ZIM#query-subscribed-user-status-list' target='_blank'>querySubscribedUserStatusList</a>,
  'iOS': <a href='https://www.zegocloud.com/article/api?doc=zim_API~objective-c_ios~protocol~ZIM#query-subscribed-user-status-list-with-config-callback' target='_blank'>querySubscribedUserStatusListWithConfig</a>,
  'mac': <a href='https://www.zegocloud.com/article/api?doc=zim_API~objective-c_macos~protocol~ZIM#query-subscribed-user-status-list-with-config-callback' target='_blank'>querySubscribedUserStatusListWithConfig</a>,
  'window': <a href='https://www.zegocloud.com/article/api?doc=zim_API~cpp_windows~class~ZIM#query-subscribed-user-status-list' target='_blank'>querySubscribedUserStatusList</a>,
  'Flutter': <a href='https://pub.dev/documentation/zego_zim/latest/zego_zim/ZIM/querySubscribedUserStatusList.html' target='_blank'>querySubscribedUserStatusList</a>,
  'web': <a href='https://www.zegocloud.com/article/api?doc=zim_API~javascript_web~class~ZIM#query-subscribed-user-status-list' target='_blank'>querySubscribedUserStatusList</a>,
}



# Subscribe to User Online Status

---

## Overview

This article describes how to use the ZIM SDK to subscribe to user online status.

## Prerequisites

You have already integrated the ZIM SDK into your project and implemented basic message sending and receiving. For details, refer to [Quick Start - Implement Basic Message Sending and Receiving](../Send%20and%20receive%20messages.mdx).

## Implementation Steps

1. Define user online status data.

:::if{props.platform=undefined}
```java
Map<String, ZIMUserStatus> myUserStatusMap = new HashMap<>();
```
:::
:::if{props.platform="iOS|mac"}
```objc
NSMutableDictionary<NSString *,ZIMUserStatus *> myUserStatusMap;
```
:::
:::if{props.platform="window"}
```cpp
std::unordered_map<std::string, ZIMUserStatus> myUserStatusMap;
```
:::
:::if{props.platform="flutter"}
```dart
final Map<String, ZIMUserStatus> myUserStatusMap = {};
```
:::
:::if{props.platform="web"}
```ts
const myUserStatusMap: Record<string, ZIMUserStatus> = {};
```
:::


2. Listen for user status update events, and the changes in the user's online status will be returned through {getPlatformData(props,onUserStatusUpdatedMap)}.
:::if{props.platform=undefined}
```java
// java
public void onUserStatusUpdated(ArrayList<ZIMUserStatus> userStatusList) {
    for (ZIMUserStatus status : userStatusList) {
        myUserStatusMap.put(status.getUserID(), status);
    }
    // TODO: Refresh UI
}
```
:::
:::if{props.platform="iOS|mac"}
```objc
- (void)zim:(ZIM *)zim userStatusUpdated:(NSArray<ZIMUserStatus *> *)userStatusList {
    for (ZIMUserStatus *userStatus in userStatusList) {
        // Use userID as key directly, replace if it exists, add if it doesn't exist
        myUserStatusList[userStatus.userID] = userStatus;
    }
    // At this time, the UI can be refreshed or other operations can be performed
}

```
:::
:::if{props.platform="window"}
```cpp
// User status update callback
void onUserStatusUpdated(const std::vector<ZIMUserStatus>& userStatusList) {
    for (const auto& status : userStatusList) {
        myUserStatusMap[status.userID] = status;
    }
    // TODO: Refresh UI
};
```
:::
:::if{props.platform="flutter"}
```dart
ZIMEventHandler.onUserStatusUpdated = (List<ZIMUserStatus> userStatusList) {
  for (var status in userStatusList) {
    myUserStatusMap[status.userID] = status;
  }
  // TODO: Refresh UI
};
```
:::
:::if{props.platform="web"}
```ts
zim.on('userStatusUpdated', (userStatusList: ZIMUserStatus[]) => {
  userStatusList.forEach(status => {
    myUserStatusMap[status.userID] = status;
  });
  // TODO: Refresh UI
});
```
:::

3. Subscribe to users of interest through the {getPlatformData(props,subscribeUsersStatusMap)} interface.

:::if{props.platform=undefined}
```java
ZIMUserStatusSubscribeConfig config = new ZIMUserStatusSubscribeConfig();
config.setSubscriptionDuration(60 * 24); // 1 day
zim.subscribeUsersStatus(Arrays.asList("userIdA", "userIdB"), config, (errorUserList, errorInfo) -> {
    
});

```
:::
:::if{props.platform="iOS|mac"}
```objc
ZIMUserStatusSubscribeConfig *config = [[ZIMUserStatusSubscribeConfig alloc] init];

config.subscriptionDuration = 60 *24; // Subscription duration (in minutes), valid range is 1 to 43200 (30 days)

[[ZIM getInstance] subscribeUsersStatus:@[@"userIdA",@"userIdB"] //Please pass in the users that need to be subscribed to

                   config:config

                 callback:^(NSArray<ZIMErrorUserInfo *> *_Nonnull errorUserList,

                            ZIMError *_Nonnull errorInfo) {}];
                            
```
:::
:::if{props.platform="window"}
```cpp
ZIMUserStatusSubscribeConfig config;
config.subscriptionDuration = 60 * 24; // 1 day
zim->subscribeUsersStatus({"userIdA", "userIdB"}, config, [](const std::vector<ZIMErrorUserInfo>& errorUserList, const ZIMError& errorInfo){
    
});


```
:::
:::if{props.platform="flutter"}
```dart
final config = ZIMUserStatusSubscribeConfig();
config.subscriptionDuration = 60 * 24;
zim.subscribeUsersStatus(["userIdA", "userIdB"], config).then((errorUserList) {
});

```
:::
:::if{props.platform="web"}
```ts
const config = { subscriptionDuration: 60 * 24 }; // 1 day
zim.subscribeUsersStatus(['userIdA','userIdB'], config)
   .then((errorUserList) => {
       
});
```
:::

4. Query user subscription information through the {getPlatformData(props,querySubscribedUserStatusListMap)} interface.

:::if{props.platform=undefined}
```java
// Query subscription list
ZIMSubscribedUserStatusQueryConfig queryConfig = new ZIMSubscribedUserStatusQueryConfig();
queryConfig.setUserIDs(Arrays.asList("userIdA", "userIdB"));
zim.querySubscribedUserStatusList(queryConfig, (userStatusSubscriptionList, errorInfo) -> {
    for (ZIMUserStatusSubscription subscription : userStatusSubscriptionList) {
        myUserStatusMap.put(subscription.getUserStatus().getUserID(), subscription.getUserStatus());
    }
    // TODO: Refresh UI
});
```
:::
:::if{props.platform="iOS|mac"}
```objc
ZIMSubscribedUserStatusQueryConfig *config = [[ZIMSubscribedUserStatusQueryConfig alloc] init];

// Query the target user ID (up to 200 users per query)
// When userIDs is empty, it indicates retrieving the complete subscription table information
// When userIDs is not empty, it indicates checking whether the target users are in the subscription list
// If they are, the result callback will include their status information
// If they are not, the result callback will not include any related information
config.userIDs = @[@"userIdA",@"userIdB"]; //Please pass in the users that need to be subscribed to
```
:::
:::if{props.platform="window"}
```cpp
ZIMSubscribedUserStatusQueryConfig queryConfig;
queryConfig.userIDs = {"userIdA", "userIdB"};
zim->querySubscribedUserStatusList(queryConfig, [&](const std::vector<ZIMUserStatusSubscription>& subscriptions, const ZIMError& errorInfo){
    for (const auto& sub : subscriptions) {
        myUserStatusMap[sub.userStatus.userID] = sub.userStatus;
    }
    // TODO: Refresh UI
});
```
:::
:::if{props.platform="flutter"}
```dart
// Query subscription list
final queryConfig = ZIMSubscribedUserStatusQueryConfig(userIDs: ["userIdA", "userIdB"]);
zim.querySubscribedUserStatusList(queryConfig).then((result) {
  for (var sub in result.userStatusSubscriptionList) {
    myUserStatusMap[sub.userStatus.userID] = sub.userStatus;
  }
  // TODO: Refresh UI
});
```
:::
:::if{props.platform="web"}
```ts
// Query subscription list
const queryConfig = { userIDs: ['userIdA','userIdB'] };
zim.querySubscribedUserStatusList(queryConfig)
   .then(result => {
       result.userStatusSubscriptionList.forEach(sub => {
           myUserStatusMap[sub.userStatus.userID] = sub.userStatus;
       });
       // TODO: Refresh UI
   });
```
:::


