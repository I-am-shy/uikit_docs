---
articleID: 15340
---

# ZIM 升级指南

- - -

本文介绍 ZIM uni-app x UTS 插件版本升级时的一些说明和注意事项。

## 2.21.1 升级指南

<Warning title="注意">

ZIM uni-app x UTS 2.21.1 版本针对部分 HBuilderX 版本在 iOS 平台分页查询会话列表、分页查询历史消息等接口时导致的 APP 崩溃问题进行了兼容修复，并修改了部分接口的用法。从旧版本升级到 2.21.1 版本时，请您阅读以下指南。
</Warning>

### 接口用法变更

1. `ZIMConversationQueryConfig.nextConversation` 类型变更
 
   旧版的 `ZIMConversation` 变更为 string，取值规则为 `ZIMConversation.type.toString() + ZIMConversation.conversationID` 。
 
```
// 分页查询会话列表
zim.queryConversationList({ count: 1, nextConversation: null } as ZIMConversationQueryConfig, null).then((res) => {
    console.log('queryConversationList-1', res);
    const conv = res.conversationList[res.conversationList.length - 1];
    const nextFlag = conv.type.toString() + conv.conversationID;
    zim.queryConversationList({ count: 1, nextConversation: nextFlag } as ZIMConversationQueryConfig, null).then((res) => {
        console.log('queryConversationList-2', res);  
    });             
});
```

2. `ZIMMessageQueryConfig.nextMessage`、`ZIMMessageSearchConfig.nextMessage`、`ZIMMessagesSearchedResult.nextMessage`、`ZIMMessagesGlobalSearchedResult.nextMessage` 类型变更
 
   旧版的 `ZIMMessage` 变更为 string，取值规则为 `ZIMMessage.localMessageID` 。
 
```
// 分页查询历史消息  
zim.queryHistoryMessage(用户ID, 0, { count: 1, reverse: true, nextMessage: null } as ZIMMessageQueryConfig).then((res) => {
    console.log('queryHistoryMessage-1', res);
    const nextFlag = res.messageList[0]?.localMessageID;
    zim.queryHistoryMessage(用户ID, 0, { count: 1, reverse: true, nextMessage: nextFlag } as ZIMMessageQueryConfig).then((res) => {
        console.log('queryHistoryMessage-2', res);  
    });                
});
```
