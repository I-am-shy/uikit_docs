---
articleID: 14765
---
# Device Detection

---

## Function Introduction

To ensure real-time communication experience, device detection can be performed before calls or live streaming to identify and troubleshoot problems in advance. Device detection mainly detects whether the local microphone, camera, and speaker can work normally.


## Prerequisites

Before implementing device detection functions, please ensure:

- A project has been created in [ZEGOCLOUD Console](https://console.zegocloud.com), and a valid AppID and AppSign have been applied for. For details, please refer to [Console - Project Information](/console/project-info).

- ZEGO Express SDK has been integrated into the project, and basic audio and video publish/play functions have been implemented. For details, please refer to [Quick Start - Integration](/live-streaming-android/quick-start/integrating-sdk) and [Quick Start - Implementation Process](/live-streaming-android/quick-start/implementing-live-streaming).


## Device Detection


### Microphone Detection

#### Detection Logic

The microphone device detection process is shown in the following figure:

<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Common/ZegoExpressEngine/Microphone_detection.png" /></Frame>


#### Corresponding Interfaces

**1. Start Microphone**

Call the [startPreview](https://www.zegocloud.com/docs/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine&jumpType=route#start-preview) interface to start audio capture without publishing stream.

```java
engine.startPreview();
```

**2. Detect Microphone Permission**

ZEGO SDK automatically checks microphone permissions.

<Warning title="Warning">
<p>
Because Android 6.0 requires dynamic permission requests for some important permissions, you cannot just apply for static permissions through the "AndroidMainfest.xml" file. Therefore, you also need to refer to executing the following code, where "requestPermissions" is a method of "Activity".
</p>
</Warning>



```java
String[] permissionNeeded = {
    "android.permission.RECORD_AUDIO"};

if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {
    if (ContextCompat.checkSelfPermission(this, "android.permission.RECORD_AUDIO") != PackageManager.PERMISSION_GRANTED) {
        requestPermissions(permissionNeeded, 101);
    }
}
```

**3. Detect whether Microphone is Available**


Detect whether the device is abnormal through the following callback. If no abnormal feedback is detected (you can synchronously start "4. Detect Microphone Sound Data"), and the microphone sound data detection is normal, the microphone device is available.

Listen to the [onLocalDeviceExceptionOccurred](@onLocalDeviceExceptionOccurred) callback to detect whether the device is abnormal.


```java
/**
 * Local device exception notification
 *
 * Supported version: 1.0.0 and above.
 * Detailed description: Local device exception.
 * Notification timing: This callback is triggered when local audio or video device functions malfunction.
 *
 * @param exceptionType Device exception type.
 * @param deviceType Device type that is abnormal.
 * @param deviceID Device ID. Currently only supports desktop devices, used to identify specific devices. For mobile devices, this parameter will return an empty string.
 */
public void onLocalDeviceExceptionOccurred(ZegoDeviceExceptionType exceptionType, ZegoDeviceType deviceType, String deviceID){

}
```

**4. Detect Microphone Sound Data**

Call the [startSoundLevelMonitor](https://www.zegocloud.com/docs/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine&jumpType=route#start-sound-level-monitor) interface to obtain the energy value of the sound captured by the microphone. If the data is normal, the microphone is normal and can be used for calls or live streaming.

```java
engine.startSoundLevelMonitor();
```


### Camera Detection

#### Detection Logic

The camera device detection process is shown in the following figure:

<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Common/ZegoExpressEngine/Camera_detection.png" /></Frame>


#### Corresponding Interfaces

**1. Start Camera**

Call the [startPreview](https://www.zegocloud.com/docs/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine&jumpType=route#start-preview) interface to bind the camera preview screen view and start video capture and preview without publishing stream.

```java
engine.startPreview();
```

**2. Detect Camera Permission**

ZEGO SDK will automatically check camera permissions.

<Warning title="Warning">
<p>
Because Android 6.0 requires dynamic permission requests for some important permissions, you cannot just apply for static permissions through the "AndroidMainfest.xml" file. Therefore, you also need to refer to executing the following code, where "requestPermissions" is a method of "Activity".
</p>
</Warning>



```java
String[] permissionNeeded = {
    "android.permission.CAMERA"};

if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {
    if (ContextCompat.checkSelfPermission(this, "android.permission.CAMERA") != PackageManager.PERMISSION_GRANTED) {
        requestPermissions(permissionNeeded, 101);
    }
}
```

**3. Detect whether Camera is Available**


Detect whether the device is abnormal through the following callback. If no abnormal feedback is detected (you can synchronously start "4. Detect whether Screen is Normal"), and the screen display is normal, the device is available.

Listen to the [onLocalDeviceExceptionOccurred](@onLocalDeviceExceptionOccurred) callback to detect whether the device is abnormal.


```java
/**
 * Local device exception notification
 *
 * Supported version: 1.0.0 and above.
 * Detailed description: Local device exception.
 * Notification timing: This callback is triggered when local audio or video device functions malfunction.
 *
 * @param exceptionType Device exception type.
 * @param deviceType Device type that is abnormal.
 * @param deviceID Device ID. Currently only supports desktop devices, used to identify specific devices. For mobile devices, this parameter will return an empty string.
 */
public void onLocalDeviceExceptionOccurred(ZegoDeviceExceptionType exceptionType, ZegoDeviceType deviceType, String deviceID){

}
```


**4. Detect whether Screen is Normal**

If the screen display is normal at this time, the camera is normal and can be used for calls or live streaming.


### Speaker Detection

#### Detection Logic

The playback device detection process is shown in the following figure:

<Frame width="512" height="auto" caption=""><img src="https://doc-media.zego.im/sdk-doc/Pics/Common/ZegoExpressEngine/Playback_device_detection.png" /></Frame>


#### Corresponding Interfaces

**1. Use Media Player to Play Audio File**

Call the [ZegoMediaPlayer](https://www.zegocloud.com/docs/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-media-player&jumpType=route) interface to play the audio file you use for testing.

```java
// 1. Create player object
ZegoMediaPlayer mediaPlayer = engine.createMediaPlayer();
// 2. Load resource
String resourcePath = "xxx";
mediaPlayer.loadResource(resourcePath, null);
// 3. Play resource
mediaPlayer.start();
```

**2. Detect whether Sound is Heard**

If you can hear the corresponding audio, the playback device is normal and can be used for calls or live streaming. Call the [onMediaPlayerStateUpdate](https://www.zegocloud.com/docs/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-callback-i-zego-media-player-event-handler&jumpType=route#on-media-player-state-update) interface to view player status callback:

```java
/**
* Player playback status callback
* @param mediaPlayer Player instance of the callback
* @param state Player status
* @param errorCode Error code. For details, please refer to the common error codes document
*/
public void onMediaPlayerStateUpdate(ZegoMediaPlayer mediaPlayer, ZegoMediaPlayerState state, int errorCode){}
```


## API Reference List

| Method | Description |
|----|----|
|[startPreview](https://www.zegocloud.com/docs/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine&jumpType=route#start-preview)|Start local preview|
|[onLocalDeviceExceptionOccurred](@onLocalDeviceExceptionOccurred)|Local device exception notification|
|[startSoundLevelMonitor](https://www.zegocloud.com/docs/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-zego-express-engine&jumpType=route#start-sound-level-monitor)|Start volume change monitoring|
|[onMediaPlayerStateUpdate](https://www.zegocloud.com/docs/article/api?doc=Express_Video_SDK_API~Java_android~class~im-zego-zegoexpress-callback-i-zego-media-player-event-handler&jumpType=route#on-media-player-state-update)|Player playback status callback|




## Common Error Codes

When the developer receives [onLocalDeviceExceptionOccurred](@onLocalDeviceExceptionOccurred) device callback not equal to 0, please refer to [Common Error Codes](https://www.zegocloud.com/docs/article/4378#7) for related error codes.
