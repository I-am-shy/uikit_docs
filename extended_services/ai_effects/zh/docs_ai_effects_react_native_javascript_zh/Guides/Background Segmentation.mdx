# 背景分割

- - -

## 功能简介

ZegoEffects SDK 提供背景分割功能，适用于在线教育、视频会议、美发、短视频等多种场景。

## 前提条件

在使用 ZegoEffects SDK 美颜功能前，请确保：

- 已在项目中集成 ZegoEffects SDK，实现基本的图像处理功能，详情请参考 [快速开始 - 实现图像处理\|_blank](!Quick_Starts/Solution_Implementation)。
- 导入人像分割模型 “SegmentationModel” 文件，详情请参考 [快速开始 - 导入资源和模型\|_blank](!Quick_Starts/Import_Resources)。

## 使用步骤

背景分割包括人像分割、绿幕分割，以及背景虚化、背景马赛克等功能。

### 人像分割

<Warning title="Warning">

使用人像分割功能前，请先导入对应的 “SegmentationModel” 模型文件，否则功能无法生效。详情请参考 [快速开始 - 导入资源和模型\|_blank](!Quick_Starts/Import_Resources)。
</Warning>

1. 调用 [setPortraitSegmentationBackgroundPath\|_blank](@setPortraitSegmentationBackgroundPath) 接口，设置人像分割使用的背景路径。

    ```java
    // 设置人像分割使用的背景路径
    mEffects.setPortraitSegmentationBackgroundPath("MY_BACKGROUND_PATH", ZegoEffectsScaleMode.ASPECT_FILL);
    ```

2. 调用 [enablePortraitSegmentation\|_blank](@enablePortraitSegmentation) 接口开启人像分割功能。

    ```java
    // 开启人像分割功能
    mEffects.enablePortraitSegmentation(true);
    ```

<p>开启人像分割功能后，开发者可以根据需要进一步设置背景虚化、背景马赛克等功能。</p>

#### 人像分割背景虚化

调用 [enablePortraitSegmentationBackgroundBlur\|_blank](@enablePortraitSegmentationBackgroundBlur) 接口开启人像分割背景虚化功能，打开虚化功能后可调用 [setPortraitSegmentationBackgroundBlurParam\|_blank](@setPortraitSegmentationBackgroundBlurParam) 接口设置 [ZegoEffectsBlurParam\|_blank](@-ZegoEffectsBlurParam) 对象的 “intensity” 参数，调整背景虚化的程度。

<div class = 'mk-warning'>

开启人像分割背景虚化功能后，会覆盖自定义背景及背景马赛克功能。
</div>

   
```java
// 开启人像分割背景虚化
mEffects.enablePortraitSegmentationBackgroundBlur(true);

// 设置人像分割背景虚化参数
mEffects.setPortraitSegmentationBackgroundBlurParam({ intensity: 100 });
```

#### 人像分割背景马赛克

调用 [enablePortraitSegmentationBackgroundMosaic\|_blank](@enablePortraitSegmentationBackgroundMosaic) 接口开启人像分割背景马赛克功能，打开马赛克功能后可调用 [setPortraitSegmentationBackgroundMosaicParam\|_blank](@setPortraitSegmentationBackgroundMosaicParam) 接口设置 [ZegoEffectsMosaicParam\|_blank](@-ZegoEffectsMosaicParam) 对象的 “intensity” 参数参数，调整马赛克的程度。

<div class = 'mk-warning'>

开启人像分割背景马赛克功能后，会覆盖自定义背景及背景虚化功能。
</div> 

   
```java
// 开启人像分割背景马赛克
mEffects.enablePortraitSegmentationBackgroundMosaic(true);

// 设置人像分割背景马赛克参数
mEffects.setPortraitSegmentationBackgroundMosaicParam({ intensity: 100 });
```
    

### 绿幕分割


1. 调用 [setChromaKeyBackgroundPath\|_blank](@setChromaKeyBackgroundPath) 接口，设置绿幕分割使用自定义背景路径。

    ```java
    // 设置绿幕分割使用的背景路径
    mEffects.setChromaKeyBackgroundPath("MY_BACKGROUND_PATH", ZegoEffectsScaleMode.ASPECT_FILL);
    ```

2. 调用 [enableChromaKey\|_blank](@enableChromaKey) 接口开启绿幕分割功能，然后调用 [setChromaKeyParam\|_blank](@setChromaKeyParam) 接口设置参数，调整颜色容差、边缘平滑指数等。

    ```java
    // 开启绿幕分割功能
    mEffects.enableChromaKey(true);

    // 设置绿幕分割参数
    let param = new ZegoEffectsChromaKeyParam();
    param.smoothness = 80;
    param.opacity = 100;
    param.keyColor = 65280;
    param.similarity = 67;
    mEffects.setChromaKeyParam(param);
    ```


<p>开启绿幕分割功能后，开发者可以根据需要进一步设置背景虚化、背景马赛克等功能。</p>

#### 绿幕分割背景虚化

调用 [enableChromaKeyBackgroundBlur\|_blank](@enableChromaKeyBackgroundBlur) 接口开启绿幕背景虚化功能，打开虚化功能后可调用 [setChromaKeyBackgroundBlurParam\|_blank](@setChromaKeyBackgroundBlurParam) 接口设置 [ZegoEffectsBlurParam\|_blank](@-ZegoEffectsBlurParam) 对下的 “intensity” 参数，调整虚化的程度。

<div class = 'mk-warning'>

开启绿幕分割背景虚化功能后，会覆盖自定义背景及背景马赛克功能。
</div>

```java
// 开启绿幕分割背景虚化
mEffects.enableChromaKeyBackgroundBlur(true);

// 设置绿幕分割背景虚化参数
mEffects.setChromaKeyBackgroundBlurParam({ intensity: 100 });
```

#### 绿幕分割背景马赛克

调用 [enableChromaKeyBackgroundMosaic\|_blank](@enableChromaKeyBackgroundMosaic) 接口开启绿幕背景马赛克功能，打开马赛克功能后可调用 [setChromaKeyBackgroundMosaicParam\|_blank](@setChromaKeyBackgroundMosaicParam) 接口设置 [ZegoEffectsMosaicParam\|_blank](@-ZegoEffectsMosaicParam) 对象的 “intensity” 参数，调整马赛克的程度。


<div class = 'mk-warning'>

开启绿幕分割背景马赛克功能后，会覆盖自定义背景及背景虚化功能。
</div>
   
```java
// 开启绿幕分割背景马赛克
mEffects.enableChromaKeyBackgroundMosaic(true);

// 设置绿幕分割背景马赛克参数
mEffects.setChromaKeyBackgroundMosaicParam({ intensity: 100 });
```
