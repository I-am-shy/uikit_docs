@@@ServerAPIWarning@@@

# 创建上传任务

- - -

<Note title="Note">

此功能为增值服务，如需使用，请联系 ZEGO 商务人员开通。
</Note>

## 描述

创建一个上传任务，将 URL 在线资源上传到 OSS。上传之后同区域的云播放器集群可以通过内网拉流地址获取播放资源，保证资源传输过程的稳定性。

## 接口原型
- 请求方法：POST
- 请求地址：https://cloud-player-api.zego.im/?Action=CreateUploadTask
- 传输协议：HTTPS
- 调用频率限制：20 次/秒
  <Note title="Note">

  对于单个 AppID 而言，ZEGO 服务端最多同时可处理 10 上传任务（包含上传中和等待中），如需调高上限，请联系 ZEGO 技术支持修改。
  </Note>

## 请求参数

以下请求参数列表仅列出了接口请求参数，公共参数列表请参考 [调用方式 - 公共请求参数](!APIs_method#4_1)。

<table>
  
<tbody><tr>
<th>名称</th>
<th>类型</th>
<th>必填</th>
<th>描述</th>
</tr>
<tr>
<td>Title</td>
<td>String</td>
<td>是</td>
<td>文件名称，长度上限为 100B，文件后缀（支持 <code>.mp3</code>、<code>.mp4</code>、<code>.flv</code>、<code>.wav</code>、<code>.aac</code> 和 <code>.flac</code>） 需保留且正确，否则可能导致播放失败。<Warning title="Warning">请勿使用相同文件名称。如果多个文件的 Title 相同，它们会互相替代，只保留最后上传的文件，但是，新文件可能会继承旧文件的过期时间。</Warning></td>
</tr>
<tr>
<td>StreamUrl</td>
<td>String</td>
<td>是</td>
<td>媒体资源的地址，必须是有效的 HTTP/HTTPS 地址，且长度在 1024 字节以内，文件大小上限为 5GB。</td>
</tr>
<tr>
<td>RetentionDays</td>
<td>Number</td>
<td>否</td>
<td>资源有效时长，单位为天。有效取值范围为 [1, 7]，（默认值：3），如果您需要提高上限，请联系 ZEGO 技术支持处理。</td>
</tr>
<tr>
<td>ContentMd5</td>
<td>String</td>
<td>否</td>
<td>ContentMd5 是通过 MD5 算法对文件进行计算生成的哈希值，然后经过 Base64 编码得到的结果，用于验证文件在上传过程中是否保持完整性。<br />如果您在上传时提供了 ContentMd5 参数，ZEGO 服务端会通过 OSS 计算文件的 ContentMd5 并与您提供的值进行比对。若两者不一致，上传将失败，表明文件可能被篡改或损坏。<br />为确保文件的完整性和安全性，强烈建议在上传文件时传入 ContentMd5 参数。</td>
</tr>
</tbody></table>

以下是使用 PHP 生成 ContentMd5 的示例：
```PHP
function calculateMD5($content) {
    return base64_encode(md5($content, true));
}
```
## 请求示例


- 请求 URL：
    ```json
    https://cloud-player-api.zego.im/?Action=CreateUploadTask
    &AppId=1234567890
    &SignatureNonce=15215528852396
    &Timestamp=1234567890
    &Signature=7a2c0f11145fb760d607a07b54825013
    &SignatureVersion=2.0
    &IsTest=false
    ```

- 请求消息体：
    ```json
    {
        "Title":"your-title.mp4",
        "StreamUrl": "https://xxx.com/video/test.mp4",
        "RetentionDays":3,
        "ContentMd5":"0uyh0doi++pDCwZkI0VEfA=="
    }
    ```

## 响应参数

<table class="collapsible-table" >
  
<tbody><tr data-row-level="1">
<th>参数</th>
<th>类型</th>
<th>描述</th>
</tr>
<tr data-row-level="2">
<td>Code</td>
<td>Number</td>
<td>返回码</td>
</tr>
<tr data-row-level="3">
<td>Message</td>
<td>String</td>
<td>操作结果描述。</td>
</tr>
<tr data-row-level="4">
<td>RequestId</td>
<td>String</td>
<td>请求 ID。</td>
</tr>
<tr data-row-level="5" data-row-child="true">
<td>Data</td>
<td>Object</td>
<td>响应对象。</td>
</tr>
<tr data-row-level="5-1">
<td>UploadTaskId</td>
<td>String</td>
<td>上传任务 ID。</td>
</tr>
<tr data-row-level="5-2">
<td>CreateTime</td>
<td>Number</td>
<td>文件上传任务创建成功的 Unix 时间戳，单位：秒。</td>
</tr>
</tbody></table>

## 响应示例

```json
{
    "Code": 0,
    "Message": "succeed",
    "RequestId": "955607951583870294",
    "Data": {
        "UploadTaskId": "upload_task_1",
        "CreateTime": 1681221508
    }
}
```

## 返回码

<table>
  
<tbody><tr>
<th>返回码</th>
<th>说明</th>
<th>处理建议</th>
</tr>
<tr>
<td>0</td>
<td>成功。</td>
<td>-</td>
</tr>
<tr>
<td>100000004</td>
<td>签名过期。</td>
<td>请重新生成签名。</td>
</tr>
<tr>
<td>100000005</td>
<td>签名错误。</td>
<td>请确认生成签名的参数是否正确。</td>
</tr>
<tr>
<td>350006001</td>
<td>接口请求频率超过上限。</td>
<td>请确认对应接口的 QPS 限制，降低请求频率。</td>
</tr>
<tr>
<td>350006002</td>
<td>网关校验失败。</td>
<td>请联系 ZEGO 技术支持处理。</td>
</tr>
<tr>
<td>350006003</td>
<td>无效的输入参数。</td>
<td>请根据 Message 提示，调整对应参数的取值。</td>
</tr>
<tr>
<td>350006006</td>
<td>服务未开通。</td>
<td>请联系 ZEGO 技术支持，开通服务权限。</td>
</tr>
<tr>
<td>350006010</td>
<td>上传任务并发数达到上限。</td>
<td>请确认当前进行中的上传任务数量是否超过上限，默认上限为 10 个。</td>
</tr>
<tr>
<td>350010000</td>
<td>系统错误。</td>
<td>请联系 ZEGO 技术支持处理。</td>
</tr>
</tbody></table>
