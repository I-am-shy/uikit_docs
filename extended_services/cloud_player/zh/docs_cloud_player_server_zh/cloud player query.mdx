
# 查询云端播放器任务列表

- - -

## 描述

调用本接口查询 AppID 下所有的云端播放器任务列表，包含已创建、正在运行中、已销毁等所有状态；或查询指定云端播放器的任务信息。

## 接口原型

- 请求方法：POST
- 请求地址：`https://cloud-player-api.zego.im/?Action=DescribePlayers`
- 传输协议：HTTPS
- 调用频率限制：10 次/秒

## 请求参数

以下请求参数列表仅列出了接口请求参数，公共参数列表请参考 [调用方式 - 公共请求参数](./APIs%20method.mdx#21-公共请求参数)。

<Warning title="注意">

- RoomId 和 PlayerId 都不填写时，调用本接口会返回 AppId 下所有的云端播放器任务列表。
- RoomId 填写、PlayerId 不填写时，调用本接口会返回 AppId 下该房间 RoomId 内的所有的云端播放器任务列表。
- PlayerId 填写（RoomId 填或不填均可）时，调用本接口会返回该 PlayerId 对应的云端播放器任务信息。
</Warning>

<table>
  
<tbody><tr>
<th>参数</th>
<th>类型</th>
<th width="20%">是否必选</th>
<th>描述</th>
</tr>
<tr>
<td>RoomId</td>
<td>String</td>
<td>否</td>
<td><p>查询指定房间 ID，长度在 128 字节以内。</p><p><b>如果填写了 RoomId，请确保 RoomId 是已存在的，否则查询结果可能为空。</b></p></td>
</tr>
<tr>
<td>PlayerId</td>
<td>String</td>
<td>否</td>
<td><p>云端播放器唯一标识 ID，通过 <a href="./cloud player create.mdx" target="blank">CreatePlayer</a> 返回。</p><p><b>如果填写了 PlayerId，请确保 PlayerId 是已存在的，否则查询结果可能为空。</b></p></td>
</tr>
<tr>
<td>PageSize</td>
<td>Number</td>
<td>否</td>
<td><p>分页大小，取值范围 (0, 50]，默认为 50 个/页，指调用本接口一次最多返回的任务列表数量。<b>超过 PageSize 取值的任务列表，需要根据前一次调用本接口时、返回结果中的 NextPageToken（查询任务列表分页起始位）取值，再次调用本接口进行查询。</b></p><p>例如，当前有 123 个云端播放器任务，PageSize 取值为 50，调用本接口查询时：</p><ol><li>第一次调用本接口，入参 PageToken 传空，查询第 1 ～ 50 的播放器任务；返回结果中 NextPageToken 值假设为  “pagetoken1”。</li><li>第二次调用本接口，入参 PageToken 取值为 “pagetoken1”，查询第 51 ～ 100 的播放器任务；返回结果中 NextPageToken 值假设为 “pagetoken2”。
</li><li>第三次调用本接口，入参 PageToken 取值为 “pagetoken2”，查询第 101 ～ 123 的播放器任务；查询完毕，返回结果中 NextPageToken 为空。</li></ol></td>
</tr>
<tr>
<td>PageToken</td>
<td>String</td>
<td>否</td>
<td><p>查询任务列表分页起始位，<b>该参数不填写时，默认返回查询到的第一页任务列表。</b></p>每次调用本接口发起请求时，响应结果中都会返回 NextPageToken，开发者需要判断是否查询到最后一页。</td>
</tr>
</tbody></table>


## 请求示例

#### 请求 URL
  
```
https://cloud-player-api.zego.im/?Action=DescribePlayers
&AppId=1234567890
&SignatureNonce=15215528852396
&Timestamp=1234567890
&Signature=7a2c0f11145fb760d607a07b54825013
&SignatureVersion=2.0
&IsTest=false
```

#### 请求消息体  

```json
{
    "RoomId": "room_12",
    "PlayerId": "",
    "PageSize": 50,
    "PageToken": "XXXXXXXXX"
}
```

## 响应参数

<table class="collapsible-table" >
  
<tbody><tr data-row-level="1">
<th>参数</th>
<th>类型</th>
<th>描述</th>
</tr>
<tr data-row-level="2">
<td>Code</td>
<td>Number</td>
<td>错误码。</td>
</tr>
<tr data-row-level="3">
<td>Message</td>
<td>String</td>
<td>错误描述。</td>
</tr>
<tr data-row-level="4">
<td>RequestId</td>
<td>String</td>
<td>请求 ID。</td>
</tr>
<tr data-row-level="5" data-row-child="true">
<td>Data</td>
<td>Object</td>
<td>返回的具体信息。</td>
</tr>
<tr data-row-level="5-1">
<td>TotalSize</td>
<td>Number</td>
<td>查询到的云端播放器任务总数。</td>
</tr>
<tr data-row-level="5-2">
<td>NextPageToken</td>
<td>String</td>
<td>本次查询的下一页页码。NextPageToken 为空时，表示已查询到最后一页。</td>
</tr>
<tr data-row-level="5-3" data-row-child="true">
<td>Players</td>
<td>Array Of Object</td>
<td>查询到的云端播放器任务信息。</td>
</tr>
<tr data-row-level="5-3-1">
<td>PlayerId</td>
<td>String</td>
<td>云端播放器唯一标识 ID。</td>
</tr>
<tr data-row-level="5-3-2">
<td>RoomId</td>
<td>String</td>
<td>房间 ID。</td>
</tr>
<tr data-row-level="5-3-3">
<td>StreamId</td>
<td>String</td>
<td>推流到指定房间的流 ID。</td>
</tr>
<tr data-row-level="5-3-4">
<td>CreateTime</td>
<td>Number</td>
<td>播放器创建时间，Unix 时间戳，单位为秒。</td>
</tr>
<tr data-row-level="5-3-5">
<td>PlayTime</td>
<td>Number</td>
<td>开始播放媒体资源的时间，Unix 时间戳，单位为秒。</td>
</tr>
<tr data-row-level="5-3-6">
<td>PlayerName</td>
<td>String</td>
<td>云端播放器的名称。</td>
</tr>
<tr data-row-level="5-3-7">
<td>StreamUrl</td>
<td>String</td>
<td>播放的媒体资源的地址。</td>
</tr>
<tr data-row-level="5-3-8">
<td>Status</td>
<td>Number</td>
<td><p>云端播放器的状态。</p><ul><li>1：创建中。</li><li>2：连接媒体资源中。</li><li>3：等待播放。</li><li>4：播放中。</li><li>5：暂停中。</li><li>6：连接媒体资源失败。</li><li>7：播放结束。</li><li>8：已销毁。</li></ul></td>
</tr>
<tr data-row-level="5-3-9">
<td>DestroyReason</td>
<td>Number</td>
<td><p>云端播放器销毁的原因。</p><ul><li>1：调用了 <a href="/article/17862" target="blank"> DeletePlayer</a> 接口主动销毁。</li><li>2：处于空闲状态的时长超过了 <code>MaxIdleTime</code>。</li><li>3：媒体资源播放已结束。</li><li>4：推流失败。</li><li>5：进入房间失败或被踢出房间。</li></ul></td>
</tr>
</tbody></table>

## 响应示例

```json
{
    "Code": 0,
    "Message": "succeed",
    "RequestId": "abcd123",
    "Data": {
        "TotalSize": 1,
        "NextPageToken": "",
        "Players": [
            {
                "PlayerId": "player_1",
                "RoomId": "room_12",
                "StreamId": "stream",
                "CreateTime": 1681221508,
                "PlayTime": 1681221508,
                "PlayerName": "player_1",
                "StreamUrl": "https://your-bucket.oss-cn-shanghai.aliyuncs.com/video/test.mp4",
                "Status": 4,
                "DestroyReason": 1
            }
        ]
    }
}
```

## 返回码

以下仅列出了接口业务逻辑相关的返回码，完整返回码请参考 [全局返回码](./return%20codes.mdx)。

<table>
  
<tbody><tr>
<th>返回码</th>
<th>说明</th>
<th>处理建议</th>
</tr>
<tr>
<td>0</td>
<td>成功。</td>
<td>-</td>
</tr>
<tr>
<td>100000004</td>
<td>签名过期。</td>
<td>请重新生成签名。</td>
</tr>
<tr>
<td>100000005</td>
<td>签名错误。</td>
<td>请确认生成签名的参数是否正确。</td>
</tr>
<tr>
<td>350006001</td>
<td>接口请求频率超过上限。</td>
<td>请确认对应接口的 QPS 限制，降低请求频率。</td>
</tr>
<tr>
<td>350006002</td>
<td>网关校验失败。</td>
<td>请联系 ZEGO 技术支持处理。</td>
</tr>
<tr>
<td>350006003</td>
<td>无效的输入参数。</td>
<td>请根据 Message 提示，调整对应参数的取值。</td>
</tr>
<tr>
<td>350006006</td>
<td>服务未开通。</td>
<td>请联系 ZEGO 技术支持，开通服务权限。</td>
</tr>
<tr>
<td>350010000</td>
<td>系统错误。</td>
<td>请联系 ZEGO 技术支持处理。</td>
</tr>
</tbody></table>
