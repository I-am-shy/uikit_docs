@@@ServerAPIWarning@@@

# 回调校验说明

---

为提高数据安全性，开发者在收到 ZEGO 服务端发出的回调时，进行本地签名计算，并与 signature 进行对比，判断该请求是否合法。

请参考以下方式，校验回调请求的发起来源是否为 ZEGO 云端播放器。

## 校验方法

开发者需要将自行计算出的 signature 值，与回调结果中的 signature 值进行对比，判断两者是否一致，以此来验证请求的发起方是否为 ZEGO 云端播放器。

自行计算 signature 的流程如下图：

![](/Pics/server/Callback/encryptVerifyProcess.png)

- nonce：回调请求中的随机数。
- timestamp：回调请求中的 Unix 时间戳。
- callbacksecret：服务端校验密钥。在 [ZEGO 控制台 \|_blank](https://console.zego.im) 注册项目时生成，可在 “控制台 > 项目配置 > 项目信息 > 配置信息” 中查看。

## 示例代码

以下示例代码用于生成和检验 signature。



<div class="multiple-select-codes">
    <div class="code-tabs hide-scrollbar">
      <div class="scroll-box">
        <span class="tab-item">
          <span>PHP</span>
        </span>
        <span class="tab-item">
          <span>Java</span>
        </span>
      </div>
    </div>

  <div class="code-list">
  
  ```PHP
  $signature = $_POST["signature"];
  $timestamp = $_POST["timestamp"];
  $nonce = $_POST["nonce"];

  $secret = callbacksecret;//后台获取的callbacksecret
  $tmpArr = array($secret, $timestamp, $nonce);
  sort($tmpArr, SORT_STRING);
  $tmpStr = implode( $tmpArr );
  $tmpStr = sha1( $tmpStr );

  if( $tmpStr == $signature ){
      return true;
  } else {
      return false;
  }
  ```
  
  ```Java
  // 从请求参数中获取到 signature, timestamp, nonce
  String signature = request.getParameter("signature");
  long timestamp = request.getParameter("timestamp");
  String nonce = request.getParameter("nonce");

  // 后台获取的callbacksecret
  String secret = callbacksecret;

  String[] tempArr = {secret, ""+timestamp, nonce};
  Arrays.sort(tempArr);
            
  String tmpStr = "";
  for (int i = 0; i < tempArr.length; i++) {
      tmpStr += tempArr[i];
  }
  tmpStr = org.apache.commons.codec.digest.DigestUtils.sha1Hex(tmpStr);

  return tmpStr.equals(signature);
  ```
  </div>
</div>

## 输出示例

```
$timestamp = 1470820198;
$nonce = 123412;
$secret = 'secret';
	
排序拼接后需要加密的原始串为:1234121470820198secret
加密的结果为:5bd59fd62953a8059fb7eaba95720f66d19e4517
```
