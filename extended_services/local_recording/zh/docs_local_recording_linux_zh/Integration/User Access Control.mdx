# 使用 Token 鉴权

---

## 功能简介

鉴权是指验证用户是否拥有访问系统的权限，来避免因权限控制缺失或操作不当引发的安全风险问题，ZEGO 通过 Token（包括基础鉴权 Token 和权限认证 Token） 对用户进行鉴权。

基础鉴权 Token 指的是开发者在登录房间前必须通过 [setCustomToken\|_blank](/API/ServerRecord-java/com/zego/zegoliveroom/ZegoLiveRoom.html#setCustomToken-java.lang.String-) 接口将 Token 传给 SDK，来验证用户的合法性。

权限认证 Token 指的是为了进一步提高安全性开放了房间 ID 权限位，可以验证登录房间的 ID。


## 前提条件

- 基础鉴权 Token 默认开通，权限认证 Token（即房间 ID 权限位）请联系 ZEGO 技术支持开通。
- 已在项目中集成 ZEGO 本地服务端录制 SDK，请参考 [快速开始 - 集成\|_blank](!QuickStarts/Integration)。

## 实现流程

使用 Token 鉴权时，需要开发者先生成 Token，ZEGO 服务端对带着 Token 的用户进行校验。

以使用 Token 判断用户是否能登录房间为例介绍使用流程，如下图：

![token_uml](/Pics/QuickStart/token_uml_liveroom.png)

1. 开发者客户端发起申请 Token 的请求。
2. 在开发者的服务端上生成 Token，并返回给开发者客户端。
3. 开发者客户端携带申请到的 Token 和 roomID 信息，通过 [setCustomToken\|_blank](/API/ServerRecord-java/com/zego/zegoliveroom/ZegoLiveRoom.html#setCustomToken-java.lang.String-) 接口传入 SDK。
4. ZEGO SDK 会自动将 Token 发送到 ZEGO 服务端进行校验。
5. ZEGO 服务端会将校验结果返回给 ZEGO SDK。
6. ZEGO SDK 再将校验的结果直接返回给开发者客户端，没有权限的客户端将登录失败。

## 使用步骤

本节将详细介绍开发者如何生成 Token 和如何使用 Token。

### 1 获取 AppID 和 ServerSecret

生成 Token 需要开发者项目的唯一标识 AppID 和密钥 ServerSecret，请参考 [控制台 - 项目管理\|_blank](12107) 中的 “项目信息”获取。


### 2 生成 Token

#### 2.1 服务端生成 Token（推荐）

开发者获得项目的 AppID 和 ServerSecret 信息后，根据实际业务需求，即可在自己的服务端生成 Token。开发者客户端向开发者服务端发送申请 Token 请求，由开发者服务端生成 Token 后返回给到对应客户端。

ZEGO 在 GitHub/Gitee 提供了一个开源的 zego_server_assistant 插件，支持使用 Go、C++、Java、Objective-C、Python、PHP、.NET、Node.js 语言，在开发者的服务端或客户端部署生成 Token。

zego_server_assistant 插件中提供了生成基础鉴权 Token 和生成权限认证 Token 的示例代码，两者的适用场景如下，开发者可按需选择：
- 基础鉴权 Token：用于业务的简单权限验证的场景，此时 “payload” 字段可传空。
- 权限认证 Token：为了进一步提高安全性，开放房间 ID 权限位，可以验证登录房间的 ID，此时 “payload” 字段需要按照规则生成，可参考下表的“权限认证 Token”示例代码。

@@@Server_generates_Token_2@@@

#### 2.2 客户端生成 Token（不推荐）

@@@Client_generates_Token@@@


### 3 设置 Token 

用户携带获取到的 Token 信息，在登录房间之前通过 [setCustomToken\|_blank](/API/ServerRecord-java/com/zego/zegoliveroom/ZegoLiveRoom.html#setCustomToken-java.lang.String-) 接口将 Token 传入给 SDK。

```java
public void setCustomToken(String thirdPartyToken); // 将 Token 替换为获取到的 Token 信息
```
