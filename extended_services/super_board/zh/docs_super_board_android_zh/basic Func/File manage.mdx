# 共享文件管理

- - -

@@@FileManagementOverview@@@

## 上传文件

@@@uploadFileClientDesc@@@

### 客户端 API

@@@FileClassification@@@
@@@FileSpecifications@@@

<div class="multipletabs-content">
    <!--tabs列表-->
    <div class="item-tabs">
        <div class="scroll-box">
          <span class="tab-item">
             上传普通文件
          </span>
          <span class="tab-item">
             上传 H5 文件
          </span>
        </div>
    </div>
<!--MarkDown内容要注意包裹在md-content标签内，且注意前面不能有空格，不然也会渲染异常-->
<div class="multipletabs-content-item ">
  <md-content>
调用 [uploadFile\|_blank](@uploadFile) 方法上传普通文件。

``` java
// filePath 待上传文件的绝对路径
String filePath = "";
ZegoSuperBoardRenderType renderType = ZegoSuperBoardRenderType.IMG;//例如转换成image格式
ZegoSuperBoardManager.getInstance().uploadFile(filePath, renderType, new IZegoSuperBoardUploadFileListener() {
    @Override
    public void onUpload(ZegoSuperBoardUploadFileState state, int errorCode, @NonNull HashMap<String, Object> infoMap) {
        if (errorCode == ZegoSuperBoardError.ZegoSuperBoardSuccess) {
            if (state == ZegoSuperBoardUploadFileState.Upload) {
                // 上传中...
                float uploadPercent = (float) infoMap.get("upload_percent");
                if (uploadPercent == 1f){
                /** 正在转码... */
                }
            } else if (state == ZegoSuperBoardUploadFileState.Convert){
                /** 转换成功 */
                String fileID = (String) infoMap.get(ZegoSuperBoardError.UPLOAD_FILEID);
            }
        } else {
        /** 上传失败 */
        }
    }
});
```
  </md-content>
</div>
<!--嵌套其它html模板示例-->
<div class="multipletabs-content-item ">
  <md-content>
通过 [ZegoUploadCustomH5Config\|_blank](@-ZegoUploadCustomH5Config) 设置上传 H5 文件的配置参数，并调用 [uploadH5File\|_blank](@uploadH5File) 方法上传 H5 文件。

``` java

String filePath = "";

ZegoUploadCustomH5Config mH5Config = new ZegoUploadCustomH5Config();
mH5Config.height = 960;
mH5Config.width = 540;
mH5Config.pageCount = 5;

ZegoSuperBoardManager.getInstance().uploadH5File(filePath, mH5Config, new IZegoSuperBoardUploadFileListener() {
    @Override
    public void onUpload(ZegoSuperBoardUploadFileState state, int errorCode, @NonNull HashMap<String, Object> infoMap) {
        if (errorCode == ZegoSuperBoardError.ZegoSuperBoardSuccess) {
            if (state == ZegoSuperBoardUploadFileState.Upload) {
                // 上传中...
                float uploadPercent = (float) infoMap.get("upload_percent");
                if (uploadPercent == 1f){
                    /** 正在转码... */
                }
            } else if (state == ZegoSuperBoardUploadFileState.Convert){
                /** 转换成功 */
                String fileID = (String) infoMap.get(ZegoSuperBoardError.UPLOAD_FILEID);
            }
        } else {
            /** 上传失败 */
        }
    }
});
```
  </md-content>
</div>
</div>


调用客户端 API 接口上传文件的过程包含上传（ZegoSuperBoardUploadFileState.Upload）和格式转换（ZegoSuperBoardUploadFileState.Convert）两个阶段。

- 上传阶段：如果正常上传，会产生多次回调，每次都包含文件上传进度。例如当前上传 50%，则 "infoMap" 内容为 `{"upload_percent":0.50}`；当前上传 100%，则 "infoMap" 内容为 `{"upload_percent":1.00}`。
- 格式转换阶段：如果转换成功，只产生一次回调，包含转换后的文件 ID。例如当前转换完成，则 "infoMap" 内容为 `{"upload_fileid":"ekxxxxxxxxv"}`。

### 服务端 API

@@@TrsancodeServerAPI@@@

## 缓存文件

当用户上传文件并获取文件的 fileID 之后，如需提高文件加载速度，可以在调用 [ZegoSuperBoardManager\|_blank](@-ZegoSuperBoardManager) 的 [createFileView\|_blank](@createFileView) 接口创建文件白板之前，提前缓存该文件。

### 缓存文件

调用 [cacheFile\|_blank](@cacheFile) 方法将文件缓存到本地。
``` java
int seq = ZegoSuperBoardManager.getInstance().cacheFile(fileID, new IZegoSuperBoardCacheFileListener() {
    @Override
    public void onCache(ZegoSuperBoardCacheFileState state, int errorCode, @NonNull HashMap<String, Object> infoMap) {
        if (errorCode == ZegoSuperBoardError.ZegoSuperBoardSuccess) {
            if (state == ZegoSuperBoardCacheFileState.Caching) {
                float cachePercent = (float) infoMap.get("cache_percent") * (float) 100;
                // 缓存中...
            } else if (state == ZegoSuperBoardCacheFileState.Cached) {
            // 缓存成功
            }
        } else {
        // 缓存失败
        }
    }
});
```

### 取消缓存文件

调用 [cancelCacheFile\|_blank](@cancelCacheFile) 方法取消掉正在缓存的文件。

``` java
// 保存从调用 cacheFile() 接口返回的 seq值
// 在取消缓存参数中用到
ZegoSuperBoardManager.getInstance().cancelCacheFile(seq, new IZegoSuperBoardApiCalledCallback() {
    @Override
    public void onApiCalledResult(int errorCode) {
        // errorCode等于0，取消缓存成功
    }
});
```

### 查询文件是否已经有缓存

调用 [queryFileCached\|_blank](@queryFileCached) 方法查询文件缓存是否存在。

``` java
// 通过 fileID 查询指定文件是否已缓存
ZegoSuperBoardManager.getInstance().queryFileCached(fileID, new IZegoSuperBoardQueryFileCachedListener() {
    @Override
    public void onQueryCached(int errorCode, boolean fileCached) {
        // fileCached 是否已有缓存
    }
});
```
