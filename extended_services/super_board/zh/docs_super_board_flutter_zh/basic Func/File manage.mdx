# 共享文件管理

- - -

@@@FileManagementOverview@@@

## 上传文件

@@@uploadFileClientDesc@@@

### 客户端 API

@@@FileClassification@@@

@@@FileSpecifications@@@

<div class="multipletabs-content">
    <!--tabs列表-->
    <div class="item-tabs">
        <div class="scroll-box">
          <span class="tab-item">
             上传普通文件
          </span>
          <span class="tab-item">
             上传 H5 文件
          </span>
        </div>
    </div>
<div class="multipletabs-content-item ">
  <md-content>
调用 [uploadFile\|_blank](https://pub.dev/documentation/zego_superboard/latest/zego_superboard/ZegoSuperBoardManager/uploadFile.html) 方法上传普通文件。

```dart
// 上传文件回调 
ZegoSuperBoardEventHandler.uploadFile = ((info) async { 
    // 上传中... 
    if (info['state'] == ZegoSuperBoardUploadFileState.upload.value) { 

    } else if (info['state'] == ZegoSuperBoardUploadFileState.convert.value) { 
        /** 转换成功 */ 
    } 
}); 

// 上传文件 
File file = File(pickerResult.files.single.path!); 
var map = await ZegoSuperBoardManager.instance.uploadFile(filePath: file.path, renderType: ZegoSuperBoardRenderType.VectorAndIMG); 
uploadSeq = map!['seq']; 
if (kDebugMode) { 
    print('[Flutter][uploadFile]:$map'); 
} 
```
  </md-content>
</div>
<div class="multipletabs-content-item ">
  <md-content>
通过 [ZegoUploadCustomH5Config\|_blank](https://pub.dev/documentation/zego_superboard/latest/zego_superboard_defines/ZegoUploadCustomH5Config-class.html) 设置上传 H5 文件的配置参数，并调用 [uploadH5File\|_blank](https://pub.dev/documentation/zego_superboard/latest/zego_superboard/ZegoSuperBoardManager/uploadH5File.html) 方法上传 H5 文件。

```dart
// 上传 H5 文件回调 
ZegoSuperBoardEventHandler.uploadH5File = ((info) async { 
    // 上传中... 
    if (info['state'] == ZegoSuperBoardUploadFileState.upload.value) { 

    } else if (info['state'] == ZegoSuperBoardUploadFileState.convert.value) { 
        /** 转换成功 */ 
    } 
}); 

// 上传 H5 文件 
File file = File(pickerResult.files.single.path!); 
ZegoUploadCustomH5Config config = ZegoUploadCustomH5Config(960, 540, 2, ['thumbnails/1.jpg', 'thumbnails/2.jpg']); 
var map = await ZegoSuperBoardManager.instance.uploadH5File(filePath: file.path, config: config); 
uploadSeq = map!['seq']; 
if (kDebugMode) { 
    print('[Flutter][uploadFile]:$map'); 
} 
```
  </md-content>
</div>
</div>

调用客户端 API 接口上传文件的过程包含分为上传阶段和格式转换阶段，详情请查看 [ZegoSuperBoardUploadFileState](https://pub.dev/documentation/zego_superboard/latest/zego_superboard_defines/ZegoSuperBoardUploadFileState.html)。

- 上传阶段：如果正常上传，会产生多次回调，每次都包含文件上传进度。例如当前上传 50%，则 "infoMap" 内容为 `{"upload_percent":0.50}`；当前上传 100%，则 "infoMap" 内容为 `{"upload_percent":1.00}`。
- 格式转换阶段：如果转换成功，只产生一次回调，包含转换后的文件 ID。例如当前转换完成，则 "infoMap" 内容为 `{"upload_fileid":"ekxxxxxxxxv"}`。

### 服务端 API

@@@TrsancodeServerAPI@@@

## 缓存文件

当用户上传文件并获取文件的 fileID 之后，如需提高文件加载速度，可以在调用 [ZegoSuperBoardManager\|_blank](https://pub.dev/documentation/zego_superboard/latest/zego_superboard/ZegoSuperBoardManager-class.html) 的 [createFileView\|_blank](https://pub.dev/documentation/zego_superboard/latest/zego_superboard/ZegoSuperBoardManager/createFileView.html) 接口创建文件白板之前，提前缓存该文件。

### 缓存文件

调用 [cacheFile\|_blank](https://pub.dev/documentation/zego_superboard/latest/zego_superboard/ZegoSuperBoardManager/cacheFile.html) 方法将文件缓存到本地。

``` objc
// 缓存文件回调 
ZegoSuperBoardEventHandler.cacheFile = ((info) { 
    if (kDebugMode) { 
        print('[Flutter][cacheFile] info:$info'); 
    } 
    if (info['state'] == ZegoSuperBoardCacheFileState.caching.value) {
    
    } 
}); 

// 缓存文件 
var map = await ZegoSuperBoardManager.instance.cacheFile(fileID: currentfileID); 
if (kDebugMode) { 
    print('[Flutter][cacheFileWithFile]:$map'); 
} 
```

### 取消缓存文件

调用 [cancelCacheFile\|_blank](https://pub.dev/documentation/zego_superboard/latest/zego_superboard/ZegoSuperBoardManager/cancelCacheFile.html) 方法取消掉正在缓存的文件。

```dart
// cacheSeq 为 cacheFile 返回的seq值。
var map = await ZegoSuperBoardManager.instance.cancelCacheFile(seq: cacheSeq);
if (kDebugMode) {
    print('[Flutter][cancelCacheFile]:$map');
}
```

### 查询文件是否已经有缓存

调用 [queryFileCached\|_blank](https://pub.dev/documentation/zego_superboard/latest/zego_superboard/ZegoSuperBoardManager/queryFileCached.html) 方法查询文件缓存是否存在。

```dart
// 通过 fileID 查询指定文件是否已缓存
var map = await ZegoSuperBoardManager.instance.queryFileCached(fileID: currentfileID);
if (kDebugMode) {
   print('[Flutter][queryFileCached]:$map');
}
```
