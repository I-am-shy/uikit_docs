# 查询文件转码状态

- - -

## 1 描述

通过本接口查询文件转码任务状态。

调用频率限制：

- 正式环境：10 次/秒
- 测试环境：10 次/秒

## 2 接口原型

- 请求方法：POST
- 请求地址：https://docservice-api.zego.im/?Action=DescribeTranscodeStatus
- 传输协议：HTTPS

## 3 请求参数

以下请求参数列表仅列出了接口请求参数，公共参数列表请参考 [调用方式 - 公共请求参数\|_blank](11349#2_1)。

<table>
  
  <tbody><tr>
    <th>参数</th>
    <th>类型</th>
    <th>是否必选</th>
    <th>描述</th>
  </tr>
  <tr>
    <td>app_id</td>
    <td>Int64</td>
    <td>是</td>
    <td>ZEGO 给开发者分配的 AppID，唯一标识一个应用。</td>
  </tr> 
  <tr>
    <td>platform</td>
    <td>Number</td>
    <td>是</td>
    <td>平台类型，固定填 64。</td>
  </tr>
  <tr>
    <td>task_id</td>
    <td>String</td>
    <td>是</td>
    <td>文件转码任务 ID。</td>
  </tr>
</tbody></table>

## 4 请求示例

以下请求参数示例仅列出了接口请求参数，公共参数列表请参考 [调用方式 - 公共请求参数\|_blank](11349#2_1)。
```json
{
    "app_id": 123456789,
    "platform": 64,
    "task_id": "task"
}
```

## 5 响应参数

<table>
  
  <tbody><tr>
    <th>参数</th>
    <th>类型</th>
    <th>描述</th>
  </tr>
  <tr>
    <td>ret</td>
    <td>Object</td>
    <td>响应对象。</td>
  </tr>
  <tr>
    <td>└ code</td>
    <td>Number</td>
    <td>错误码</td>
  </tr>
  <tr>
    <td>└ message</td>
    <td>String</td>
    <td>错误描述</td>
  </tr>
  <tr>
    <td>file_hash</td>
    <td>String</td>
    <td>源文件哈希。</td>
  </tr>
  <tr>
    <td>file_type</td>
    <td>Number</td>
    <td>源文件类型参数，可设置为 1、2、4、8、16、32，各参数值说明如下：<ul><li>1：ppt/pptx（静态文件，目标文件类型对应 256；动态文件，目标文件类型对应 512）</li><li>2：doc/docx（目标文件类型对应 256）</li><li>4：xls/xlsx（目标文件类型对应 256）</li><li>8：PDF（目标文件类型对应 256）</li><li>16：jpg/jpeg/png/bmp（目标文件类型对应 16）</li><li>32：txt（目标文件类型对应 256）</li></ul> </td>
  </tr>
  <tr>
    <td>expect_file_type</td>
    <td>Number</td>
    <td>目标文件类型参数，可设置为 16、256、512，各参数值说明如下：<ul><li>16：jpg/jpeg/png/bmp</li><li>256：向量和图片</li><li>512：动态 PPT</li></ul>  </td>
  </tr>
  <tr>
    <td>status</td>
    <td>Number</td>
    <td>文件转码状态，详情请参考下文中 <a href="#status">status</a> 字段说明表。</td>
  </tr>
  <tr>
    <td>file_id</td>
    <td>String</td>
    <td>转码成功后返回的文件 ID。</td>
</tbody></table>

<p id="status">“status” 字段取值说明如下：</p>

|状态码|描述|
|-----|----|
|1|未上传。|
|2|已上传。|
|4|排队中。|
|8|转码中。|
|16|转码成功。|
|32|转码失败。|
|64|转码任务已取消。|
|128|受密码保护的文档。|
|256|文件内容过大。|
|512|Excel 文件标签数过多。|
|1024|文件内容为空。例如：PPT 内无幻灯片。|
|2048|转码服务器打开文件失败。|
|4096|不支持的目标文件类型。|
|8192|源文件为只读文件。|
|16384|<p>转码服务器下载源文件失败。 可能的原因如下：</p><ul><li>无法从请求参数中的源文件 URL 下载文件。</li><li>请求参数中的文件哈希值不是 32 位的 MD5 哈希值。</li><li>请求参数中的文件哈希值和根据文件计算的哈希值不匹配。</li></ul> |
|32768|检测到源文件中包含了转码工具无法处理的元素，如墨迹涂鸦等，请去掉这些元素后再进行转码。|
|32769|检测到 Word、Excel 和 PowerPoint 文件格式不合法，请确保源文件可以使用 Office 打开再进行转码。|

## 6 响应示例

```json
{
    "ret": {
        "code": 0,
        "message": "success"
    },
    "file_hash": "abc",
    "file_type": 1,
    "expect_file_type": 256,
    "status": 8,
    "file_id": "fsid"
}
```

## 7 返回码

以下仅列出了接口业务相关的返回码，公共返回码请参考 [公共返回码\|_blank](#11825)。
<table>
  
  <tbody><tr>
    <th>返回码</th>
    <th>说明</th>
  </tr>
  <tr>
    <td>60013</td>
    <td>文件已经完成转码。</td>
  </tr>
  <tr>
    <td>60014</td>
    <td>不存在的文件转码任务 ID。</td>
  </tr>
  <tr>
    <td>60015</td>
    <td>不支持的源文件类型。</td>
  </tr>
</tbody></table>
