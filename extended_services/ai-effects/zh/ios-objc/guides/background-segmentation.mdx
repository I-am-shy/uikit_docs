---
articleID: 10187
---

# 背景分割

- - -

## 1 功能简介

ZegoEffects SDK 提供背景分割功能，适用于在线教育、视频会议、美发、短视频等多种场景。

## 2 前提条件

在使用 ZegoEffects SDK 背景分割功能前，请确保：

- 已在项目中集成 ZegoEffects SDK，实现基本的图像处理功能，详情请参考 [快速开始 - 集成 SDK](!Quick_Starts/Integration)。
- 导入 “SegmentationModel” 模型路径，详情请参考 [快速开始 - 导入资源和模型](!Quick_Starts/Import_Resources#2)。



## 3 使用步骤

背景分割包括人像分割、绿幕分割，以及背景虚化、背景马赛克等功能。

### 3.1 人像分割

<Warning title="Warning">

使用人像分割功能前，请先导入对应的 “SegmentationModel” 模型文件，否则功能无法生效。详情请参考 [快速开始 - 导入资源和模型](!Quick_Starts/Import_Resources)。
</Warning>

1. 调用 [setPortraitSegmentationBackgroundPath](@setPortraitSegmentationBackgroundPath) 或 [setPortraitSegmentationBackgroundBuffer](@setPortraitSegmentationBackgroundBuffer) 接口，设置人像分割使用的背景路径或背景 Buffer（二选一）。

    ```objc
    // 设置人像分割使用的背景路径（和设置 Buffer 的方式二选一即可）
    [self.effects setPortraitSegmentationBackgroundPath: @"MY_BACKGROUND_PATH" mode:ZegoEffectsScaleModeAspectFill];

    // 设置人像分割使用的背景 Buffer（和设置路径的方式二选一即可）
    [self.effects setPortraitSegmentationBackgroundBuffer:pixelbuffer mode:ZegoEffectsScaleModeAspectFill];
    ```

2. 调用 [enablePortraitSegmentation](@enablePortraitSegmentation) 接口开启人像分割功能。

    ```objc
    // 开启人像分割功能
    [self.effects enablePortraitSegmentation:YES];
    ```


<p>开启人像分割功能后，开发者可以根据需要进一步设置背景虚化、背景马赛克等功能。</p>

#### 人像分割背景虚化

调用 [enablePortraitSegmentationBackgroundBlur](@enablePortraitSegmentationBackgroundBlur) 接口开启人像分割背景虚化功能，打开虚化功能后可调用 [setPortraitSegmentationBackgroundBlurParam](@setPortraitSegmentationBackgroundBlurParam) 接口设置 [ZegoEffectsBlurParam](@-ZegoEffectsBlurParam) 对象的 “intensity” 参数，调整背景虚化的程度。

<div class = 'mk-warning'>

开启人像分割背景虚化功能后，会覆盖自定义背景及背景马赛克功能。
</div>
   
```objc
// 开启人像分割背景虚化
[self.effects enablePortraitSegmentationBackgroundBlur:YES];

// 设置人像分割背景虚化参数
ZegoEffectsBlurParam *param = [[ZegoEffectsBlurParam alloc] init];
param.intensity = 100;
[self.effects setPortraitSegmentationBackgroundBlurParam:param];
```

#### 人像分割背景马赛克

调用 [enablePortraitSegmentationBackgroundMosaic](@enablePortraitSegmentationBackgroundMosaic) 接口开启人像分割背景马赛克功能，打开马赛克功能后可调用 [setPortraitSegmentationBackgroundMosaicParam](@setPortraitSegmentationBackgroundMosaicParam) 接口设置 [ZegoEffectsMosaicParam](@-ZegoEffectsMosaicParam) 对象的 “intensity” 参数参数，调整马赛克的程度。

<div class = 'mk-warning'>

开启人像分割背景马赛克功能后，会覆盖自定义背景及背景虚化功能。
</div>  

```objc
// 开启人像分割背景马赛克
[self.effects enablePortraitSegmentationBackgroundMosaic:YES];
  
// 设置人像分割背景马赛克参数
ZegoEffectsMosaicParam *param = [[ZegoEffectsMosaicParam alloc] init];
param.intensity = 100;
[self.effects setPortraitSegmentationBackgroundMosaicParam:param];
```
    


### 3.2 绿幕分割

1. 调用 [setChromaKeyBackgroundPath](@setChromaKeyBackgroundPath) 或 [setChromaKeyBackgroundBuffer](@setChromaKeyBackgroundBuffer) 接口，设置绿幕分割使用的背景路径或背景 Buffer（二选一）。

    ```objc
    // 设置绿幕分割使用的背景路径（和设置 Buffer 的方式二选一即可）
    [self.effects setChromaKeyBackgroundPath: @"MY_BACKGROUND_PATH" mode:ZegoEffectsScaleModeAspectFill];

    // 设置绿幕分割使用的背景 Buffer（和设置路径的方式二选一即可）
    [self.effects setChromaKeyBackgroundBuffer:pixelbuffer mode:ZegoEffectsScaleModeAspectFill];
    ```

2. 调用 [enableChromaKey](@enableChromaKey) 接口开启绿幕分割功能，然后调用 [setChromaKeyParam](@setChromaKeyParam) 接口设置参数，调整颜色容差、边缘平滑指数等。

    ```objc
    // 开启功能
    [self.effects enableChromaKey:YES]

    // 设置绿幕参数
    ZegoEffectsChromaKeyParam *param = [[ZegoEffectsChromaKeyParam alloc] init];
    [self.effects setChromaKeyParam:param];
    ```


<p>开启绿幕分割功能后，开发者可以根据需要进一步设置背景虚化、背景马赛克等功能。</p>

#### 绿幕分割背景虚化

调用 [enableChromaKeyBackgroundBlur](@enableChromaKeyBackgroundBlur) 接口开启绿幕背景虚化功能，打开虚化功能后可调用 [setChromaKeyBackgroundBlurParam](@setChromaKeyBackgroundBlurParam) 接口设置 [ZegoEffectsBlurParam](@-ZegoEffectsBlurParam) 对下的 “intensity” 参数，调整虚化的程度。

<div class = 'mk-warning'>

开启绿幕分割背景虚化功能后，会覆盖自定义背景及背景马赛克功能。
</div>
   
```objc
// 开启绿幕分割背景虚化
[self.effects enableChromaKeyBackgroundBlur:YES];
    
// 设置绿幕分割背景虚化参数
ZegoEffectsBlurParam *param = [[ZegoEffectsBlurParam alloc] init];
param.intensity = 100;
[self.effects setChromaKeyBackgroundBlurParam:param];
```

#### 绿幕分割背景马赛克

调用 [enableChromaKeyBackgroundMosaic](@enableChromaKeyBackgroundMosaic) 接口开启绿幕背景马赛克功能，打开马赛克功能后可调用 [setChromaKeyBackgroundMosaicParam](@setChromaKeyBackgroundMosaicParam) 接口设置 [ZegoEffectsMosaicParam](@-ZegoEffectsMosaicParam) 对象的 “intensity” 参数，调整马赛克的程度。


<div class = 'mk-warning'>

开启绿幕分割背景马赛克功能后，会覆盖自定义背景及背景虚化功能。
</div>
   
```objc
// 开启绿幕分割背景马赛克
[self.effects enableChromaKeyBackgroundMosaic:YES];
// 设置绿幕分割背景马赛克参数
ZegoEffectsMosaicParam *param = [[ZegoEffectsMosaicParam alloc] init];
param.intensity = 100;
[self.effects setChromaKeyBackgroundMosaicParam:param];
```
