# 背景分割

- - -

## 功能简介

ZegoEffects SDK 提供背景分割功能，适用于在线教育、视频会议、美发、短视频等多种场景。

## 前提条件

在使用 ZegoEffects SDK 美颜功能前，请确保：

- 已在项目中集成 ZegoEffects SDK，实现基本的图像处理功能，详情请参考 [快速开始 - 实现图像处理](!Quick_Starts/Solution_Implementation)。
- 导入人像分割模型 “SegmentationModel” 文件，详情请参考 [快速开始 - 导入资源和模型](!Quick_Starts/Import_Resources)。

## 使用步骤

背景分割包括人像分割、绿幕分割，以及背景虚化、背景马赛克等功能。

### 人像分割

<Warning title="Warning">

使用人像分割功能前，请先导入对应的 “SegmentationModel” 模型文件，否则功能无法生效。详情请参考 [快速开始 - 导入资源和模型](!Quick_Starts/Import_Resources)。
</Warning>

1. 调用 [setPortraitSegmentationBackgroundPath](https://doc-zh.zego.im/unique-api/ai-effects-sdk/zh/dart_flutter/zego_effects_plugin/ZegoEffectsPlugin/setPortraitSegmentationBackgroundPath.html) 方法，设置人像分割使用的背景路径。

    ```java
    // 设置人像分割使用的背景路径
    ZegoEffectsPlugin.instance.setPortraitSegmentationBackgroundPath('MY_BACKGROUND_PATH', ZegoEffectsScaleMode.AspectFill);
    ```

2. 调用 [enablePortraitSegmentation](https://doc-zh.zego.im/unique-api/ai-effects-sdk/zh/dart_flutter/zego_effects_plugin/ZegoEffectsPlugin/enablePortraitSegmentation.html) 方法开启人像分割功能。

    ```java
    // 开启人像分割功能
    ZegoEffectsPlugin.instance.enablePortraitSegmentation(true);
    ```

<p>开启人像分割功能后，开发者可以根据需要进一步设置背景虚化、背景马赛克等功能。</p>

#### 人像分割背景虚化

调用 [enablePortraitSegmentationBackgroundBlur](https://doc-zh.zego.im/unique-api/ai-effects-sdk/zh/dart_flutter/zego_effects_plugin/ZegoEffectsPlugin/enablePortraitSegmentationBackgroundBlur.html) 方法开启人像分割背景虚化功能，打开虚化功能后可调用 [setPortraitSegmentationBackgroundBlurParam](https://doc-zh.zego.im/unique-api/ai-effects-sdk/zh/dart_flutter/zego_effects_plugin/ZegoEffectsPlugin/setPortraitSegmentationBackgroundBlurParam.html) 方法设置 [ZegoEffectsBlurParam](https://doc-zh.zego.im/unique-api/ai-effects-sdk/zh/dart_flutter/zego_effects_defines/ZegoEffectsBlurParam-class.html) 对象的 “intensity” 参数，调整背景虚化的程度。

<div class = 'mk-warning'>

开启人像分割背景虚化功能后，会覆盖自定义背景及背景马赛克功能。
</div>

   
```java
// 开启人像分割背景虚化
ZegoEffectsPlugin.instance.enablePortraitSegmentationBackgroundBlur(true);

// 设置人像分割背景虚化参数
ZegoEffectsBlurParam param = ZegoEffectsBlurParam();
param.intensity = 100;
ZegoEffectsPlugin.instance.setPortraitSegmentationBackgroundBlurParam(param);
```

#### 人像分割背景马赛克

调用 [enablePortraitSegmentationBackgroundMosaic](https://doc-zh.zego.im/unique-api/ai-effects-sdk/zh/dart_flutter/zego_effects_plugin/ZegoEffectsPlugin/enablePortraitSegmentationBackgroundMosaic.html) 方法开启人像分割背景马赛克功能，打开马赛克功能后可调用 [setPortraitSegmentationBackgroundMosaicParam](https://doc-zh.zego.im/unique-api/ai-effects-sdk/zh/dart_flutter/zego_effects_plugin/ZegoEffectsPlugin/setPortraitSegmentationBackgroundMosaicParam.html) 方法设置 [ZegoEffectsMosaicParam](https://doc-zh.zego.im/unique-api/ai-effects-sdk/zh/dart_flutter/zego_effects_defines/ZegoEffectsMosaicParam-class.html) 对象的 “intensity” 参数参数，调整马赛克的程度。

<div class = 'mk-warning'>

开启人像分割背景马赛克功能后，会覆盖自定义背景及背景虚化功能。
</div> 

   
```java
// 开启人像分割背景马赛克
ZegoEffectsPlugin.instance.enablePortraitSegmentationBackgroundMosaic(true);

// 设置人像分割背景马赛克参数
ZegoEffectsMosaicParam param = ZegoEffectsMosaicParam();
param.intesity = 100;
ZegoEffectsPlugin.instance.setPortraitSegmentationBackgroundMosaicParam(param);
```
    

### 绿幕分割


1. 调用 [setChromaKeyBackgroundPath](https://doc-zh.zego.im/unique-api/ai-effects-sdk/zh/dart_flutter/zego_effects_plugin/ZegoEffectsPlugin/setChromaKeyBackgroundPath.html) 方法，设置绿幕分割使用自定义背景路径。

    ```java
    // 设置绿幕分割使用的背景路径
    ZegoEffectsPlugin.instance.setChromaKeyBackgroundPath("MY_BACKGROUND_PATH", ZegoEffectsScaleMode.AspectFill);
    ```

2. 调用 [enableChromaKey](https://doc-zh.zego.im/unique-api/ai-effects-sdk/zh/dart_flutter/zego_effects_plugin/ZegoEffectsPlugin/enableChromaKey.html) 方法开启绿幕分割功能，然后调用 [setChromaKeyParam](https://doc-zh.zego.im/unique-api/ai-effects-sdk/zh/dart_flutter/zego_effects_plugin/ZegoEffectsPlugin/setChromaKeyParam.html) 方法设置参数，调整颜色容差、边缘平滑指数等。

    ```java
    // 开启绿幕分割功能
    ZegoEffectsPlugin.instance.enableChromaKey(true);

    // 设置绿幕分割参数
    ZegoEffectsChromaKeyParam param = ZegoEffectsChromaKeyParam();
    param.smoothness = 80;
    param.opacity = 100;
    param.keyColor = 65280;
    param.similarity = 67;
    ZegoEffectsPlugin.instance.setChromaKeyParam(param);
    ```


<p>开启绿幕分割功能后，开发者可以根据需要进一步设置背景虚化、背景马赛克等功能。</p>

#### 绿幕分割背景虚化

调用 [enableChromaKeyBackgroundBlur](https://doc-zh.zego.im/unique-api/ai-effects-sdk/zh/dart_flutter/zego_effects_plugin/ZegoEffectsPlugin/enableChromaKeyBackgroundBlur.html) 方法开启绿幕背景虚化功能，打开虚化功能后可调用 [setChromaKeyBackgroundBlurParam](https://doc-zh.zego.im/unique-api/ai-effects-sdk/zh/dart_flutter/zego_effects_plugin/ZegoEffectsPlugin/setChromaKeyBackgroundBlurParam.html) 方法设置 [ZegoEffectsBlurParam](https://doc-zh.zego.im/unique-api/ai-effects-sdk/zh/dart_flutter/zego_effects_defines/ZegoEffectsBlurParam-class.html) 对下的 “intensity” 参数，调整虚化的程度。

<Warning title="Warning">
开启绿幕分割背景虚化功能后，会覆盖自定义背景及背景马赛克功能。
</Warning>

```java
// 开启绿幕分割背景虚化
ZegoEffectsPlugin.instance.enableChromaKeyBackgroundBlur(true);

// 设置绿幕分割背景虚化参数
ZegoEffectsBlurParam param = ZegoEffectsBlurParam();
param.intensity = 100;
ZegoEffectsPlugin.instance.setChromaKeyBackgroundBlurParam(param);
```

#### 绿幕分割背景马赛克

调用 [enableChromaKeyBackgroundMosaic](https://doc-zh.zego.im/unique-api/ai-effects-sdk/zh/dart_flutter/zego_effects_plugin/ZegoEffectsPlugin/enableChromaKeyBackgroundMosaic.html) 方法开启绿幕背景马赛克功能，打开马赛克功能后可调用 [setChromaKeyBackgroundMosaicParam](https://doc-zh.zego.im/unique-api/ai-effects-sdk/zh/dart_flutter/zego_effects_plugin/ZegoEffectsPlugin/setChromaKeyBackgroundMosaicParam.html) 方法设置 [ZegoEffectsMosaicParam](https://doc-zh.zego.im/unique-api/ai-effects-sdk/zh/dart_flutter/zego_effects_defines/ZegoEffectsMosaicParam-class.html) 对象的 “intensity” 参数，调整马赛克的程度。


<Warning title="Warning">
开启绿幕分割背景马赛克功能后，会覆盖自定义背景及背景虚化功能。
</Warning>
   
```java
// 开启绿幕分割背景马赛克
ZegoEffectsPlugin.instance.enableChromaKeyBackgroundMosaic(true);

// 设置绿幕分割背景马赛克参数
ZegoEffectsBlurParam param = ZegoEffectsBlurParam();
param.intensity = 100;
ZegoEffectsPlugin.instance.setChromaKeyBackgroundMosaicParam(param);
```
