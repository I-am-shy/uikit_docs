
import Content from '/snippets/Reuse/SigningTheRequestEN.mdx'

# Accessing Server APIs
---

## Usage Instructions

ZEGOCLOUD Analytics Dashboard Server API supports HTTPS network request protocol, allowing GET or POST methods. You can write code based on the API documentation to access the corresponding API.

## Request Method

The Server API request is composed of different content, with a fixed request structure:

- [Access Address](#access-address)：The access address of the ZEGOCLOUD Analytics Dashboard Server, which is different for different products and regions.
- [Public Parameters](#public-parameters)：Each request must have a series of public parameters.
- [Signature](#signing-the-requests)：The signature is also a public parameter, which needs to be generated according to the corresponding signature algorithm.
- Request Parameters：You need to specify the target operation through the Action parameter, such as Action = GetBizUsage; you also need to specify other parameters of the interface.

After we verify your signature, we will return the result to you. The interface call will display the return parameters, and the call will display the corresponding error message if it fails. You can analyze and troubleshoot according to [global return codes](./Return%20codes.mdx).

<Accordion title="Server API Request Example" defaultOpen="false">
The following is an example of the request structure for the [`GetBizUsage`](./Operation%20data/Get%20biz%20usage.mdx) (query business scale) interface:

```bash
https://analytics-api.zego.im/?Action=GetBizUsage
&AppId=1234567890
&SignatureNonce=15215528852396
&Timestamp=1234567890
&Signature=7a2c0f11145fb760d607a07b54825013
&SignatureVersion=2.0
&IsTest=false
&StartDate=20230912
&EndDate=20231012
&Metrics[]=publish_count
&Metrics[]=play_count
```

其中：
- `https`：specifies the request communication protocol.
- `analytics-api.zego.im`：specifies the access address of the ZEGOCLOUD Analytics Dashboard Server.
- `Action=GetBizUsage`：specifies the API to be called.
- Public Request Parameters：These are the request parameters that are required for each interface, including AppId、SignatureNonce、Timestamp、Signature、SignatureVersion and IsTest. For details, please refer to [Public Request Parameters](#public request parameters).
- Business Parameters：Different Action requires developers to pass in different business parameters. The StartDate、EndDate and Metrics in the above example are business parameters. For details, please refer to the API documentation of each interface.

In addition, ZEGOCLOUD provides example code in multiple programming languages for developers to refer to according to actual circumstances. The following is the Node.js code for the [`GetBizUsage`](./Operation%20data/Get%20biz%20usage.mdx) interface:

```js
const crypto = require('crypto');
const request = require('request');

//Please modify the appId to your AppId, AppId is a number
var appId = 1234567890;
//Please modify the serverSecret to your serverSecret, serverSecret is a string
//Example："1234567890bbc111111da999ef05f0ee"
var serverSecret = ;

//Generate a signature
//Signature=md5(AppId + SignatureNonce + ServerSecret + Timestamp)
function GenerateUASignature(appId, signatureNonce, serverSecret, timeStamp){
    const hash = crypto.createHash('md5'); //Specifies the use of the MD5 algorithm in hash functions
    var str = appId + signatureNonce + serverSecret + timeStamp;
    hash.update(str);
    //hash.digest('hex') indicates that the output format is hexadecimal
    return hash.digest('hex');
}

var signatureNonce = crypto.randomBytes(8).toString('hex');
var timeStamp = Math.round(Date.now()/1000);
// Generate a signature
// The Timestamp used for generating the signature must be consistent with the Timestamp in the URL parameters, and the SignatureNonce used for generating the signature must be consistent with the SignatureNonce in the URL parameters
var sig = GenerateUASignature(appId, signatureNonce, serverSecret, timeStamp)
// analytics-api.zego.im represents the product used is Analytics Dashboard
//The following example can get the number of users in the room with RoomID room1
var url = `https://analytics-api.zego.im/?Action=GetBizUsage&StartDate=20250110&EndDate=20250112&Metrics[]=publish_count&Metrics[]=play_count&AppId=${appId}&SignatureNonce=${signatureNonce}&Timestamp=${timeStamp}&Signature=${sig}&SignatureVersion=2.0&IsTest=false`;

request(url, function(error, response, body){
    console.log('Url: ',url)
    console.log('StatusCode: ',response.statusCode)
    console.log('Error: ', error)
    if(!error && response.statusCode){
        console.log(body)
    }
})
```
</Accordion>

## Request Structure

### Access Address

Developers need to specify the corresponding access address based on the geographical region of their server when sending requests to the ZEGOCLOUD Analytics Dashboard Server.

<Warning title="Warning">To ensure the quality of your business service access, please prioritize using the domain name of the geographical region where your server is located as the access address when sending requests to the ZEGOCLOUD Analytics Dashboard Server.  </Warning>

ZEGOCLOUD Analytics Dashboard Server supports request access from the following geographical regions:

<table>
<tbody><tr>
<th>Geographical Region</th>
<th>Access Address</th>
</tr>
<tr>
<td>Chinese Mainland (Shanghai)</td>
<td>analytics-api-sha.zego.im</td>
</tr>
<tr>
<td>Hong Kong, Macau and Taiwan (Hong Kong)</td>
<td>analytics-api-hkg.zego.im</td>
</tr>
<tr>
<td>Europe (Frankfurt)</td>
<td>analytics-api-fra.zego.im</td>
</tr>
<tr>
<td>Western United States (California)</td>
<td>analytics-api-lax.zego.im</td>
</tr>
<tr>
<td>Asia-Pacific (Mumbai)</td>
<td>analytics-api-bom.zego.im</td>
</tr>
<tr>
<td>Southeast Asia (Singapore)</td>
<td>analytics-api-sgp.zego.im</td>
</tr>
<tr>
<td>Unified access address (regardless of region)</td>
<td>analytics-api.zego.im</td>
</tr>
</tbody></table>

### Communication Protocol

All ZEGOCLOUD Analytics Dashboard Server API interfaces communicate via HTTPS, providing secure communication services.


### Request Method

ZEGOCLOUD Analytics Dashboard Server API supports the following HTTP request methods:

- **GET**
  - All request parameters (including public parameters and business parameters) are placed in the Query.
- **POST**
  - Special and complex API business parameters are placed in the Body, and public parameters are placed in the Query.
  - The parameters in the Body can be directly passed in JsonObject format, without the need to serialize them into String format.
  - Set “Content-type” to “application/json” in the Headers.

## Public Parameters

This section introduces the public parameters used by developers when calling the ZEGOCLOUD Analytics Dashboard Server API, including public request parameters and public return parameters.

### Public Request Parameters

Public request parameters are the request parameters that are required for each interface.

<table>
  <tbody><tr>
    <th>Parameter</th>
    <th>Type</th>
    <th>Required</th>
    <th>Description</th>
  </tr>
  <tr>
    <td>AppId</td>
    <td>Uint32</td>
    <td>Yes</td>
    <td>AppId, the unique credential assigned by ZEGOCLOUD.</td>
  </tr>
  <tr>
    <td>Signature</td>
    <td>String</td>
    <td>Yes</td>
    <td>Signature, please refer to <a href="#signature mechanism">signature mechanism</a> for signature generation.</td>
  </tr>
  <tr>
    <td>SignatureNonce</td>
    <td>String</td>
    <td>Yes</td>
    <td>Random string.</td>
  </tr>
  <tr>
    <td>SignatureVersion</td>
    <td>String</td>
    <td>Yes</td>
    <td>Signature version, <b>must be filled in as 2.0</b>.</td>
  </tr>
  <tr>
    <td>Timestamp</td>
    <td>Int64</td>
    <td>Yes</td>
    <td>Unix timestamp in seconds. Allow up to 10 minutes of error.</td>
  </tr>
  <tr>
    <td rowspan="2">IsTest</td>
    <td rowspan="2">String</td>
    <td>Yes (for projects created before 2021-11-16)</td>
    <td>Whether it is a test environment. The values are as follows: <ul><li>true (case-insensitive): test environment</li><li>false (case-insensitive): formal environment (default value)</li></ul><Warning title="Warning">For projects created before <strong>2021-11-16</strong> in the <a target="_blank" href="https://console.zego.im">ZEGOCLOUD console</a>:<ul><li>The AppId and AppSign obtained from the console are by default in the test environment.</li><li>This parameter can be set based on the environment type of the AppId and business requirements.</li></ul></Warning></td>
  </tr>
  <tr>
    <td>No (for projects created after 2021-11-16)</td>
    <td>Whether it is a test environment. The default is formal environment, and can be ignored and not filled. <Warning title="Warning">For projects created after <strong>2021-11-16</strong> in the <a target="_blank" href="https://console.zego.im">ZEGOCLOUD console</a>: The AppId and AppSign obtained from the console are all in the formal environment.</Warning></td>
  </tr>
</tbody></table>

**Request example:**

<Warning title="Warning">
- Please do not directly copy the following examples for requests.
- `https://analytics-api.zego.im/?Action=GetBizUsage` needs to be replaced with the request address in the "Request method and endpoint" section of each API document.
- Modify the values of each common parameter according to the actual situation.
</Warning>

<CodeGroup>
```bash title="GET"
https://analytics-api.zego.im/?Action=xxxx
&AppId=1234567890
&SignatureNonce=15215528852396
&Timestamp=1234567890
&Signature=xxxx
&SignatureVersion=2.0
&IsTest=false
&<Non-common request parameters>
```

```bash title="POST"
https://analytics-api.zego.im/?Action=xxxx
&AppId=1234567890
&SignatureNonce=15215528852396
&Timestamp=1234567890
&Signature=xxxx
&SignatureVersion=2.0
&IsTest=false
```
</CodeGroup>

Developers can input the URL address on the [Server API verification](https://doc-zh.zego.im/server-link-checker) page to verify the signature information, public parameters, and whether the URL format is legal.

### Public Return Parameters

The API returns results in a unified format, and the data format returned is JSON.

Every time an interface is called, whether successful or not, common parameters will be returned.

<table>
<thead>
  <tr>
    <th>Parameter</th>
    <th>Type</th>
    <th>Description</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>Code</td>
    <td>Number</td>
    <td>Return code.</td>
  </tr>
  <tr>
    <td>Message</td>
    <td>String</td>
    <td>Operation result description.</td>
  </tr>
  <tr>
    <td>RequestId</td>
    <td>String</td>
    <td>Request ID.</td>
  </tr>
  <tr>
    <td>Data</td>
    <td>-</td>
    <td>Response data.</td>
  </tr>
</tbody>
</table>


**Response example:**

```json 
{
    "Code": 0,
    "Data": {
        "Metrics": [
            {
                "Metric": "publish_count",
                "Values": [
                    {
                        "Date": "20250110",
                        "Value": 100
                    },
                    {
                        "Date": "20250111",
                        "Value": 30
                    },
                    {
                        "Date": "20250112",
                        "Value": 40
                    }
                ]
            },
            {
                "Metric": "play_count",
                "Values": [
                    {
                        "Date": "20250110",
                        "Value": 60
                    },
                    {
                        "Date": "20250111",
                        "Value": 20
                    },
                    {
                        "Date": "20250112",
                        "Value": 10
                    }
                ]
            }
        ]
    },
    "Message": "success",
    "RequestId": 1659512998878671000
}
```

<Content />