# 获取歌曲与歌词资源接口说明

- - -

<style>
table th:nth-of-type(1) {min-width: 80px; width: 25%;}
table th:nth-of-type(2) {min-width: 80px; width: 25%;}
table {width: 100%;}
</style>
  
@@@Music_and_Lyrics_API_Reuseable_2@@@

<Warning title="Warning">

获取歌曲/伴奏/高潮片段资源中的 resource_id，只在 SDK 的生命周期内有效。其他用户如需获取对应的音乐资源，必须通过调用 [getSharedResource\|_blank](/article/api?doc=Express_Video_SDK_API~javascript_web~class~ZegoCopyrightedMusic#get-shared-resource) 接口获取对应的 resource_id。
</Warning>

## 1 获取歌曲资源

### 1.1 获取包含人声的歌曲资源

用户调用 [requestResource\|_blank](/article/api?doc=Express_Video_SDK_API~javascript_web~class~ZegoCopyrightedMusic#request-resource) 接口点歌，“资源类型”选择 `0`，即歌曲原唱资源，通过其回调结果，可以获取 songID 对应歌曲的资源，包括歌曲时长、歌手名、resource_id 等。

#### 接口调用示例

```js
/** 音乐 songID，从歌曲列表中获取*/
/** 版权方 vendorID */
/**
 * 资源类型 type 包含：
 * 0：包含人声的原曲
 * 1：伴奏
 * 2：伴奏高潮片段
 */
const requestConfig = {
    songID: songId,
    vendorID: 2, // 版权方，其对应的枚举值信息，请联系 ZEGO 商务咨询
    mode: 0, // 计费模式，0 为按次数计费
    /** 请联系 ZEGO 商务开通使用场景，使用过程请传入正确的场景 ID。*/
    sceneID: 0
};
// 原声歌曲的枚举值为 0
const typeSong = 0;
/** 点歌 */
copyrightedMusic.requestResource(requestConfig, typeSong).then(function(res) {
    if (res.errorCode === 0) {
        resourceID = res.resource.data.resources[0].resource_id;
    } else {
        // 报错处理
    }
});
```

@@@requestResourceCallback_Song@@@

### 1.2 获取歌曲伴奏资源

用户调用 [requestResource\|_blank](/article/api?doc=Express_Video_SDK_API~javascript_web~class~ZegoCopyrightedMusic#request-resource) 接口点伴奏，“资源类型”选择 `1`，通过其回调结果，可以获取 songID 对应歌曲的伴奏资源，包括歌曲资源个数、resource_id、krc_token 等。

#### 接口调用示例

```js
/** 音乐 songID，从歌曲列表中获取*/
const requestConfig = {
    songID: songId,
    vendorID: 2, // 版权方，其对应的枚举值信息，请联系 ZEGO 商务咨询
    mode: 0, // 计费模式，0 为按次数计费
    /** 请联系 ZEGO 商务开通使用场景，使用过程请传入正确的场景 ID。*/
    sceneID: 0
};
// 伴奏的枚举值为 1
const typeAccompaniment = 1;
/** 点歌 */
copyrightedMusic.requestResource(requestConfig, typeAccompaniment).then(function(res) {
    if (res.errorCode === 0) {
        resourceID = res.resource.data.resources[0].resource_id;
    } else {
        // 报错处理
    }
});
```

@@@requestSongCallback_Accompaniment@@@

### 1.3 获取长分片高潮片段资源

用户调用 [requestResource\|_blank](/article/api?doc=Express_Video_SDK_API~javascript_web~class~ZegoCopyrightedMusic#request-resource) 接口点高潮片段，“资源类型”选择 `2`，通过其回调结果，可以获取 songID 对应歌曲的伴奏资源，包括高潮片段的开始与结束时间、resource_id、krc_token 等。

#### 接口调用示例

```js
/** 音乐 songID，从歌曲列表中获取*/
const requestConfig = {
    songID: songId,
    vendorID: 2, // 版权方，其对应的枚举值信息，请联系 ZEGO 商务咨询
    mode: 0, // 计费模式，0 为按次数计费
    /** 请联系 ZEGO 商务开通使用场景，使用过程请传入正确的场景 ID。*/
    sceneID: 0
};
// 歌曲高潮片段的枚举值为 2
const typeAccompanimentClip = 2;
/** 点歌 */
copyrightedMusic.requestResource(requestConfig, typeAccompanimentClip).then(function(res) {
    if (res.errorCode === 0) {
        resourceID = res.resource.data.resources[0].resource_id;
    } else {
        // 报错处理
    }
});
```

@@@requestResourcesCallback_AccompanimentClip@@@


### 1.4 获取短分片高潮片段资源

<Warning title="Warning">

- 与 [1.3 获取长分片高潮片段资源](!Songs_resources_and_lyrics_interface_description#1_3)  相比，本功能提供更短的歌曲资源分片（例如，高潮片段资源的长分片时长约为 40s，短分片时长约为 20s），支持获取抢唱片段的开始与结束时间等信息，适用于 KTV 抢唱场景中。
- 短分片高潮片段资源支持的曲库，可以通过服务端的 [获取标签列表\|_blank](!KTV_Live_Chorus_Program_down-get_list_tags) 接口获取，仅当 vendorID 为 0（默认）、1、2 时支持获取。
</Warning>

用户调用 [requestResource\|_blank](/article/api?doc=Express_Video_SDK_API~javascript_web~class~ZegoCopyrightedMusic#request-resource) 接口点伴奏，“资源类型”选择 `3`，通过其回调结果，可以获取 songID 对应歌曲的伴奏片段资源，包括高潮片段短分片的开始与结束时间、抢唱片段的开始与结束时间、resource_id、krc_token 等。

#### 接口调用示例

```js
/** 音乐 songID，从歌曲列表中获取*/
const requestConfig = {
    songID: songId,
    vendorID: 2, // 版权方，其对应的枚举值信息，请联系 ZEGO 商务咨询
    mode: 0, // 计费模式，0 为按次数计费
    /** 请联系 ZEGO 商务开通使用场景，使用过程请传入正确的场景 ID。*/
    sceneID: 0
};
// 歌曲短分片高潮片段的枚举值为 3
const typeAccompanimentSegment = 3;
/** 点歌 */
copyrightedMusic.requestResource(requestConfig, typeAccompanimentClip).then(function(res) {
    if (res.errorCode === 0) {
        resourceID = res.resource.data.resources[0].resource_id;
    } else {
        // 报错处理
    }
});
```

@@@requestResourcesCallback_AccompanimentClip_qc@@@

### 1.5 获取其他用户分享的歌曲资源

<Warning title="Warning">

调用 [getSharedResource\|_blank](/article/api?doc=Express_Video_SDK_API~javascript_web~class~ZegoCopyrightedMusic#get-shared-resource) 接口获取其他用户分享的资源时，如果返回了 `1017050` 错误码，表示资源已失效。

此时，需要有用户重新调用 [requestResource\|_blank](/article/api?doc=Express_Video_SDK_API~javascript_web~class~ZegoCopyrightedMusic#request-resource) 接口获取资源并进行分享，其他用户重新调用 [getSharedResource\|_blank](/article/api?doc=Express_Video_SDK_API~javascript_web~class~ZegoCopyrightedMusic#get-shared-resource) 接口获取对应的歌曲资源。
</Warning>

用户在获取歌曲/伴奏/高潮片段资源成功后，其他用户调用 [getSharedResource\|_blank](/article/api?doc=Express_Video_SDK_API~javascript_web~class~ZegoCopyrightedMusic#get-shared-resource) 接口获取被分享的音乐资源，通过其回调结果，可以获取对应歌曲的 resource_id。

##### 接口调用示例

```js
/** 版权方，其对应的枚举值信息，请联系 ZEGO 商务咨询*/

/**
 * 资源类型 type 包含：
 * 0：包含人声的原曲
 * 1：伴奏
 * 2：伴奏高潮片段
 */
const typeAccompaniment = 2; 
/** 点歌用户分享的歌曲资源对应的 songID */
copyrightedMusic.getSharedResource(
    {songID: 0, vendorID: 2},
    typeAccompaniment
).then(({res})=>{
    //监听结果
    if(res.errorCode ===0)
    {
        // 歌曲资源获取成功，可进行下载歌曲等操作  
    }
    else
    {
        // 失败
    }
})
```

#### 1.5.1 获取歌曲资源

@@@getResourcesCallback_Song@@@

#### 1.5.2 获取伴奏资源

@@@getResourcesCallback_Accompaniment@@@

#### 1.5.3 获取长分片高潮片段资源

@@@getResourcesCallback_AccompanimentClip@@@

#### 1.5.4 获取短分片高潮片段资源

@@@getResourcesCallback_AccompanimentClip_qc@@@

## 2 获取歌词

### 2.1 获取逐行歌词

用户调用 [getLrcLyric\|_blank](/article/api?doc=Express_Video_SDK_API~javascript_web~class~ZegoCopyrightedMusic#get-lrc-lyric) 接口，通过其回调结果，可以获取逐行歌词信息。

#### 接口调用示例

```js
/** 歌曲的 songID */
const songID = "";
/** 版权方，其对应的枚举值信息，请联系 ZEGO 商务咨询*/
const vendorID = 2; 
// 一次性获取逐行歌词
copyrightedMusic.getLrcLyric(
    songID,
    vendorID
).then(
    ({ errorCode, lyrics })=>{
    // errorCode 为 0, 则成功获取到歌词信息  lyrics
    }
);
```

@@@ZegoCopyrightedMusicGetLrcLyricCallback@@@

### 2.2 获取逐字歌词

用户先通过 [requestResource\|_blank](/article/api?doc=Express_Video_SDK_API~javascript_web~class~ZegoCopyrightedMusic#request-resource)、[getSharedResource\|_blank](/article/api?doc=Express_Video_SDK_API~javascript_web~class~ZegoCopyrightedMusic#get-shared-resource) 接口获取到 krc_token，再调用 [getKrcLyricByToken\|_blank](/article/api?doc=Express_Video_SDK_API~javascript_web~class~ZegoCopyrightedMusic#get-krc-lyric-by-token) 接口，通过其回调结果，可以获取逐字歌词信息。

#### 接口调用示例

```js
/** 点歌时获取的 krcToken */
const krcToken = "";

// 一次性获取逐字歌词
copyrightedMusic.getKrcLyricByToken(krcToken).then(
    ({ errorCode, lyrics })=>{
        // errorCode 为 0, 则成功获取到歌词信息  lyrics
    }
);
```

@@@ZegoCopyrightedMusicGetKrcLyricByTokenCallback@@@
