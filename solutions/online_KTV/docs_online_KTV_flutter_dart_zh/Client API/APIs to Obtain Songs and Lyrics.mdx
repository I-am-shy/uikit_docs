# 获取歌曲与歌词资源接口说明

- - -

@@@Music_and_Lyrics_API_Reuseable@@@

<Warning title="Warning">

获取歌曲/伴奏/高潮片段资源中的 resource_id，只在 SDK 的生命周期内有效。其他用户如需获取对应的音乐资源，必须通过调用 [getSharedResource](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusic/getSharedResource.html) 接口获取对应的 resource_id。
</Warning>

## 1 获取歌曲资源

### 1.1 获取包含人声的歌曲资源

用户调用 [requestResource](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusic/requestResource.html) 接口点歌，“资源类型”选择 `ZegoCopyrightedMusicResourceSong`，通过 [ZegoCopyrightedMusicRequestResourceResult](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusicRequestResourceResult-class.html) 回调结果，可以获取 songID 对应歌曲的资源，包括歌曲时长、歌手名、resource_id 等。


#### 接口调用示例

```dart
/** 音乐 songID */
String songID = "";
/** 计费模式 */
var mode = ZegoCopyrightedMusicBillingMode.Count;
/** 版权方，其对应的枚举值信息，请联系 ZEGO 商务咨询*/
var vendorID = ZegoCopyrightedMusicVendorID.ZegoCopyrightedMusicVendorDefault;
/** 场景 sceneID：1 语聊房、2 直播间在线 K 歌、3 直播间播放背景音乐、4 抢唱*/
/** 请联系 ZEGO 商务开通使用场景，使用过程请传入正确的场景 ID。*/
var sceneID = 0;
/** 点歌配置 */
var config = ZegoCopyrightedMusicRequestConfig(songID, mode, vendorID: vendorID, sceneID: sceneID);

/** 资源类型 */
var resourceType = ZegoCopyrightedMusicResourceType.ZegoCopyrightedMusicResourceSong;

copyrightedMusic?.requestResource(config, resourceType).then((ZegoCopyrightedMusicRequestResourceResult result) {
    // result.errorCode: 错误码，详细请参考错误码文档 https://doc-zh.zego.im/article/5641。
    // result.resource: JSON 字符串，歌曲资源信息。
});
```

@@@requestResourceCallback_Song@@@


### 1.2 获取歌曲伴奏资源

用户调用 [requestResource](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusic/requestResource.html) 接口点伴奏，“资源类型”选择 `ZegoCopyrightedMusicResourceAccompaniment`，通过 [ZegoCopyrightedMusicRequestResourceResult](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusicRequestResourceResult-class.html) 回调结果，可以获取 songID 对应歌曲的伴奏资源，包括歌曲资源个数、resource_id、krc_token 等。

#### 接口调用示例

```dart
/** 音乐 songID */
String songID = "";
/** 计费模式 */
var mode = ZegoCopyrightedMusicBillingMode.Count;
/** 版权方，其对应的枚举值信息，请联系 ZEGO 商务咨询*/
var vendorID = ZegoCopyrightedMusicVendorID.ZegoCopyrightedMusicVendorDefault;
/** 场景 sceneID：1 语聊房、2 直播间在线 K 歌、3 直播间播放背景音乐、4 抢唱*/
/** 请联系 ZEGO 商务开通使用场景，使用过程请传入正确的场景 ID。*/
var sceneID = 0;
/** 点歌配置 */
var config = ZegoCopyrightedMusicRequestConfig(songID, mode, vendorID: vendorID, sceneID: sceneID);

/** 资源类型 */
var resourceType = ZegoCopyrightedMusicResourceType.ZegoCopyrightedMusicResourceAccompaniment;

copyrightedMusic?.requestResource(config, resourceType).then((ZegoCopyrightedMusicRequestResourceResult result) {
    // result.errorCode: 错误码，详细请参考错误码文档 https://doc-zh.zego.im/article/5641。
    // result.resource: JSON 字符串，歌曲伴奏资源信息。
});
```

@@@requestSongCallback_Accompaniment@@@


### 1.3 获取长分片高潮片段资源

用户调用 [requestResource](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusic/requestResource.html) 接口点伴奏高潮片段，“资源类型”选择 `ZegoCopyrightedMusicResourceAccompanimentClip`，通过 [ZegoCopyrightedMusicRequestResourceResult](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusicRequestResourceResult-class.html) 回调结果，可以获取 songID 对应歌曲的伴奏资源，包括高潮片段的开始与结束时间、resource_id、krc_token 等。

#### 接口调用示例

```dart
/** 音乐 songID */
String songID = "";
/** 计费模式 */
var mode = ZegoCopyrightedMusicBillingMode.Count;
/** 版权方，其对应的枚举值信息，请联系 ZEGO 商务咨询*/
var vendorID = ZegoCopyrightedMusicVendorID.ZegoCopyrightedMusicVendorDefault;
/** 场景 sceneID：1 语聊房、2 直播间在线 K 歌、3 直播间播放背景音乐、4 抢唱*/
/** 请联系 ZEGO 商务开通使用场景，使用过程请传入正确的场景 ID。*/
var sceneID = 0;
/** 点歌配置 */
var config = ZegoCopyrightedMusicRequestConfig(songID, mode, vendorID: vendorID, sceneID: sceneID);

/** 资源类型 */
var resourceType = ZegoCopyrightedMusicResourceType.ZegoCopyrightedMusicResourceAccompanimentClip;

copyrightedMusic?.requestResource(config, resourceType).then((ZegoCopyrightedMusicRequestResourceResult result) {
    // result.errorCode: 错误码，详细请参考错误码文档 https://doc-zh.zego.im/article/5641。
    // result.resource: JSON 字符串，歌曲伴奏资源信息。
});
```

@@@requestResourcesCallback_AccompanimentClip@@@


### 1.4 获取短分片高潮片段资源

<Warning title="Warning">

与 [1.3 获取长分片高潮片段资源](./../Client%20API/APIs%20to%20Obtain%20Songs%20and%20Lyrics.mdx#1_3) 相比，本功能提供更短的歌曲资源分片（例如，高潮片段资源的长分片时长约为 40s，短分片时长约为 20s），支持获取抢唱片段的开始与结束时间等信息，适用于 KTV 抢唱场景中。
</Warning>

用户调用 [requestResource](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusic/requestResource.html) 接口点伴奏高潮片段，“资源类型”选择 `ZegoCopyrightedMusicResourceAccompanimentSegment`，通过 [ZegoCopyrightedMusicRequestResourceResult](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusicRequestResourceResult-class.html) 回调结果，可以获取 songID 对应歌曲的伴奏片段资源，包括高潮片段短分片的开始与结束时间、抢唱片段的开始与结束时间、resource_id、krc_token 等。

#### 接口调用示例

```dart
/** 音乐 songID */
String songID = "";
/** 计费模式 */
var mode = ZegoCopyrightedMusicBillingMode.Count;
/** 版权方，其对应的枚举值信息，请联系 ZEGO 商务咨询*/
var vendorID = ZegoCopyrightedMusicVendorID.ZegoCopyrightedMusicVendorDefault;
/** 场景 sceneID：1 语聊房、2 直播间在线 K 歌、3 直播间播放背景音乐、4 抢唱*/
/** 请联系 ZEGO 商务开通使用场景，使用过程请传入正确的场景 ID。*/
var sceneID = 0;
/** 点歌配置 */
var config = ZegoCopyrightedMusicRequestConfig(songID, mode, vendorID: vendorID, sceneID: sceneID);

/** 资源类型 */
var resourceType = ZegoCopyrightedMusicResourceType.ZegoCopyrightedMusicResourceAccompanimentSegment;

copyrightedMusic?.requestResource(config, resourceType).then((ZegoCopyrightedMusicRequestResourceResult result) {
    // result.errorCode: 错误码，详细请参考错误码文档 https://doc-zh.zego.im/article/5641。
    // result.resource: JSON 字符串，歌曲伴奏资源信息。
});
```

@@@requestResourcesCallback_AccompanimentClip_qc@@@

### 1.5 获取其他用户分享的歌曲资源

<Warning title="Warning">

不同版权方对应的歌曲资源有效时长不同（详情请咨询 ZEGO 商务人员），调用 [getSharedResource](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusic/getSharedResource.html) 接口获取其他用户分享的资源时，如果返回了 `1017050` 错误码，表示资源已失效。

此时，需要有用户重新调用 [requestResource](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusic/requestResource.html) 接口获取资源并进行分享，其他用户重新调用 [getSharedResource](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusic/getSharedResource.html) 接口获取对应的歌曲资源。
</Warning>

用户在获取歌曲/伴奏/高潮片段资源成功后，其他用户调用 [getSharedResource](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusic/getSharedResource.html) 接口获取被分享的音乐资源，通过 [ZegoCopyrightedMusicGetSharedResourceResult](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusicGetSharedResourceResult-class.html) 回调结果，可以获取对应歌曲的 resource_id。

##### 接口调用示例

```dart
String songID = "";
/** 版权方，其对应的枚举值信息，请联系 ZEGO 商务咨询*/
var vendorID = ZegoCopyrightedMusicVendorID.ZegoCopyrightedMusicVendorDefault;
var config = new ZegoCopyrightedMusicGetSharedConfig(songID, vendorID: vendorID);

/** 点歌用户分享的歌曲资源对应的资源类型 */
var resourceType = ZegoCopyrightedMusicResourceType.ZegoCopyrightedMusicResourceSong;

copyrightedMusic?.getSharedResource(config, resourceType).then((ZegoCopyrightedMusicGetSharedResourceResult result) {
    // result.errorCode: 错误码，详细请参考错误码文档 https://doc-zh.zego.im/article/5641。
    // result.resource: JSON 字符串，其他用户分享的歌曲资源信息。
});
```

#### 1.5.1 获取包含人声的歌曲资源

@@@getResourcesCallback_Song@@@

#### 1.5.2 获取伴奏资源

@@@getResourcesCallback_Accompaniment@@@

#### 1.5.3 获取长分片高潮片段资源

@@@getResourcesCallback_AccompanimentClip@@@

#### 1.5.4 获取短分片高潮片段资源

@@@getResourcesCallback_AccompanimentClip_qc@@@

## 2 获取歌词


### 2.1 获取逐行歌词

用户调用 [getLrcLyric](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusic/getLrcLyric.html) 接口，通过 [ZegoCopyrightedMusicGetLrcLyricResult](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusicGetLrcLyricResult-class.html) 回调结果，可以获取逐行歌词信息。


#### 接口调用示例

```dart
String songID = "";
/** 版权方，其对应的枚举值信息，请联系 ZEGO 商务咨询*/
var vendorID = ZegoCopyrightedMusicVendorID.ZegoCopyrightedMusicVendorDefault;
copyrightedMusic?.getLrcLyric(songID, vendorID: vendorID).then((ZegoCopyrightedMusicGetLrcLyricResult result) {
    // result.errorCode: 错误码，详细请参考错误码文档https://docs.zegocloud.com/en/5548.html。
    // result.lyrics: JSON 字符串，逐行歌词信息。
});
```

@@@ZegoCopyrightedMusicGetLrcLyricCallback@@@



### 2.2 获取逐字歌词

用户先通过 [requestAccompaniment](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusic/requestAccompaniment.html)、[requestAccompanimentClip](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusic/requestAccompanimentClip.html)、[getMusicByToken](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusic/getMusicByToken.html) 接口获取到 krc_token，再调用 [getKrcLyricByToken](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusic/getKrcLyricByToken.html) 接口，通过 [ZegoCopyrightedMusicGetKrcLyricByTokenResult](/unique-api/express-video-sdk/zh/dart_flutter/zego_express_engine/ZegoCopyrightedMusicGetKrcLyricByTokenResult-class.html) 回调结果，可以获取逐字歌词信息。


#### 接口调用示例

```dart
String krcToken = "";
copyrightedMusic?.getKrcLyricByToken(krcToken).then((ZegoCopyrightedMusicGetKrcLyricByTokenResult result) {
    // result.errorCode: 错误码，详细请参考错误码文档https://docs.zegocloud.com/en/5548.html。
    // result.lyrics: JSON 字符串，逐字歌词信息。
});
```

@@@ZegoCopyrightedMusicGetKrcLyricByTokenCallback@@@
